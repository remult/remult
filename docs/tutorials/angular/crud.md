# CRUD Operations

## Adding new tasks

Now that we can see the list of tasks, it's time to add a few more.

1. Add a `newTaskTitle` field and an `addTask` method to the `ToDoComponent`

_src/app/todo/todo.component.ts_

```ts{2-11}
export class TodoComponent implements OnInit {
  newTaskTitle = ""
  async addTask() {
    try {
      const newTask = await this.taskRepo.save({ title: this.newTaskTitle })
      this.tasks.push(newTask)
      this.newTaskTitle = ""
    } catch (error /*:any*/) {
      alert(error.message)
    }
  }
}
```

- the call to `taskRepo.insert` will make a post request to the server, insert the new task to the `db`, and return the new `Task` object with all it's info (including the id generated by the database)

2. Add an _Add Task_ form in the html template:

_src/app/todo/todo.component.html_

```html{3-10}
<h1>todos</h1>
<main>
  <form (submit)="addTask()">
    <input
      placeholder="What needs to be done?"
      [(ngModel)]="newTaskTitle"
      name="newTaskTitle"
    />
    <button>Add</button>
  </form>
  <div *ngFor="let task of tasks">
    <input type="checkbox" [checked]="task.completed" />
    {{ task.title }}
  </div>
</main>
```

Try adding a few tasks to see how it works

## Rename Tasks and Mark as Completed

To make the tasks in the list updatable, we'll bind the `input` elements to the `Task` properties and add a _Save_ button to save the changes to the backend database.

1. Add a `saveTask` method to save the state of a task to the backend database

   _src/app/todo/todo.component.ts_

   ```ts
   async saveTask(task: Task) {
     try {
       await this.taskRepo.save(task)
     } catch (error: any) {
       alert(error.message)
     }
   }
   ```

2) Modify the contents of the `tasks` div to include the following `input` elements and a _Save_ button to call the `saveTask` method.

   _src/app/todo/todo.component.html_

   ```html{2-8}
   <div *ngFor="let task of tasks">
     <input
       type="checkbox"
       [(ngModel)]="task.completed"
       (change)="saveTask(task)"
     />
     <input [(ngModel)]="task.title" />
     <button (click)="saveTask(task)">Save</button>
   </div>
   ```

   - Make sure to use replace the `[checked]` attribute with the `ngModel` attribute on the checkbox, to have two-way binding for the `completed` field

Make some changes and refresh the browser to verify the backend database is updated.

## Delete Tasks

Let's add a _Delete_ button next to the _Save_ button of each task in the list.

1. Add the following `deleteTask` method to the `TodoComponent` class:

_src/app/todo/todo.component.ts_

```ts
async deleteTask(task: Task) {
   await this.taskRepo.delete(task);
   this.tasks = this.tasks.filter(t => t !== task);
}
```

2. Add a _Delete_ button in the html:

_src/app/todo/todo.component.html_

```html{9}
<div *ngFor="let task of tasks">
  <input
    type="checkbox"
    [(ngModel)]="task.completed"
    (change)="saveTask(task)"
  />
  <input [(ngModel)]="task.title" />
  <button (click)="saveTask(task)">Save</button>
  <button (click)="deleteTask(task)">Delete</button>
</div>
```
