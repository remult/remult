var xl=Object.defineProperty;var xs=r=>{throw TypeError(r)};var Dl=(r,e,t)=>e in r?xl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>Dl(r,typeof e!="symbol"?e+"":e,t),Ds=(r,e,t)=>e.has(r)||xs("Cannot "+t);var V=(r,e,t)=>(Ds(r,e,"read from private field"),t?t.call(r):e.get(r)),he=(r,e,t)=>e.has(r)?xs("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Ne=(r,e,t,n)=>(Ds(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var xa=Array.isArray,Nl=Array.prototype.indexOf,Ml=Array.from,Da=Object.defineProperty,nr=Object.getOwnPropertyDescriptor,Na=Object.getOwnPropertyDescriptors,Ll=Object.prototype,ql=Array.prototype,Yi=Object.getPrototypeOf;const Tr=()=>{};function Bl(r){return r()}function Fn(r){for(var e=0;e<r.length;e++)r[e]()}const Ze=2,Ma=4,fn=8,Xi=16,ht=32,pr=64,Pn=128,ut=256,Rn=512,Ae=1024,qt=2048,yr=4096,ur=8192,si=16384,jl=32768,cn=65536,Ul=1<<17,La=1<<19,qa=1<<20,$t=Symbol("$state"),Ba=Symbol("legacy props"),Jl=Symbol("");function ja(r){return r===this.v}function Ua(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Zi(r){return!Ua(r,this.v)}function Vl(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function $l(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Wl(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Hl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Gl(){throw new Error("https://svelte.dev/e/hydration_failed")}function zl(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ql(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Kl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Yl(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Xl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let mr=!1;function Zl(){mr=!0}const eu=1,tu=2,ru=4,nu=8,iu=16,su=1,au=2,es="[",Ja="[!",Va="]",Ar={},Pe=Symbol();function ts(r){console.warn("https://svelte.dev/e/hydration_mismatch")}function ou(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let pe=null;function Ns(r){pe=r}function ai(r,e=!1,t){pe={p:pe,c:null,e:null,m:!1,s:r,x:null,l:null},mr&&!e&&(pe.l={s:null,u:null,r1:[],r2:Ye(!1)})}function oi(r){const e=pe;if(e!==null){const a=e.e;if(a!==null){var t=Y,n=ne;e.e=null;try{for(var i=0;i<a.length;i++){var s=a[i];ct(s.effect),Lt(s.reaction),rs(s.fn)}}finally{ct(t),Lt(n)}}pe=e.p,e.m=!0}return{}}function dn(){return!mr||pe!==null&&pe.l===null}function Ye(r,e){var t={f:0,v:r,reactions:null,equals:ja,rv:0,wv:0};return t}function Ce(r){return lu(Ye(r))}function $a(r,e=!1){var n;const t=Ye(r);return e||(t.equals=Zi),mr&&pe!==null&&pe.l!==null&&((n=pe.l).s??(n.s=[])).push(t),t}function lu(r){return ne!==null&&!kt&&ne.f&Ze&&(lt===null?ku([r]):lt.push(r)),r}function ce(r,e){return ne!==null&&!kt&&dn()&&ne.f&(Ze|Xi)&&(lt===null||!lt.includes(r))&&Xl(),uu(r,e)}function uu(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=lo(),Wa(r,qt),dn()&&Y!==null&&Y.f&Ae&&!(Y.f&(ht|pr))&&(vt===null?Eu([r]):vt.push(r))),e}function Wa(r,e){var t=r.reactions;if(t!==null)for(var n=dn(),i=t.length,s=0;s<i;s++){var a=t[s],o=a.f;o&qt||!n&&a===Y||(dt(a,e),o&(Ae|ut)&&(o&Ze?Wa(a,yr):fi(a)))}}let re=!1;function Ft(r){re=r}let te;function et(r){if(r===null)throw ts(),Ar;return te=r}function li(){return et(ft(te))}function se(r){if(re){if(ft(te)!==null)throw ts(),Ar;te=r}}function xn(r=1){if(re){for(var e=r,t=te;e--;)t=ft(t);te=t}}function fu(){for(var r=0,e=te;;){if(e.nodeType===8){var t=e.data;if(t===Va){if(r===0)return e;r-=1}else(t===es||t===Ja)&&(r+=1)}var n=ft(e);e.remove(),e=n}}function bt(r,e=null,t){if(typeof r!="object"||r===null||$t in r)return r;const n=Yi(r);if(n!==Ll&&n!==ql)return r;var i=new Map,s=xa(r),a=Ye(0);s&&i.set("length",Ye(r.length));var o;return new Proxy(r,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Ql();var c=i.get(u);return c===void 0?(c=Ye(f.value),i.set(u,c)):ce(c,bt(f.value,o)),!0},deleteProperty(l,u){var f=i.get(u);if(f===void 0)u in l&&i.set(u,Ye(Pe));else{if(s&&typeof u=="string"){var c=i.get("length"),h=Number(u);Number.isInteger(h)&&h<c.v&&ce(c,h)}ce(f,Pe),Ms(a)}return!0},get(l,u,f){var y;if(u===$t)return r;var c=i.get(u),h=u in l;if(c===void 0&&(!h||(y=nr(l,u))!=null&&y.writable)&&(c=Ye(bt(h?l[u]:Pe,o)),i.set(u,c)),c!==void 0){var p=H(c);return p===Pe?void 0:p}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var c=i.get(u);c&&(f.value=H(c))}else if(f===void 0){var h=i.get(u),p=h==null?void 0:h.v;if(h!==void 0&&p!==Pe)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return f},has(l,u){var p;if(u===$t)return!0;var f=i.get(u),c=f!==void 0&&f.v!==Pe||Reflect.has(l,u);if(f!==void 0||Y!==null&&(!c||(p=nr(l,u))!=null&&p.writable)){f===void 0&&(f=Ye(c?bt(l[u],o):Pe),i.set(u,f));var h=H(f);if(h===Pe)return!1}return c},set(l,u,f,c){var M;var h=i.get(u),p=u in l;if(s&&u==="length")for(var y=f;y<h.v;y+=1){var m=i.get(y+"");m!==void 0?ce(m,Pe):y in l&&(m=Ye(Pe),i.set(y+"",m))}h===void 0?(!p||(M=nr(l,u))!=null&&M.writable)&&(h=Ye(void 0),ce(h,bt(f,o)),i.set(u,h)):(p=h.v!==Pe,ce(h,bt(f,o)));var g=Reflect.getOwnPropertyDescriptor(l,u);if(g!=null&&g.set&&g.set.call(c,f),!p){if(s&&typeof u=="string"){var k=i.get("length"),T=Number(u);Number.isInteger(T)&&T>=k.v&&ce(k,T+1)}Ms(a)}return!0},ownKeys(l){H(a);var u=Reflect.ownKeys(l).filter(h=>{var p=i.get(h);return p===void 0||p.v!==Pe});for(var[f,c]of i)c.v!==Pe&&!(f in l)&&u.push(f);return u},setPrototypeOf(){Kl()}})}function Ms(r,e=1){ce(r,r.v+e)}var Ls,Ha,Ga;function Di(){if(Ls===void 0){Ls=window;var r=Element.prototype,e=Node.prototype;Ha=nr(e,"firstChild").get,Ga=nr(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function Nt(r=""){return document.createTextNode(r)}function Gt(r){return Ha.call(r)}function ft(r){return Ga.call(r)}function ae(r,e){if(!re)return Gt(r);var t=Gt(te);if(t===null)t=te.appendChild(Nt());else if(e&&t.nodeType!==3){var n=Nt();return t==null||t.before(n),et(n),n}return et(t),t}function qe(r,e){if(!re){var t=Gt(r);return t instanceof Comment&&t.data===""?ft(t):t}return te}function Le(r,e=1,t=!1){let n=re?te:r;for(var i;e--;)i=n,n=ft(n);if(!re)return n;var s=n==null?void 0:n.nodeType;if(t&&s!==3){var a=Nt();return n===null?i==null||i.after(a):n.before(a),et(a),a}return et(n),n}function cu(r){r.textContent=""}function $e(r){var e=Ze|qt,t=ne!==null&&ne.f&Ze?ne:null;return Y===null||t!==null&&t.f&ut?e|=ut:Y.f|=qa,{ctx:pe,deps:null,effects:null,equals:ja,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??Y}}function du(r){const e=$e(r);return e.equals=Zi,e}function za(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Mt(e[t])}}function hu(r){for(var e=r.parent;e!==null;){if(!(e.f&Ze))return e;e=e.parent}return null}function pu(r){var e,t=Y;ct(hu(r));try{za(r),e=fo(r)}finally{ct(t)}return e}function Qa(r){var e=pu(r),t=(Pt||r.f&ut)&&r.deps!==null?yr:Ae;dt(r,t),r.equals(e)||(r.v=e,r.wv=lo())}function Ka(r){Y===null&&ne===null&&Wl(),ne!==null&&ne.f&ut&&Y===null&&$l(),is&&Vl()}function yu(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function gr(r,e,t,n=!0){var i=(r&pr)!==0,s=Y,a={ctx:pe,deps:null,nodes_start:null,nodes_end:null,f:r|qt,first:null,fn:e,last:null,next:null,parent:i?null:s,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=ir;try{Bs(!0),ss(a),a.f|=jl}catch(f){throw Mt(a),f}finally{Bs(o)}}else e!==null&&fi(a);var l=t&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&(qa|Pn))===0;if(!l&&!i&&n&&(s!==null&&yu(a,s),ne!==null&&ne.f&Ze)){var u=ne;(u.effects??(u.effects=[])).push(a)}return a}function mu(r){const e=gr(fn,null,!1);return dt(e,Ae),e.teardown=r,e}function Dn(r){Ka();var e=Y!==null&&(Y.f&ht)!==0&&pe!==null&&!pe.m;if(e){var t=pe;(t.e??(t.e=[])).push({fn:r,effect:Y,reaction:ne})}else{var n=rs(r);return n}}function Ya(r){return Ka(),ns(r)}function gu(r){const e=gr(pr,r,!0);return(t={})=>new Promise(n=>{t.outro?Nn(e,()=>{Mt(e),n(void 0)}):(Mt(e),n(void 0))})}function rs(r){return gr(Ma,r,!1)}function ns(r){return gr(fn,r,!0)}function wt(r,e=[],t=$e){const n=e.map(t);return hn(()=>r(...n.map(H)))}function hn(r,e=0){return gr(fn|Xi|e,r,!0)}function xr(r,e=!0){return gr(fn|ht,r,!0,e)}function Xa(r){var e=r.teardown;if(e!==null){const t=is,n=ne;js(!0),Lt(null);try{e.call(null)}finally{js(t),Lt(n)}}}function Za(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var n=t.next;Mt(t,e),t=n}}function wu(r){for(var e=r.first;e!==null;){var t=e.next;e.f&ht||Mt(e),e=t}}function Mt(r,e=!0){var t=!1;if((e||r.f&La)&&r.nodes_start!==null){for(var n=r.nodes_start,i=r.nodes_end;n!==null;){var s=n===i?null:ft(n);n.remove(),n=s}t=!0}Za(r,e&&!t),Bn(r,0),dt(r,si);var a=r.transitions;if(a!==null)for(const l of a)l.stop();Xa(r);var o=r.parent;o!==null&&o.first!==null&&eo(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function eo(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Nn(r,e){var t=[];to(r,t,!0),vu(t,()=>{Mt(r),e&&e()})}function vu(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var i of r)i.out(n)}else e()}function to(r,e,t){if(!(r.f&ur)){if(r.f^=ur,r.transitions!==null)for(const a of r.transitions)(a.is_global||t)&&e.push(a);for(var n=r.first;n!==null;){var i=n.next,s=(n.f&cn)!==0||(n.f&ht)!==0;to(n,e,s?t:!1),n=i}}}function qs(r){ro(r,!0)}function ro(r,e){if(r.f&ur){r.f^=ur,r.f&Ae||(r.f^=Ae),pn(r)&&(dt(r,qt),fi(r));for(var t=r.first;t!==null;){var n=t.next,i=(t.f&cn)!==0||(t.f&ht)!==0;ro(t,i?e:!1),t=n}if(r.transitions!==null)for(const s of r.transitions)(s.is_global||e)&&s.in()}}const _u=typeof requestIdleCallback>"u"?r=>setTimeout(r,1):requestIdleCallback;let Mn=!1,Ln=!1,Ni=[],Mi=[];function no(){Mn=!1;const r=Ni.slice();Ni=[],Fn(r)}function io(){Ln=!1;const r=Mi.slice();Mi=[],Fn(r)}function so(r){Mn||(Mn=!0,queueMicrotask(no)),Ni.push(r)}function bu(r){Ln||(Ln=!0,_u(io)),Mi.push(r)}function Iu(){Mn&&no(),Ln&&io()}const ao=0,Ou=1;let In=!1,On=ao,Dr=!1,Nr=null,ir=!1,is=!1;function Bs(r){ir=r}function js(r){is=r}let Jt=[],sr=0;let ne=null,kt=!1;function Lt(r){ne=r}let Y=null;function ct(r){Y=r}let lt=null;function ku(r){lt=r}let Se=null,Me=0,vt=null;function Eu(r){vt=r}let oo=1,qn=0,Pt=!1;function lo(){return++oo}function pn(r){var u;var e=r.f;if(e&qt)return!0;if(e&yr){var t=r.deps,n=(e&ut)!==0;if(t!==null){var i,s,a=(e&Rn)!==0,o=n&&Y!==null&&!Pt,l=t.length;if(a||o){for(i=0;i<l;i++)s=t[i],(a||!((u=s==null?void 0:s.reactions)!=null&&u.includes(r)))&&(s.reactions??(s.reactions=[])).push(r);a&&(r.f^=Rn)}for(i=0;i<l;i++)if(s=t[i],pn(s)&&Qa(s),s.wv>r.wv)return!0}(!n||Y!==null&&!Pt)&&dt(r,Ae)}return!1}function Cu(r,e){for(var t=e;t!==null;){if(t.f&Pn)try{t.fn(r);return}catch{t.f^=Pn}t=t.parent}throw In=!1,r}function Su(r){return(r.f&si)===0&&(r.parent===null||(r.parent.f&Pn)===0)}function ui(r,e,t,n){if(In){if(t===null&&(In=!1),Su(e))throw r;return}t!==null&&(In=!0);{Cu(r,e);return}}function uo(r,e,t=0){var n=r.reactions;if(n!==null)for(var i=0;i<n.length;i++){var s=n[i];s.f&Ze?uo(s,e,t+1):e===s&&(t===0?dt(s,qt):s.f&Ae&&dt(s,yr),fi(s))}}function fo(r){var p;var e=Se,t=Me,n=vt,i=ne,s=Pt,a=lt,o=pe,l=kt,u=r.f;Se=null,Me=0,vt=null,ne=u&(ht|pr)?null:r,Pt=(u&ut)!==0&&(!ir||i===null||l),lt=null,Ns(r.ctx),kt=!1,qn++;try{var f=(0,r.fn)(),c=r.deps;if(Se!==null){var h;if(Bn(r,Me),c!==null&&Me>0)for(c.length=Me+Se.length,h=0;h<Se.length;h++)c[Me+h]=Se[h];else r.deps=c=Se;if(!Pt)for(h=Me;h<c.length;h++)((p=c[h]).reactions??(p.reactions=[])).push(r)}else c!==null&&Me<c.length&&(Bn(r,Me),c.length=Me);if(dn()&&vt!==null&&!(r.f&(Ze|yr|qt)))for(h=0;h<vt.length;h++)uo(vt[h],r);return i!==null&&qn++,f}finally{Se=e,Me=t,vt=n,ne=i,Pt=s,lt=a,Ns(o),kt=l}}function Tu(r,e){let t=e.reactions;if(t!==null){var n=Nl.call(t,r);if(n!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[n]=t[i],t.pop())}}t===null&&e.f&Ze&&(Se===null||!Se.includes(e))&&(dt(e,yr),e.f&(ut|Rn)||(e.f^=Rn),za(e),Bn(e,0))}function Bn(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)Tu(r,t[n])}function ss(r){var e=r.f;if(!(e&si)){dt(r,Ae);var t=Y,n=pe;Y=r;try{e&Xi?wu(r):Za(r),Xa(r);var i=fo(r);r.teardown=typeof i=="function"?i:null,r.wv=oo;var s=r.deps,a}catch(o){ui(o,r,t,n||r.ctx)}finally{Y=t}}}function co(){if(sr>1e3){sr=0;try{Hl()}catch(r){if(Nr!==null)ui(r,Nr,null);else throw r}}sr++}function ho(r){var e=r.length;if(e!==0){co();var t=ir;ir=!0;try{for(var n=0;n<e;n++){var i=r[n];i.f&Ae||(i.f^=Ae);var s=[];po(i,s),Au(s)}}finally{ir=t}}}function Au(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var n=r[t];if(!(n.f&(si|ur)))try{pn(n)&&(ss(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null?eo(n):n.fn=null))}catch(i){ui(i,n,null,n.ctx)}}}function Fu(){if(Dr=!1,sr>1001)return;const r=Jt;Jt=[],ho(r),Dr||(sr=0,Nr=null)}function fi(r){On===ao&&(Dr||(Dr=!0,queueMicrotask(Fu))),Nr=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(pr|ht)){if(!(t&Ae))return;e.f^=Ae}}Jt.push(e)}function po(r,e){var t=r.first,n=[];e:for(;t!==null;){var i=t.f,s=(i&ht)!==0,a=s&&(i&Ae)!==0,o=t.next;if(!a&&!(i&ur))if(i&fn){if(s)t.f^=Ae;else{var l=ne;try{ne=t,pn(t)&&ss(t)}catch(h){ui(h,t,null,t.ctx)}finally{ne=l}}var u=t.first;if(u!==null){t=u;continue}}else i&Ma&&n.push(t);if(o===null){let h=t.parent;for(;h!==null;){if(r===h)break e;var f=h.next;if(f!==null){t=f;continue e}h=h.parent}}t=o}for(var c=0;c<n.length;c++)u=n[c],e.push(u),po(u,e)}function as(r){var e=On,t=Jt;try{co();const i=[];On=Ou,Jt=i,Dr=!1,ho(t);var n=r==null?void 0:r();return Iu(),(Jt.length>0||i.length>0)&&as(),sr=0,Nr=null,n}finally{On=e,Jt=t}}async function yo(){await Promise.resolve(),as()}function H(r){var e=r.f,t=(e&Ze)!==0;if(ne!==null&&!kt){lt!==null&&lt.includes(r)&&Yl();var n=ne.deps;r.rv<qn&&(r.rv=qn,Se===null&&n!==null&&n[Me]===r?Me++:Se===null?Se=[r]:(!Pt||!Se.includes(r))&&Se.push(r))}else if(t&&r.deps===null&&r.effects===null){var i=r,s=i.parent;s!==null&&!(s.f&ut)&&(i.f^=ut)}return t&&(i=r,pn(i)&&Qa(i)),r.v}function fr(r){var e=kt;try{return kt=!0,r()}finally{kt=e}}const Pu=-7169;function dt(r,e){r.f=r.f&Pu|e}function Ru(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if($t in r)Li(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&$t in t&&Li(t)}}}function Li(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{Li(r[n],e)}catch{}const t=Yi(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Na(t);for(let i in n){const s=n[i].get;if(s)try{s.call(r)}catch{}}}}}const xu=["touchstart","touchmove"];function Du(r){return xu.includes(r)}let Us=!1;function mo(){Us||(Us=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function go(r){var e=ne,t=Y;Lt(null),ct(null);try{return r()}finally{Lt(e),ct(t)}}function Nu(r,e,t,n=t){r.addEventListener(e,()=>go(t));const i=r.__on_r;i?r.__on_r=()=>{i(),n(!0)}:r.__on_r=()=>n(!0),mo()}const Mu=new Set,Js=new Set;function Lu(r,e,t,n={}){function i(s){if(n.capture||Or.call(e,s),!s.cancelBubble)return go(()=>t==null?void 0:t.call(this,s))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?so(()=>{e.addEventListener(r,i,n)}):e.addEventListener(r,i,n),i}function qu(r,e,t,n,i){var s={capture:n,passive:i},a=Lu(r,e,t,s);(e===document.body||e===window||e===document)&&mu(()=>{e.removeEventListener(r,a,s)})}function Or(r){var T;var e=this,t=e.ownerDocument,n=r.type,i=((T=r.composedPath)==null?void 0:T.call(r))||[],s=i[0]||r.target,a=0,o=r.__root;if(o){var l=i.indexOf(o);if(l!==-1&&(e===document||e===window)){r.__root=e;return}var u=i.indexOf(e);if(u===-1)return;l<=u&&(a=l)}if(s=i[a]||r.target,s!==e){Da(r,"currentTarget",{configurable:!0,get(){return s||t}});var f=ne,c=Y;Lt(null),ct(null);try{for(var h,p=[];s!==null;){var y=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+n];if(m!==void 0&&!s.disabled)if(xa(m)){var[g,...k]=m;g.apply(s,[r,...k])}else m.call(s,r)}catch(M){h?p.push(M):h=M}if(r.cancelBubble||y===e||y===null)break;s=y}if(h){for(let M of p)queueMicrotask(()=>{throw M});throw h}}finally{r.__root=e,delete r.currentTarget,Lt(f),ct(c)}}}let Ue;function Bu(){Ue=void 0}function ju(r){let e=null,t=re;var n;if(re){for(e=te,Ue===void 0&&(Ue=Gt(document.head));Ue!==null&&(Ue.nodeType!==8||Ue.data!==es);)Ue=ft(Ue);Ue===null?Ft(!1):Ue=et(ft(Ue))}re||(n=document.head.appendChild(Nt()));try{hn(()=>r(n),La)}finally{t&&(Ft(!0),Ue=te,et(e))}}function Uu(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function xt(r,e){var t=Y;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function Ie(r,e){var t=(e&su)!==0,n=(e&au)!==0,i,s=!r.startsWith("<!>");return()=>{if(re)return xt(te,null),te;i===void 0&&(i=Uu(s?r:"<!>"+r),t||(i=Gt(i)));var a=n?document.importNode(i,!0):i.cloneNode(!0);if(t){var o=Gt(a),l=a.lastChild;xt(o,l)}else xt(a,a);return a}}function Ju(r,e){var t=Ie(r,e);return()=>Vu(t())}function Vu(r){if(re)return r;const e=r.nodeType===11,t=r.tagName==="SCRIPT"?[r]:r.querySelectorAll("script"),n=Y;for(const s of t){const a=document.createElement("script");for(var i of s.attributes)a.setAttribute(i.name,i.value);a.textContent=s.textContent,(e?r.firstChild===s:r===s)&&(n.nodes_start=a),(e?r.lastChild===s:r===s)&&(n.nodes_end=a),s.replaceWith(a)}return r}function $u(r=""){if(!re){var e=Nt(r+"");return xt(e,e),e}var t=te;return t.nodeType!==3&&(t.before(t=Nt()),et(t)),xt(t,t),t}function at(){if(re)return xt(te,null),te;var r=document.createDocumentFragment(),e=document.createComment(""),t=Nt();return r.append(e,t),xt(e,t),r}function Z(r,e){if(re){Y.nodes_end=te,li();return}r!==null&&r.before(e)}function Dt(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function wo(r,e){return vo(r,e)}function Wu(r,e){Di(),e.intro=e.intro??!1;const t=e.target,n=re,i=te;try{for(var s=Gt(t);s&&(s.nodeType!==8||s.data!==es);)s=ft(s);if(!s)throw Ar;Ft(!0),et(s),li();const a=vo(r,{...e,anchor:s});if(te===null||te.nodeType!==8||te.data!==Va)throw ts(),Ar;return Ft(!1),a}catch(a){if(a===Ar)return e.recover===!1&&Gl(),Di(),cu(t),Ft(!1),wo(r,e);throw a}finally{Ft(n),et(i),Bu()}}const Kt=new Map;function vo(r,{target:e,anchor:t,props:n={},events:i,context:s,intro:a=!0}){Di();var o=new Set,l=c=>{for(var h=0;h<c.length;h++){var p=c[h];if(!o.has(p)){o.add(p);var y=Du(p);e.addEventListener(p,Or,{passive:y});var m=Kt.get(p);m===void 0?(document.addEventListener(p,Or,{passive:y}),Kt.set(p,1)):Kt.set(p,m+1)}}};l(Ml(Mu)),Js.add(l);var u=void 0,f=gu(()=>{var c=t??e.appendChild(Nt());return xr(()=>{if(s){ai({});var h=pe;h.c=s}i&&(n.$$events=i),re&&xt(c,null),u=r(c,n)||{},re&&(Y.nodes_end=te),s&&oi()}),()=>{var y;for(var h of o){e.removeEventListener(h,Or);var p=Kt.get(h);--p===0?(document.removeEventListener(h,Or),Kt.delete(h)):Kt.set(h,p)}Js.delete(l),c!==t&&((y=c.parentNode)==null||y.removeChild(c))}});return qi.set(u,f),u}let qi=new WeakMap;function Hu(r,e){const t=qi.get(r);return t?(qi.delete(r),t(e)):Promise.resolve()}function ot(r,e,t=!1){re&&li();var n=r,i=null,s=null,a=Pe,o=t?cn:0,l=!1;const u=(c,h=!0)=>{l=!0,f(h,c)},f=(c,h)=>{if(a===(a=c))return;let p=!1;if(re){const y=n.data===Ja;!!a===y&&(n=fu(),et(n),Ft(!1),p=!0)}a?(i?qs(i):h&&(i=xr(()=>h(n))),s&&Nn(s,()=>{s=null})):(s?qs(s):h&&(s=xr(()=>h(n))),i&&Nn(i,()=>{i=null})),p&&Ft(!0)};hn(()=>{l=!1,e(u),l||f(null,null)},o),re&&(n=te)}function _o(r,e,...t){var n=r,i=Tr,s;hn(()=>{i!==(i=e())&&(s&&(Mt(s),s=null),s=xr(()=>i(n,...t)))},cn),re&&(n=te)}function wr(r,e,t){re&&li();var n=r,i,s;hn(()=>{i!==(i=e())&&(s&&(Nn(s),s=null),i&&(s=xr(()=>t(n,i))))},cn),re&&(n=te)}function Gu(r){if(re){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;Xe(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var i=r.checked;Xe(r,"checked",null),r.checked=i}}};r.__on_r=t,bu(t),mo()}}function Xe(r,e,t,n){var i=r.__attributes??(r.__attributes={});re&&(i[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[Jl]=t),t==null?r.removeAttribute(e):typeof t!="string"&&zu(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var Vs=new Map;function zu(r){var e=Vs.get(r.nodeName);if(e)return e;Vs.set(r.nodeName,e=[]);for(var t,n=r,i=Element.prototype;i!==n;){t=Na(n);for(var s in t)t[s].set&&e.push(s);n=Yi(n)}return e}function Qu(r,e,t=e){var n=dn();Nu(r,"input",i=>{var s=i?r.defaultValue:r.value;if(s=_i(r)?bi(s):s,t(s),n&&s!==(s=e())){var a=r.selectionStart,o=r.selectionEnd;r.value=s??"",o!==null&&(r.selectionStart=a,r.selectionEnd=Math.min(o,r.value.length))}}),(re&&r.defaultValue!==r.value||fr(e)==null&&r.value)&&t(_i(r)?bi(r.value):r.value),ns(()=>{var i=e();_i(r)&&i===bi(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function _i(r){var e=r.type;return e==="number"||e==="range"}function bi(r){return r===""?null:+r}function $s(r,e){return r===e||(r==null?void 0:r[$t])===e}function vr(r={},e,t,n){return rs(()=>{var i,s;return ns(()=>{i=s,s=[],fr(()=>{r!==t(...s)&&(e(r,...s),i&&$s(t(...i),r)&&e(null,...i))})}),()=>{so(()=>{s&&$s(t(...s),r)&&e(null,...s)})}}),r}function Ku(r=!1){const e=pe,t=e.l.u;if(!t)return;let n=()=>Ru(e.s);if(r){let i=0,s={};const a=$e(()=>{let o=!1;const l=e.s;for(const u in l)l[u]!==s[u]&&(s[u]=l[u],o=!0);return o&&i++,i});n=()=>H(a)}t.b.length&&Ya(()=>{Ws(e,n),Fn(t.b)}),Dn(()=>{const i=fr(()=>t.m.map(Bl));return()=>{for(const s of i)typeof s=="function"&&s()}}),t.a.length&&Dn(()=>{Ws(e,n),Fn(t.a)})}function Ws(r,e){if(r.l.s)for(const t of r.l.s)H(t);e()}const Yt=[];function os(r,e=Tr){let t=null;const n=new Set;function i(o){if(Ua(r,o)&&(r=o,t)){const l=!Yt.length;for(const u of n)u[1](),Yt.push(u,r);if(l){for(let u=0;u<Yt.length;u+=2)Yt[u][0](Yt[u+1]);Yt.length=0}}}function s(o){i(o(r))}function a(o,l=Tr){const u=[o,l];return n.add(u),n.size===1&&(t=e(i,s)||Tr),o(r),()=>{n.delete(u),n.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:a}}let gn=!1;function Yu(r){var e=gn;try{return gn=!1,[r(),gn]}finally{gn=e}}function Hs(r){for(var e=Y,t=Y;e!==null&&!(e.f&(ht|pr));)e=e.parent;try{return ct(e),r()}finally{ct(t)}}function Rt(r,e,t,n){var R;var i=(t&eu)!==0,s=!mr||(t&tu)!==0,a=(t&nu)!==0,o=(t&iu)!==0,l=!1,u;a?[u,l]=Yu(()=>r[e]):u=r[e];var f=$t in r||Ba in r,c=a&&(((R=nr(r,e))==null?void 0:R.set)??(f&&e in r&&(x=>r[e]=x)))||void 0,h=n,p=!0,y=!1,m=()=>(y=!0,p&&(p=!1,o?h=fr(n):h=n),h);u===void 0&&n!==void 0&&(c&&s&&zl(),u=m(),c&&c(u));var g;if(s)g=()=>{var x=r[e];return x===void 0?m():(p=!0,y=!1,x)};else{var k=Hs(()=>(i?$e:du)(()=>r[e]));k.f|=Ul,g=()=>{var x=H(k);return x!==void 0&&(h=void 0),x===void 0?h:x}}if(!(t&ru))return g;if(c){var T=r.$$legacy;return function(x,S){return arguments.length>0?((!s||!S||T||l)&&c(S?g():x),x):g()}}var M=!1,b=!1,_=$a(u),O=Hs(()=>$e(()=>{var x=g(),S=H(_);return M?(M=!1,b=!0,S):(b=!1,_.v=x)}));return i||(O.equals=Zi),function(x,S){if(arguments.length>0){const E=S?H(O):s&&a?bt(x):x;return O.equals(E)||(M=!0,ce(_,E),y&&h!==void 0&&(h=E),fr(()=>H(O))),x}return H(O)}}function Xu(r){return class extends Zu{constructor(e){super({component:r,...e})}}}var _t,Je;class Zu{constructor(e){he(this,_t);he(this,Je);var s;var t=new Map,n=(a,o)=>{var l=$a(o);return t.set(a,l),l};const i=new Proxy({...e.props||{},$$events:{}},{get(a,o){return H(t.get(o)??n(o,Reflect.get(a,o)))},has(a,o){return o===Ba?!0:(H(t.get(o)??n(o,Reflect.get(a,o))),Reflect.has(a,o))},set(a,o,l){return ce(t.get(o)??n(o,l),l),Reflect.set(a,o,l)}});Ne(this,Je,(e.hydrate?Wu:wo)(e.component,{target:e.target,anchor:e.anchor,props:i,context:e.context,intro:e.intro??!1,recover:e.recover})),(!((s=e==null?void 0:e.props)!=null&&s.$$host)||e.sync===!1)&&as(),Ne(this,_t,i.$$events);for(const a of Object.keys(V(this,Je)))a==="$set"||a==="$destroy"||a==="$on"||Da(this,a,{get(){return V(this,Je)[a]},set(o){V(this,Je)[a]=o},enumerable:!0});V(this,Je).$set=a=>{Object.assign(i,a)},V(this,Je).$destroy=()=>{Hu(V(this,Je))}}$set(e){V(this,Je).$set(e)}$on(e,t){V(this,_t)[e]=V(this,_t)[e]||[];const n=(...i)=>t.call(this,...i);return V(this,_t)[e].push(n),()=>{V(this,_t)[e]=V(this,_t)[e].filter(i=>i!==n)}}$destroy(){V(this,Je).$destroy()}}_t=new WeakMap,Je=new WeakMap;function Bi(r){pe===null&&ou(),mr&&pe.l!==null?ef(pe).m.push(r):Dn(()=>{const e=fr(r);if(typeof e=="function")return e})}function ef(r){var e=r.l;return e.u??(e.u={a:[],b:[],m:[]})}new URL("sveltekit-internal://");function tf(r,e){return r==="/"||e==="ignore"?r:e==="never"?r.endsWith("/")?r.slice(0,-1):r:e==="always"&&!r.endsWith("/")?r+"/":r}function rf(r){return r.split("%25").map(decodeURI).join("%25")}function nf(r){for(const e in r)r[e]=decodeURIComponent(r[e]);return r}function Ii({href:r}){return r.split("#")[0]}function sf(r,e,t,n=!1){const i=new URL(r);Object.defineProperty(i,"searchParams",{value:new Proxy(i.searchParams,{get(a,o){if(o==="get"||o==="getAll"||o==="has")return u=>(t(u),a[o](u));e();const l=Reflect.get(a,o);return typeof l=="function"?l.bind(a):l}}),enumerable:!0,configurable:!0});const s=["href","pathname","search","toString","toJSON"];n&&s.push("hash");for(const a of s)Object.defineProperty(i,a,{get(){return e(),r[a]},enumerable:!0,configurable:!0});return i}function af(...r){let e=5381;for(const t of r)if(typeof t=="string"){let n=t.length;for(;n;)e=e*33^t.charCodeAt(--n)}else if(ArrayBuffer.isView(t)){const n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);let i=n.length;for(;i;)e=e*33^n[--i]}else throw new TypeError("value must be a string or TypedArray");return(e>>>0).toString(36)}function of(r){const e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer}const lf=window.fetch;window.fetch=(r,e)=>((r instanceof Request?r.method:(e==null?void 0:e.method)||"GET")!=="GET"&&Fr.delete(ls(r)),lf(r,e));const Fr=new Map;function uf(r,e){const t=ls(r,e),n=document.querySelector(t);if(n!=null&&n.textContent){let{body:i,...s}=JSON.parse(n.textContent);const a=n.getAttribute("data-ttl");return a&&Fr.set(t,{body:i,init:s,ttl:1e3*Number(a)}),n.getAttribute("data-b64")!==null&&(i=of(i)),Promise.resolve(new Response(i,s))}return window.fetch(r,e)}function ff(r,e,t){if(Fr.size>0){const n=ls(r,t),i=Fr.get(n);if(i){if(performance.now()<i.ttl&&["default","force-cache","only-if-cached",void 0].includes(t==null?void 0:t.cache))return new Response(i.body,i.init);Fr.delete(n)}}return window.fetch(e,t)}function ls(r,e){let n=`script[data-sveltekit-fetched][data-url=${JSON.stringify(r instanceof Request?r.url:r)}]`;if(e!=null&&e.headers||e!=null&&e.body){const i=[];e.headers&&i.push([...new Headers(e.headers)].join(",")),e.body&&(typeof e.body=="string"||ArrayBuffer.isView(e.body))&&i.push(e.body),n+=`[data-hash="${af(...i)}"]`}return n}const cf=/^(\[)?(\.\.\.)?(\w+)(?:=(\w+))?(\])?$/;function df(r){const e=[];return{pattern:r==="/"?/^\/$/:new RegExp(`^${pf(r).map(n=>{const i=/^\[\.\.\.(\w+)(?:=(\w+))?\]$/.exec(n);if(i)return e.push({name:i[1],matcher:i[2],optional:!1,rest:!0,chained:!0}),"(?:/(.*))?";const s=/^\[\[(\w+)(?:=(\w+))?\]\]$/.exec(n);if(s)return e.push({name:s[1],matcher:s[2],optional:!0,rest:!1,chained:!0}),"(?:/([^/]+))?";if(!n)return;const a=n.split(/\[(.+?)\](?!\])/);return"/"+a.map((l,u)=>{if(u%2){if(l.startsWith("x+"))return Oi(String.fromCharCode(parseInt(l.slice(2),16)));if(l.startsWith("u+"))return Oi(String.fromCharCode(...l.slice(2).split("-").map(m=>parseInt(m,16))));const f=cf.exec(l),[,c,h,p,y]=f;return e.push({name:p,matcher:y,optional:!!c,rest:!!h,chained:h?u===1&&a[0]==="":!1}),h?"(.*?)":c?"([^/]*)?":"([^/]+?)"}return Oi(l)}).join("")}).join("")}/?$`),params:e}}function hf(r){return!/^\([^)]+\)$/.test(r)}function pf(r){return r.slice(1).split("/").filter(hf)}function yf(r,e,t){const n={},i=r.slice(1),s=i.filter(o=>o!==void 0);let a=0;for(let o=0;o<e.length;o+=1){const l=e[o];let u=i[o-a];if(l.chained&&l.rest&&a&&(u=i.slice(o-a,o+1).filter(f=>f).join("/"),a=0),u===void 0){l.rest&&(n[l.name]="");continue}if(!l.matcher||t[l.matcher](u)){n[l.name]=u;const f=e[o+1],c=i[o+1];f&&!f.rest&&f.optional&&c&&l.chained&&(a=0),!f&&!c&&Object.keys(n).length===s.length&&(a=0);continue}if(l.optional&&l.chained){a++;continue}return}if(!a)return n}function Oi(r){return r.normalize().replace(/[[\]]/g,"\\$&").replace(/%/g,"%25").replace(/\//g,"%2[Ff]").replace(/\?/g,"%3[Ff]").replace(/#/g,"%23").replace(/[.*+?^${}()|\\]/g,"\\$&")}function mf({nodes:r,server_loads:e,dictionary:t,matchers:n}){const i=new Set(e);return Object.entries(t).map(([o,[l,u,f]])=>{const{pattern:c,params:h}=df(o),p={id:o,exec:y=>{const m=c.exec(y);if(m)return yf(m,h,n)},errors:[1,...f||[]].map(y=>r[y]),layouts:[0,...u||[]].map(a),leaf:s(l)};return p.errors.length=p.layouts.length=Math.max(p.errors.length,p.layouts.length),p});function s(o){const l=o<0;return l&&(o=~o),[l,r[o]]}function a(o){return o===void 0?o:[i.has(o),r[o]]}}function bo(r,e=JSON.parse){try{return e(sessionStorage[r])}catch{}}function Gs(r,e,t=JSON.stringify){const n=t(e);try{sessionStorage[r]=n}catch{}}var Ta;const Be=((Ta=globalThis.__sveltekit_1jzykgj)==null?void 0:Ta.base)??"/api/ff";var Aa;const gf=((Aa=globalThis.__sveltekit_1jzykgj)==null?void 0:Aa.assets)??Be,wf="1739190572367",Io="sveltekit:snapshot",Oo="sveltekit:scroll",ko="sveltekit:states",vf="sveltekit:pageurl",ar="sveltekit:history",Mr="sveltekit:navigation",jn={tap:1,hover:2,viewport:3,eager:4,off:-1,false:-1},yn=location.origin;function Eo(r){if(r instanceof URL)return r;let e=document.baseURI;if(!e){const t=document.getElementsByTagName("base");e=t.length?t[0].href:document.URL}return new URL(r,e)}function us(){return{x:pageXOffset,y:pageYOffset}}function Xt(r,e){return r.getAttribute(`data-sveltekit-${e}`)}const zs={...jn,"":jn.hover};function Co(r){let e=r.assignedSlot??r.parentNode;return(e==null?void 0:e.nodeType)===11&&(e=e.host),e}function So(r,e){for(;r&&r!==e;){if(r.nodeName.toUpperCase()==="A"&&r.hasAttribute("href"))return r;r=Co(r)}}function ji(r,e,t){let n;try{if(n=new URL(r instanceof SVGAElement?r.href.baseVal:r.href,document.baseURI),t&&n.hash.match(/^#[^/]/)){const o=location.hash.split("#")[1]||"/";n.hash=`#${o}${n.hash}`}}catch{}const i=r instanceof SVGAElement?r.target.baseVal:r.target,s=!n||!!i||ci(n,e,t)||(r.getAttribute("rel")||"").split(/\s+/).includes("external"),a=(n==null?void 0:n.origin)===yn&&r.hasAttribute("download");return{url:n,external:s,target:i,download:a}}function Un(r){let e=null,t=null,n=null,i=null,s=null,a=null,o=r;for(;o&&o!==document.documentElement;)n===null&&(n=Xt(o,"preload-code")),i===null&&(i=Xt(o,"preload-data")),e===null&&(e=Xt(o,"keepfocus")),t===null&&(t=Xt(o,"noscroll")),s===null&&(s=Xt(o,"reload")),a===null&&(a=Xt(o,"replacestate")),o=Co(o);function l(u){switch(u){case"":case"true":return!0;case"off":case"false":return!1;default:return}}return{preload_code:zs[n??"off"],preload_data:zs[i??"off"],keepfocus:l(e),noscroll:l(t),reload:l(s),replace_state:l(a)}}function Qs(r){const e=os(r);let t=!0;function n(){t=!0,e.update(a=>a)}function i(a){t=!1,e.set(a)}function s(a){let o;return e.subscribe(l=>{(o===void 0||t&&l!==o)&&a(o=l)})}return{notify:n,set:i,subscribe:s}}const To={v:()=>{}};function _f(){const{set:r,subscribe:e}=os(!1);let t;async function n(){clearTimeout(t);try{const i=await fetch(`${gf}/_app/version.json`,{headers:{pragma:"no-cache","cache-control":"no-cache"}});if(!i.ok)return!1;const a=(await i.json()).version!==wf;return a&&(r(!0),To.v(),clearTimeout(t)),a}catch{return!1}}return{subscribe:e,check:n}}function ci(r,e,t){return r.origin!==yn||!r.pathname.startsWith(e)?!0:t?!(r.pathname===e+"/"||r.pathname===e+"/index.html"||r.protocol==="file:"&&r.pathname.replace(/\/[^/]+\.html?$/,"")===e):!1}function Ks(r){const e=If(r),t=new ArrayBuffer(e.length),n=new DataView(t);for(let i=0;i<t.byteLength;i++)n.setUint8(i,e.charCodeAt(i));return t}const bf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function If(r){r.length%4===0&&(r=r.replace(/==?$/,""));let e="",t=0,n=0;for(let i=0;i<r.length;i++)t<<=6,t|=bf.indexOf(r[i]),n+=6,n===24&&(e+=String.fromCharCode((t&16711680)>>16),e+=String.fromCharCode((t&65280)>>8),e+=String.fromCharCode(t&255),t=n=0);return n===12?(t>>=4,e+=String.fromCharCode(t)):n===18&&(t>>=2,e+=String.fromCharCode((t&65280)>>8),e+=String.fromCharCode(t&255)),e}const Of=-1,kf=-2,Ef=-3,Cf=-4,Sf=-5,Tf=-6;function Af(r,e){if(typeof r=="number")return i(r,!0);if(!Array.isArray(r)||r.length===0)throw new Error("Invalid input");const t=r,n=Array(t.length);function i(s,a=!1){if(s===Of)return;if(s===Ef)return NaN;if(s===Cf)return 1/0;if(s===Sf)return-1/0;if(s===Tf)return-0;if(a)throw new Error("Invalid input");if(s in n)return n[s];const o=t[s];if(!o||typeof o!="object")n[s]=o;else if(Array.isArray(o))if(typeof o[0]=="string"){const l=o[0],u=e==null?void 0:e[l];if(u)return n[s]=u(i(o[1]));switch(l){case"Date":n[s]=new Date(o[1]);break;case"Set":const f=new Set;n[s]=f;for(let p=1;p<o.length;p+=1)f.add(i(o[p]));break;case"Map":const c=new Map;n[s]=c;for(let p=1;p<o.length;p+=2)c.set(i(o[p]),i(o[p+1]));break;case"RegExp":n[s]=new RegExp(o[1],o[2]);break;case"Object":n[s]=Object(o[1]);break;case"BigInt":n[s]=BigInt(o[1]);break;case"null":const h=Object.create(null);n[s]=h;for(let p=1;p<o.length;p+=2)h[o[p]]=i(o[p+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const p=globalThis[l],y=o[1],m=Ks(y),g=new p(m);n[s]=g;break}case"ArrayBuffer":{const p=o[1],y=Ks(p);n[s]=y;break}default:throw new Error(`Unknown type ${l}`)}}else{const l=new Array(o.length);n[s]=l;for(let u=0;u<o.length;u+=1){const f=o[u];f!==kf&&(l[u]=i(f))}}else{const l={};n[s]=l;for(const u in o){const f=o[u];l[u]=i(f)}}return n[s]}return i(0)}const Ao=new Set(["load","prerender","csr","ssr","trailingSlash","config"]);[...Ao];const Ff=new Set([...Ao]);[...Ff];function Pf(r){return r.filter(e=>e!=null)}class di{constructor(e,t){this.status=e,typeof t=="string"?this.body={message:t}:t?this.body=t:this.body={message:`Error: ${e}`}}toString(){return JSON.stringify(this.body)}}class fs{constructor(e,t){this.status=e,this.location=t}}class cs extends Error{constructor(e,t,n){super(n),this.status=e,this.text=t}}const Rf="x-sveltekit-invalidated",xf="x-sveltekit-trailing-slash";function Jn(r){return r instanceof di||r instanceof cs?r.status:500}function Df(r){return r instanceof cs?r.text:"Internal Error"}let ye,Lr,kn;const Nf=Bi.toString().includes("$$")||/function \w+\(\) \{\}/.test(Bi.toString());var Vr,$r,Wr,Hr,Gr,zr,Qr,Kr,Fa,Yr,Pa,Xr,Ra;Nf?(ye={data:{},form:null,error:null,params:{},route:{id:null},state:{},status:-1,url:new URL("https://example.com")},Lr={current:null},kn={current:!1}):(ye=new(Fa=class{constructor(){he(this,Vr,Ce({}));he(this,$r,Ce(null));he(this,Wr,Ce(null));he(this,Hr,Ce({}));he(this,Gr,Ce({id:null}));he(this,zr,Ce({}));he(this,Qr,Ce(-1));he(this,Kr,Ce(new URL("https://example.com")))}get data(){return H(V(this,Vr))}set data(e){ce(V(this,Vr),e)}get form(){return H(V(this,$r))}set form(e){ce(V(this,$r),e)}get error(){return H(V(this,Wr))}set error(e){ce(V(this,Wr),e)}get params(){return H(V(this,Hr))}set params(e){ce(V(this,Hr),e)}get route(){return H(V(this,Gr))}set route(e){ce(V(this,Gr),e)}get state(){return H(V(this,zr))}set state(e){ce(V(this,zr),e)}get status(){return H(V(this,Qr))}set status(e){ce(V(this,Qr),e)}get url(){return H(V(this,Kr))}set url(e){ce(V(this,Kr),e)}},Vr=new WeakMap,$r=new WeakMap,Wr=new WeakMap,Hr=new WeakMap,Gr=new WeakMap,zr=new WeakMap,Qr=new WeakMap,Kr=new WeakMap,Fa),Lr=new(Pa=class{constructor(){he(this,Yr,Ce(null))}get current(){return H(V(this,Yr))}set current(e){ce(V(this,Yr),e)}},Yr=new WeakMap,Pa),kn=new(Ra=class{constructor(){he(this,Xr,Ce(!1))}get current(){return H(V(this,Xr))}set current(e){ce(V(this,Xr),e)}},Xr=new WeakMap,Ra),To.v=()=>kn.current=!0);function Mf(r){Object.assign(ye,r)}const Lf="/__data.json",qf=".html__data.json";function Bf(r){return r.endsWith(".html")?r.replace(/\.html$/,qf):r.replace(/\/$/,"")+Lf}const jf=new Set(["icon","shortcut icon","apple-touch-icon"]),zt=bo(Oo)??{},qr=bo(Io)??{},Et={url:Qs({}),page:Qs({}),navigating:os(null),updated:_f()};function ds(r){zt[r]=us()}function Uf(r,e){let t=r+1;for(;zt[t];)delete zt[t],t+=1;for(t=e+1;qr[t];)delete qr[t],t+=1}function cr(r){return location.href=r.href,new Promise(()=>{})}async function Fo(){if("serviceWorker"in navigator){const r=await navigator.serviceWorker.getRegistration(Be||"/");r&&await r.update()}}function Ys(){}let hs,Ui,Vn,It,Ji,ge;const $n=[],Wn=[];let Ve=null;const Po=new Set,Jf=new Set,Pr=new Set;let oe={branch:[],error:null,url:null},ps=!1,Hn=!1,Xs=!0,Br=!1,_r=!1,Ro=!1,ys=!1,xo,ke,We,jt;const Rr=new Set;async function Vf(r,e,t){var i,s,a,o;document.URL!==location.href&&(location.href=location.href),ge=r,await((s=(i=r.hooks).init)==null?void 0:s.call(i)),hs=mf(r),It=document.documentElement,Ji=e,Ui=r.nodes[0],Vn=r.nodes[1],Ui(),Vn(),ke=(a=history.state)==null?void 0:a[ar],We=(o=history.state)==null?void 0:o[Mr],ke||(ke=We=Date.now(),history.replaceState({...history.state,[ar]:ke,[Mr]:We},""));const n=zt[ke];n&&(history.scrollRestoration="manual",scrollTo(n.x,n.y)),t?await ec(Ji,t):Yf(ge.hash?Vo(new URL(location.href)):location.href,{replaceState:!0}),Zf()}function $f(){$n.length=0,ys=!1}function Do(r){Wn.some(e=>e==null?void 0:e.snapshot)&&(qr[r]=Wn.map(e=>{var t;return(t=e==null?void 0:e.snapshot)==null?void 0:t.capture()}))}function No(r){var e;(e=qr[r])==null||e.forEach((t,n)=>{var i,s;(s=(i=Wn[n])==null?void 0:i.snapshot)==null||s.restore(t)})}function Zs(){ds(ke),Gs(Oo,zt),Do(We),Gs(Io,qr)}async function ms(r,e,t,n){return kr({type:"goto",url:Eo(r),keepfocus:e.keepFocus,noscroll:e.noScroll,replace_state:e.replaceState,state:e.state,redirect_count:t,nav_token:n,accept:()=>{e.invalidateAll&&(ys=!0),e.invalidate&&e.invalidate.forEach(Xf)}})}async function Wf(r){if(r.id!==(Ve==null?void 0:Ve.id)){const e={};Rr.add(e),Ve={id:r.id,token:e,promise:Lo({...r,preload:e}).then(t=>(Rr.delete(e),t.type==="loaded"&&t.state.error&&(Ve=null),t))}}return Ve.promise}async function ki(r){var t;const e=(t=await pi(r,!1))==null?void 0:t.route;e&&await Promise.all([...e.layouts,e.leaf].map(n=>n==null?void 0:n[1]()))}function Mo(r,e,t){var s;oe=r.state;const n=document.querySelector("style[data-sveltekit]");n&&n.remove(),Object.assign(ye,r.props.page),xo=new ge.root({target:e,props:{...r.props,stores:Et,components:Wn},hydrate:t,sync:!1}),No(We);const i={from:null,to:{params:oe.params,route:{id:((s=oe.route)==null?void 0:s.id)??null},url:new URL(location.href)},willUnload:!1,type:"enter",complete:Promise.resolve()};Pr.forEach(a=>a(i)),Hn=!0}function Gn({url:r,params:e,branch:t,status:n,error:i,route:s,form:a}){let o="never";if(Be&&(r.pathname===Be||r.pathname===Be+"/"))o="always";else for(const p of t)(p==null?void 0:p.slash)!==void 0&&(o=p.slash);r.pathname=tf(r.pathname,o),r.search=r.search;const l={type:"loaded",state:{url:r,params:e,branch:t,error:i,route:s},props:{constructors:Pf(t).map(p=>p.node.component),page:vs(ye)}};a!==void 0&&(l.props.form=a);let u={},f=!ye,c=0;for(let p=0;p<Math.max(t.length,oe.branch.length);p+=1){const y=t[p],m=oe.branch[p];(y==null?void 0:y.data)!==(m==null?void 0:m.data)&&(f=!0),y&&(u={...u,...y.data},f&&(l.props[`data_${c}`]=u),c+=1)}return(!oe.url||r.href!==oe.url.href||oe.error!==i||a!==void 0&&a!==ye.form||f)&&(l.props.page={error:i,params:e,route:{id:(s==null?void 0:s.id)??null},state:{},status:n,url:new URL(r),form:a??null,data:f?u:ye.data}),l}async function gs({loader:r,parent:e,url:t,params:n,route:i,server_data_node:s}){var f,c,h;let a=null,o=!0;const l={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},u=await r();if((f=u.universal)!=null&&f.load){let p=function(...m){for(const g of m){const{href:k}=new URL(g,t);l.dependencies.add(k)}};const y={route:new Proxy(i,{get:(m,g)=>(o&&(l.route=!0),m[g])}),params:new Proxy(n,{get:(m,g)=>(o&&l.params.add(g),m[g])}),data:(s==null?void 0:s.data)??null,url:sf(t,()=>{o&&(l.url=!0)},m=>{o&&l.search_params.add(m)},ge.hash),async fetch(m,g){let k;m instanceof Request?(k=m.url,g={body:m.method==="GET"||m.method==="HEAD"?void 0:await m.blob(),cache:m.cache,credentials:m.credentials,headers:[...m.headers].length?m.headers:void 0,integrity:m.integrity,keepalive:m.keepalive,method:m.method,mode:m.mode,redirect:m.redirect,referrer:m.referrer,referrerPolicy:m.referrerPolicy,signal:m.signal,...g}):k=m;const T=new URL(k,t);return o&&p(T.href),T.origin===t.origin&&(k=T.href.slice(t.origin.length)),Hn?ff(k,T.href,g):uf(k,g)},setHeaders:()=>{},depends:p,parent(){return o&&(l.parent=!0),e()},untrack(m){o=!1;try{return m()}finally{o=!0}}};a=await u.universal.load.call(null,y)??null}return{node:u,loader:r,server:s,universal:(c=u.universal)!=null&&c.load?{type:"data",data:a,uses:l}:null,data:a??(s==null?void 0:s.data)??null,slash:((h=u.universal)==null?void 0:h.trailingSlash)??(s==null?void 0:s.slash)}}function ea(r,e,t,n,i,s){if(ys)return!0;if(!i)return!1;if(i.parent&&r||i.route&&e||i.url&&t)return!0;for(const a of i.search_params)if(n.has(a))return!0;for(const a of i.params)if(s[a]!==oe.params[a])return!0;for(const a of i.dependencies)if($n.some(o=>o(new URL(a))))return!0;return!1}function ws(r,e){return(r==null?void 0:r.type)==="data"?r:(r==null?void 0:r.type)==="skip"?e??null:null}function Hf(r,e){if(!r)return new Set(e.searchParams.keys());const t=new Set([...r.searchParams.keys(),...e.searchParams.keys()]);for(const n of t){const i=r.searchParams.getAll(n),s=e.searchParams.getAll(n);i.every(a=>s.includes(a))&&s.every(a=>i.includes(a))&&t.delete(n)}return t}function ta({error:r,url:e,route:t,params:n}){return{type:"loaded",state:{error:r,url:e,route:t,params:n,branch:[]},props:{page:vs(ye),constructors:[]}}}async function Lo({id:r,invalidating:e,url:t,params:n,route:i,preload:s}){if((Ve==null?void 0:Ve.id)===r)return Rr.delete(Ve.token),Ve.promise;const{errors:a,layouts:o,leaf:l}=i,u=[...o,l];a.forEach(b=>b==null?void 0:b().catch(()=>{})),u.forEach(b=>b==null?void 0:b[1]().catch(()=>{}));let f=null;const c=oe.url?r!==zn(oe.url):!1,h=oe.route?i.id!==oe.route.id:!1,p=Hf(oe.url,t);let y=!1;const m=u.map((b,_)=>{var x;const O=oe.branch[_],R=!!(b!=null&&b[0])&&((O==null?void 0:O.loader)!==b[1]||ea(y,h,c,p,(x=O.server)==null?void 0:x.uses,n));return R&&(y=!0),R});if(m.some(Boolean)){try{f=await jo(t,m)}catch(b){const _=await or(b,{url:t,params:n,route:{id:r}});return Rr.has(s)?ta({error:_,url:t,params:n,route:i}):hi({status:Jn(b),error:_,url:t,route:i})}if(f.type==="redirect")return f}const g=f==null?void 0:f.nodes;let k=!1;const T=u.map(async(b,_)=>{var S;if(!b)return;const O=oe.branch[_],R=g==null?void 0:g[_];if((!R||R.type==="skip")&&b[1]===(O==null?void 0:O.loader)&&!ea(k,h,c,p,(S=O.universal)==null?void 0:S.uses,n))return O;if(k=!0,(R==null?void 0:R.type)==="error")throw R;return gs({loader:b[1],url:t,params:n,route:i,parent:async()=>{var A;const E={};for(let v=0;v<_;v+=1)Object.assign(E,(A=await T[v])==null?void 0:A.data);return E},server_data_node:ws(R===void 0&&b[0]?{type:"skip"}:R??null,b[0]?O==null?void 0:O.server:void 0)})});for(const b of T)b.catch(()=>{});const M=[];for(let b=0;b<u.length;b+=1)if(u[b])try{M.push(await T[b])}catch(_){if(_ instanceof fs)return{type:"redirect",location:_.location};if(Rr.has(s))return ta({error:await or(_,{params:n,url:t,route:{id:i.id}}),url:t,params:n,route:i});let O=Jn(_),R;if(g!=null&&g.includes(_))O=_.status??O,R=_.error;else if(_ instanceof di)R=_.body;else{if(await Et.updated.check())return await Fo(),await cr(t);R=await or(_,{params:n,url:t,route:{id:i.id}})}const x=await Gf(b,M,a);return x?Gn({url:t,params:n,branch:M.slice(0,x.idx).concat(x.node),status:O,error:R,route:i}):await Bo(t,{id:i.id},R,O)}else M.push(void 0);return Gn({url:t,params:n,branch:M,status:200,error:null,route:i,form:e?void 0:null})}async function Gf(r,e,t){for(;r--;)if(t[r]){let n=r;for(;!e[n];)n-=1;try{return{idx:n+1,node:{node:await t[r](),loader:t[r],data:{},server:null,universal:null}}}catch{continue}}}async function hi({status:r,error:e,url:t,route:n}){const i={};let s=null;if(ge.server_loads[0]===0)try{const o=await jo(t,[!0]);if(o.type!=="data"||o.nodes[0]&&o.nodes[0].type!=="data")throw 0;s=o.nodes[0]??null}catch{(t.origin!==yn||t.pathname!==location.pathname||ps)&&await cr(t)}try{const o=await gs({loader:Ui,url:t,params:i,route:n,parent:()=>Promise.resolve({}),server_data_node:ws(s)}),l={node:await Vn(),loader:Vn,universal:null,server:null,data:null};return Gn({url:t,params:i,branch:[o,l],status:r,error:e,route:null})}catch(o){if(o instanceof fs)return ms(new URL(o.location,location.href),{},0);throw o}}function zf(r){let e;try{if(e=ge.hooks.reroute({url:new URL(r)})??r,typeof e=="string"){const t=new URL(r);ge.hash?t.hash=e:t.pathname=e,e=t}}catch{return}return e}async function pi(r,e){if(r&&!ci(r,Be,ge.hash)){const t=zf(r);if(!t)return;const n=Qf(t);for(const i of hs){const s=i.exec(n);if(s)return{id:zn(r),invalidating:e,route:i,params:nf(s),url:r}}}}function Qf(r){return rf(ge.hash?r.hash.replace(/^#/,"").replace(/[?#].+/,""):r.pathname.slice(Be.length))||"/"}function zn(r){return(ge.hash?r.hash.replace(/^#/,""):r.pathname)+r.search}function qo({url:r,type:e,intent:t,delta:n}){let i=!1;const s=Jo(oe,t,r,e);n!==void 0&&(s.navigation.delta=n);const a={...s.navigation,cancel:()=>{i=!0,s.reject(new Error("navigation cancelled"))}};return Br||Po.forEach(o=>o(a)),i?null:s}async function kr({type:r,url:e,popped:t,keepfocus:n,noscroll:i,replace_state:s,state:a={},redirect_count:o=0,nav_token:l={},accept:u=Ys,block:f=Ys}){const c=jt;jt=l;const h=await pi(e,!1),p=qo({url:e,type:r,delta:t==null?void 0:t.delta,intent:h});if(!p){f(),jt===l&&(jt=c);return}const y=ke,m=We;u(),Br=!0,Hn&&Et.navigating.set(Lr.current=p.navigation);let g=h&&await Lo(h);if(!g){if(ci(e,Be,ge.hash))return await cr(e);g=await Bo(e,{id:null},await or(new cs(404,"Not Found",`Not found: ${e.pathname}`),{url:e,params:{},route:{id:null}}),404)}if(e=(h==null?void 0:h.url)||e,jt!==l)return p.reject(new Error("navigation aborted")),!1;if(g.type==="redirect")if(o>=20)g=await hi({status:500,error:await or(new Error("Redirect loop"),{url:e,params:{},route:{id:null}}),url:e,route:{id:null}});else return ms(new URL(g.location,e).href,{},o+1,l),!1;else g.props.page.status>=400&&await Et.updated.check()&&(await Fo(),await cr(e));if($f(),ds(y),Do(m),g.props.page.url.pathname!==e.pathname&&(e.pathname=g.props.page.url.pathname),a=t?t.state:a,!t){const b=s?0:1,_={[ar]:ke+=b,[Mr]:We+=b,[ko]:a};(s?history.replaceState:history.pushState).call(history,_,"",e),s||Uf(ke,We)}if(Ve=null,g.props.page.state=a,Hn){oe=g.state,g.props.page&&(g.props.page.url=e);const b=(await Promise.all(Array.from(Jf,_=>_(p.navigation)))).filter(_=>typeof _=="function");if(b.length>0){let _=function(){b.forEach(O=>{Pr.delete(O)})};b.push(_),b.forEach(O=>{Pr.add(O)})}xo.$set(g.props),Mf(g.props.page),Ro=!0}else Mo(g,Ji,!1);const{activeElement:k}=document;await yo();const T=t?t.scroll:i?us():null;if(Xs){const b=e.hash&&document.getElementById(decodeURIComponent(ge.hash?e.hash.split("#")[2]??"":e.hash.slice(1)));T?scrollTo(T.x,T.y):b?b.scrollIntoView():scrollTo(0,0)}const M=document.activeElement!==k&&document.activeElement!==document.body;!n&&!M&&tc(),Xs=!0,g.props.page&&Object.assign(ye,g.props.page),Br=!1,r==="popstate"&&No(We),p.fulfil(void 0),Pr.forEach(b=>b(p.navigation)),Et.navigating.set(Lr.current=null)}async function Bo(r,e,t,n){return r.origin===yn&&r.pathname===location.pathname&&!ps?await hi({status:n,error:t,url:r,route:e}):await cr(r)}function Kf(){let r,e;It.addEventListener("mousemove",a=>{const o=a.target;clearTimeout(r),r=setTimeout(()=>{i(o,2)},20)});function t(a){a.defaultPrevented||i(a.composedPath()[0],1)}It.addEventListener("mousedown",t),It.addEventListener("touchstart",t,{passive:!0});const n=new IntersectionObserver(a=>{for(const o of a)o.isIntersecting&&(ki(new URL(o.target.href)),n.unobserve(o.target))},{threshold:0});async function i(a,o){const l=So(a,It);if(!l||l===e)return;e=l;const{url:u,external:f,download:c}=ji(l,Be,ge.hash);if(f||c)return;const h=Un(l),p=u&&zn(oe.url)===zn(u);if(!h.reload&&!p)if(o<=h.preload_data){const y=await pi(u,!1);y&&Wf(y)}else o<=h.preload_code&&ki(u)}function s(){n.disconnect();for(const a of It.querySelectorAll("a")){const{url:o,external:l,download:u}=ji(a,Be,ge.hash);if(l||u)continue;const f=Un(a);f.reload||(f.preload_code===jn.viewport&&n.observe(a),f.preload_code===jn.eager&&ki(o))}}Pr.add(s),s()}function or(r,e){if(r instanceof di)return r.body;const t=Jn(r),n=Df(r);return ge.hooks.handleError({error:r,event:e,status:t,message:n})??{message:n}}function Yf(r,e={}){return r=new URL(Eo(r)),r.origin!==yn?Promise.reject(new Error("goto: invalid URL")):ms(r,e,0)}function Xf(r){if(typeof r=="function")$n.push(r);else{const{href:e}=new URL(r,location.href);$n.push(t=>t.href===e)}}function Zf(){var e;history.scrollRestoration="manual",addEventListener("beforeunload",t=>{let n=!1;if(Zs(),!Br){const i=Jo(oe,void 0,null,"leave"),s={...i.navigation,cancel:()=>{n=!0,i.reject(new Error("navigation cancelled"))}};Po.forEach(a=>a(s))}n?(t.preventDefault(),t.returnValue=""):history.scrollRestoration="auto"}),addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&Zs()}),(e=navigator.connection)!=null&&e.saveData||Kf(),It.addEventListener("click",async t=>{if(t.button||t.which!==1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.defaultPrevented)return;const n=So(t.composedPath()[0],It);if(!n)return;const{url:i,external:s,target:a,download:o}=ji(n,Be,ge.hash);if(!i)return;if(a==="_parent"||a==="_top"){if(window.parent!==window)return}else if(a&&a!=="_self")return;const l=Un(n);if(!(n instanceof SVGAElement)&&i.protocol!==location.protocol&&!(i.protocol==="https:"||i.protocol==="http:")||o)return;const[f,c]=(ge.hash?i.hash.replace(/^#/,""):i.href).split("#"),h=f===Ii(location);if(s||l.reload&&(!h||!c)){qo({url:i,type:"link"})?Br=!0:t.preventDefault();return}if(c!==void 0&&h){const[,p]=oe.url.href.split("#");if(p===c){if(t.preventDefault(),c===""||c==="top"&&n.ownerDocument.getElementById("top")===null)window.scrollTo({top:0});else{const y=n.ownerDocument.getElementById(decodeURIComponent(c));y&&(y.scrollIntoView(),y.focus())}return}if(_r=!0,ds(ke),r(i),!l.replace_state)return;_r=!1}t.preventDefault(),await new Promise(p=>{requestAnimationFrame(()=>{setTimeout(p,0)}),setTimeout(p,100)}),kr({type:"link",url:i,keepfocus:l.keepfocus,noscroll:l.noscroll,replace_state:l.replace_state??i.href===location.href})}),It.addEventListener("submit",t=>{if(t.defaultPrevented)return;const n=HTMLFormElement.prototype.cloneNode.call(t.target),i=t.submitter;if(((i==null?void 0:i.formTarget)||n.target)==="_blank"||((i==null?void 0:i.formMethod)||n.method)!=="get")return;const o=new URL((i==null?void 0:i.hasAttribute("formaction"))&&(i==null?void 0:i.formAction)||n.action);if(ci(o,Be,!1))return;const l=t.target,u=Un(l);if(u.reload)return;t.preventDefault(),t.stopPropagation();const f=new FormData(l),c=i==null?void 0:i.getAttribute("name");c&&f.append(c,(i==null?void 0:i.getAttribute("value"))??""),o.search=new URLSearchParams(f).toString(),kr({type:"form",url:o,keepfocus:u.keepfocus,noscroll:u.noscroll,replace_state:u.replace_state??o.href===location.href})}),addEventListener("popstate",async t=>{var n;if((n=t.state)!=null&&n[ar]){const i=t.state[ar];if(jt={},i===ke)return;const s=zt[i],a=t.state[ko]??{},o=new URL(t.state[vf]??location.href),l=t.state[Mr],u=oe.url?Ii(location)===Ii(oe.url):!1;if(l===We&&(Ro||u)){a!==ye.state&&(ye.state=a),r(o),zt[ke]=us(),s&&scrollTo(s.x,s.y),ke=i;return}const c=i-ke;await kr({type:"popstate",url:o,popped:{state:a,scroll:s,delta:c},accept:()=>{ke=i,We=l},block:()=>{history.go(-c)},nav_token:jt})}else if(!_r){const i=new URL(location.href);r(i)}}),addEventListener("hashchange",()=>{_r?(_r=!1,history.replaceState({...history.state,[ar]:++ke,[Mr]:We},"",location.href)):ge.hash&&oe.url.hash===location.hash&&kr({type:"goto",url:Vo(oe.url)})});for(const t of document.querySelectorAll("link"))jf.has(t.rel)&&(t.href=t.href);addEventListener("pageshow",t=>{t.persisted&&Et.navigating.set(Lr.current=null)});function r(t){oe.url=ye.url=t,Et.page.set(vs(ye)),Et.page.notify()}}async function ec(r,{status:e=200,error:t,node_ids:n,params:i,route:s,server_route:a,data:o,form:l}){ps=!0;const u=new URL(location.href);let f;({params:i={},route:s={id:null}}=await pi(u,!1)||{}),f=hs.find(({id:p})=>p===s.id);let c,h=!0;try{const p=n.map(async(m,g)=>{const k=o[g];return k!=null&&k.uses&&(k.uses=Uo(k.uses)),gs({loader:ge.nodes[m],url:u,params:i,route:s,parent:async()=>{const T={};for(let M=0;M<g;M+=1)Object.assign(T,(await p[M]).data);return T},server_data_node:ws(k)})}),y=await Promise.all(p);if(f){const m=f.layouts;for(let g=0;g<m.length;g++)m[g]||y.splice(g,0,void 0)}c=Gn({url:u,params:i,branch:y,status:e,error:t,form:l,route:f??null})}catch(p){if(p instanceof fs){await cr(new URL(p.location,location.href));return}c=await hi({status:Jn(p),error:await or(p,{url:u,params:i,route:s}),url:u,route:s}),r.textContent="",h=!1}c.props.page&&(c.props.page.state={}),Mo(c,r,h)}async function jo(r,e){var s;const t=new URL(r);t.pathname=Bf(r.pathname),r.pathname.endsWith("/")&&t.searchParams.append(xf,"1"),t.searchParams.append(Rf,e.map(a=>a?"1":"0").join(""));const n=window.fetch,i=await n(t.href,{});if(!i.ok){let a;throw(s=i.headers.get("content-type"))!=null&&s.includes("application/json")?a=await i.json():i.status===404?a="Not Found":i.status===500&&(a="Internal Error"),new di(i.status,a)}return new Promise(async a=>{var h;const o=new Map,l=i.body.getReader(),u=new TextDecoder;function f(p){return Af(p,{...ge.decoders,Promise:y=>new Promise((m,g)=>{o.set(y,{fulfil:m,reject:g})})})}let c="";for(;;){const{done:p,value:y}=await l.read();if(p&&!c)break;for(c+=!y&&c?`
`:u.decode(y,{stream:!0});;){const m=c.indexOf(`
`);if(m===-1)break;const g=JSON.parse(c.slice(0,m));if(c=c.slice(m+1),g.type==="redirect")return a(g);if(g.type==="data")(h=g.nodes)==null||h.forEach(k=>{(k==null?void 0:k.type)==="data"&&(k.uses=Uo(k.uses),k.data=f(k.data))}),a(g);else if(g.type==="chunk"){const{id:k,data:T,error:M}=g,b=o.get(k);o.delete(k),M?b.reject(f(M)):b.fulfil(f(T))}}}})}function Uo(r){return{dependencies:new Set((r==null?void 0:r.dependencies)??[]),params:new Set((r==null?void 0:r.params)??[]),parent:!!(r!=null&&r.parent),route:!!(r!=null&&r.route),url:!!(r!=null&&r.url),search_params:new Set((r==null?void 0:r.search_params)??[])}}function tc(){const r=document.querySelector("[autofocus]");if(r)r.focus();else{const e=document.body,t=e.getAttribute("tabindex");e.tabIndex=-1,e.focus({preventScroll:!0,focusVisible:!1}),t!==null?e.setAttribute("tabindex",t):e.removeAttribute("tabindex");const n=getSelection();if(n&&n.type!=="None"){const i=[];for(let s=0;s<n.rangeCount;s+=1)i.push(n.getRangeAt(s));setTimeout(()=>{if(n.rangeCount===i.length){for(let s=0;s<n.rangeCount;s+=1){const a=i[s],o=n.getRangeAt(s);if(a.commonAncestorContainer!==o.commonAncestorContainer||a.startContainer!==o.startContainer||a.endContainer!==o.endContainer||a.startOffset!==o.startOffset||a.endOffset!==o.endOffset)return}n.removeAllRanges()}})}}}function Jo(r,e,t,n){var l,u;let i,s;const a=new Promise((f,c)=>{i=f,s=c});return a.catch(()=>{}),{navigation:{from:{params:r.params,route:{id:((l=r.route)==null?void 0:l.id)??null},url:r.url},to:t&&{params:(e==null?void 0:e.params)??null,route:{id:((u=e==null?void 0:e.route)==null?void 0:u.id)??null},url:t},willUnload:!e,type:n,complete:a},fulfil:i,reject:s}}function vs(r){return{data:r.data,error:r.error,form:r.form,params:r.params,route:r.route,state:r.state,status:r.status,url:r.url}}function Vo(r){const e=new URL(r);return e.hash=decodeURIComponent(r.hash),e}const rc="modulepreload",nc=function(r){return"/api/ff/"+r},ra={},Bt=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=nc(l),l in ra)return;ra[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":rc,u||(c.as="script"),c.crossOrigin="",c.href=l,o&&c.setAttribute("nonce",o),document.head.appendChild(c),u)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},ic={},sc="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sc);var ac=Ie('<div id="svelte-announcer" aria-live="assertive" aria-atomic="true" style="position: absolute; left: 0; top: 0; clip: rect(0 0 0 0); clip-path: inset(50%); overflow: hidden; white-space: nowrap; width: 1px; height: 1px"><!></div>'),oc=Ie("<!> <!>",1);function lc(r,e){ai(e,!0);let t=Rt(e,"components",23,()=>[]),n=Rt(e,"data_0",3,null),i=Rt(e,"data_1",3,null),s=Rt(e,"data_2",3,null);Ya(()=>e.stores.page.set(e.page)),Dn(()=>{e.stores,e.page,e.constructors,t(),e.form,n(),i(),s(),e.stores.page.notify()});let a=Ce(!1),o=Ce(!1),l=Ce(null);Bi(()=>{const g=e.stores.page.subscribe(()=>{H(a)&&(ce(o,!0),yo().then(()=>{ce(l,bt(document.title||"untitled page"))}))});return ce(a,!0),g});const u=$e(()=>e.constructors[2]);var f=oc(),c=qe(f);{var h=g=>{var k=at();const T=$e(()=>e.constructors[0]);var M=qe(k);wr(M,()=>H(T),(b,_)=>{vr(_(b,{get data(){return n()},get form(){return e.form},children:(O,R)=>{var x=at(),S=qe(x);{var E=v=>{var F=at();const U=$e(()=>e.constructors[1]);var D=qe(F);wr(D,()=>H(U),(L,z)=>{vr(z(L,{get data(){return i()},get form(){return e.form},children:(de,je)=>{var ve=at(),ze=qe(ve);wr(ze,()=>H(u),(St,me)=>{vr(me(St,{get data(){return s()},get form(){return e.form}}),Qe=>t()[2]=Qe,()=>{var Qe;return(Qe=t())==null?void 0:Qe[2]})}),Z(de,ve)},$$slots:{default:!0}}),de=>t()[1]=de,()=>{var de;return(de=t())==null?void 0:de[1]})}),Z(v,F)},A=v=>{var F=at();const U=$e(()=>e.constructors[1]);var D=qe(F);wr(D,()=>H(U),(L,z)=>{vr(z(L,{get data(){return i()},get form(){return e.form}}),de=>t()[1]=de,()=>{var de;return(de=t())==null?void 0:de[1]})}),Z(v,F)};ot(S,v=>{e.constructors[2]?v(E):v(A,!1)})}Z(O,x)},$$slots:{default:!0}}),O=>t()[0]=O,()=>{var O;return(O=t())==null?void 0:O[0]})}),Z(g,k)},p=g=>{var k=at();const T=$e(()=>e.constructors[0]);var M=qe(k);wr(M,()=>H(T),(b,_)=>{vr(_(b,{get data(){return n()},get form(){return e.form}}),O=>t()[0]=O,()=>{var O;return(O=t())==null?void 0:O[0]})}),Z(g,k)};ot(c,g=>{e.constructors[1]?g(h):g(p,!1)})}var y=Le(c,2);{var m=g=>{var k=ac(),T=ae(k);{var M=b=>{var _=$u();wt(()=>Dt(_,H(l))),Z(b,_)};ot(T,b=>{H(o)&&b(M)})}se(k),Z(g,k)};ot(y,g=>{H(a)&&g(m)})}Z(r,f),oi()}const uc=Xu(lc),fc=[()=>Bt(()=>Promise.resolve().then(()=>vc),void 0),()=>Bt(()=>Promise.resolve().then(()=>Oc),void 0),()=>Bt(()=>Promise.resolve().then(()=>Cc),void 0),()=>Bt(()=>Promise.resolve().then(()=>Ac),void 0),()=>Bt(()=>Promise.resolve().then(()=>ch),void 0),()=>Bt(()=>Promise.resolve().then(()=>ph),void 0),()=>Bt(()=>Promise.resolve().then(()=>gh),void 0)],cc=[],dc={"/":[3],"/auth":[4,[2]],"/auth/forgot-password":[5,[2]],"/auth/sign-up":[6,[2]]},$o={handleError:({error:r})=>{console.error(r)},reroute:()=>{},transport:{}},Wo=Object.fromEntries(Object.entries($o.transport).map(([r,e])=>[r,e.decode])),hc=!1,pc=(r,e)=>Wo[r](e),yc=Object.freeze(Object.defineProperty({__proto__:null,decode:pc,decoders:Wo,dictionary:dc,hash:hc,hooks:$o,matchers:ic,nodes:fc,root:uc,server_loads:cc},Symbol.toStringTag,{value:"Module"}));function Ih(r,e){Vf(yc,r,e)}const mc=!0,gc=Object.freeze(Object.defineProperty({__proto__:null,prerender:mc},Symbol.toStringTag,{value:"Module"}));function wc(r,e){var t=at(),n=qe(t);_o(n,()=>e.children),Z(r,t)}const vc=Object.freeze(Object.defineProperty({__proto__:null,component:wc,universal:gc},Symbol.toStringTag,{value:"Module"}));Zl();const _c={get data(){return ye.data},get error(){return ye.error},get form(){return ye.form},get params(){return ye.params},get route(){return ye.route},get state(){return ye.state},get status(){return ye.status},get url(){return ye.url}};Et.updated.check;const Vi=_c;var bc=Ie("<h1> </h1> <p> </p>",1);function Ic(r,e){ai(e,!1),Ku();var t=bc(),n=qe(t),i=ae(n,!0);se(n);var s=Le(n,2),a=ae(s,!0);se(s),wt(()=>{var o;Dt(i,Vi.status),Dt(a,(o=Vi.error)==null?void 0:o.message)}),Z(r,t),oi()}const Oc=Object.freeze(Object.defineProperty({__proto__:null,component:Ic},Symbol.toStringTag,{value:"Module"}));var kc=Ju(`<script>
    window.firstlyData = { coucou: 'coucou2' }
  <\/script><!---->`,1);function Ec(r,e){var t=at();ju(i=>{var s=kc(),a=Le(qe(s));Z(i,s)});var n=qe(t);_o(n,()=>e.children??Tr),Z(r,t)}const Cc=Object.freeze(Object.defineProperty({__proto__:null,component:Ec},Symbol.toStringTag,{value:"Module"}));var Sc=Ie('Nothing here <a href="/api/ff/auth">Sign In</a>',1);function Tc(r){xn();var e=Sc();xn(),Z(r,e)}const Ac=Object.freeze(Object.defineProperty({__proto__:null,component:Tc},Symbol.toStringTag,{value:"Module"}));class Vt{constructor(...e){d(this,"fields");d(this,"options",{});d(this,"target");d(this,"readonly",!0);d(this,"allowNull",!1);d(this,"dbReadOnly",!1);d(this,"isServerExpression",!1);d(this,"key","");d(this,"caption","");d(this,"inputType","");d(this,"dbName","");d(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t=i=>e[i.key];typeof e=="function"&&(t=e);let n="";return this.fields.forEach(i=>{n.length>0&&(n+=","),n+=i.valueConverter.toJson(t(i))}),n}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},i=e.toString().split(",");return this.fields.forEach((s,a)=>{t[s.key]=s.valueConverter.fromJson(i[a])}),t}}function ee(r,e=!0){var n;let t=r[Ut];if(!t&&e)throw new Error("item "+(((n=r.constructor)==null?void 0:n.name)||r)+" was not initialized using a context");return t}const Ut=Symbol.for("entityMember"),Ho=Symbol.for("entityInfo"),Go=Symbol.for("entityInfo_key");function xe(r,e=!0){if(r===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=r[Ho];if(!t&&e)throw new Error(r.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function Fc(r){return r[Go]}function Ei(r,e){return{[zo]:{toType:r,type:e}}}const zo=Symbol.for("relationInfo");function Pc(r){return r==null?void 0:r[zo]}const $i=Symbol.for("fieldRelationInfo");function le(r){if(r)return r[$i]}function Rc(r,e,t){for(const n of r.fields.toArray()){const i=Pc(n.options);if(i&&!n[$i]){const s=i.toType(),a=e.repo(s,t),o=n.options;n[$i]={type:i.type,toEntity:s,options:o,toRepo:a,getFields:()=>{let l=o.field,u={fields:o.fields,compoundIdField:void 0};function f(p){return Error(`Error for relation: "${r.metadata.key}.${n.key}", `+p)}let c=()=>l||u.fields;if(i.type==="toMany"&&!c()){for(const p of a.fields.toArray())if(!c()){const y=le(p),m=p.options;if(y&&y.toEntity===r.metadata.entityType){if(y.type==="reference")l=p.key;else if(y.type==="toOne"){if(m.field)l=m.field;else if(m.fields){let g={};for(const k in m.fields)if(Object.prototype.hasOwnProperty.call(m.fields,k)){const T=m.fields[k];g[T]=k}u.fields=g}}}}if(!c())throw f(`No matching field found on target "${a.metadata.key}". Please specify field/fields`)}function h(p,y){const m=y.fields.find(p);if(!m)throw f(`Field "${p}" was not found in "${y.key}".`);return m}i.type==="reference"&&(l=n.key),l&&(i.type==="toOne"||i.type==="reference"?a.metadata.idMetadata.field instanceof Vt?u.compoundIdField=l:u.fields={[a.metadata.idMetadata.field.key]:l}:r.metadata.idMetadata.field instanceof Vt?u.compoundIdField=l:u.fields={[l]:r.metadata.idMetadata.field.key});for(const p in u.fields)Object.prototype.hasOwnProperty.call(u.fields,p)&&(h(p,a.metadata),h(u.fields[p],r.metadata));return u}}}}}class B{constructor(e){d(this,"apply");this.apply=e}static throwErrorIfFilterIsEmpty(e,t){if(B.isFilterEmpty(e))throw{message:`${t}: requires a filter to protect against accidental delete/update of all rows`,httpStatusCode:400}}static isFilterEmpty(e){if(e.$and){for(const t of e.$and)if(!B.isFilterEmpty(t))return!1}if(e.$or){for(const t of e.$or)if(B.isFilterEmpty(t))return!0;return!1}return Object.keys(e).filter(t=>!["$or","$and"].includes(t)).length==0}static async getPreciseValues(e,t){const n=new Xn;return await B.fromEntityFilter(e,t).__applyToConsumer(n),n.preciseValues}async getPreciseValues(){const e=new Xn;return await this.__applyToConsumer(e),e.preciseValues}static createCustom(e,t=""){let n={key:t,rawFilterTranslator:e};return Object.assign(i=>{if(i==null&&(i={}),!n.key)throw"Usage of custom filter before a key was assigned to it";return{[Wt+n.key]:i}},{rawFilterInfo:n})}static entityFilterToJson(e,t){return B.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return En(e,{get:n=>t[n]})}static fromEntityFilter(e,t){let n=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i];if(i=="$or")n.push(new Nc(...s.map(a=>B.fromEntityFilter(e,a))));else if(i=="$not")n.push(new Mc(B.fromEntityFilter(e,s)));else if(i=="$and")n.push(new na(...s.map(a=>B.fromEntityFilter(e,a))));else if(i.startsWith(Wt))n.push(new B(a=>{a.custom(i.substring(Wt.length),s)}));else if(i==Qo)n.push(new B(a=>a.databaseCustom(s)));else{const a=e.fields[i],o=le(a),l=a.options;let u=(o==null?void 0:o.type)==="toOne"?l.fields?new Dc(a,e.fields,l):new xc(e.fields[l.field]):new Qn(a),f=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const h=s[c];switch(c){case"$gte":case">=":n.push(u.isGreaterOrEqualTo(h)),f=!0;break;case"$gt":case">":n.push(u.isGreaterThan(h)),f=!0;break;case"$lte":case"<=":n.push(u.isLessOrEqualTo(h)),f=!0;break;case"$lt":case"<":n.push(u.isLessThan(h)),f=!0;break;case"$ne":case"$not":case"!=":case"$nin":f=!0,Array.isArray(h)?n.push(u.isNotIn(h)):n.push(u.isDifferentFrom(h));break;case"$in":f=!0,n.push(u.isIn(h));break;case"$contains":f=!0,n.push(u.contains(h));break;case"$startsWith":f=!0,n.push(u.startsWith(h));break;case"$endsWith":f=!0,n.push(u.endsWith(h));break;case"$notContains":f=!0,n.push(u.notContains(h));break}}Array.isArray(s)&&(f=!0,n.push(u.isIn(s)))}!f&&s!==void 0&&n.push(u.isEqualTo(s))}}return new na(...n)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new Kn;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,n){let i=new Yn(async(s,a)=>{let o=[];for(const l in t.entityType){const u=t.entityType[l];u&&u.rawFilterInfo&&u.rawFilterInfo.rawFilterTranslator&&u.rawFilterInfo.key==s&&o.push(await B.fromEntityFilter(t,await u.rawFilterInfo.rawFilterTranslator(a,n)))}return o});return e.__applyToConsumer(i),await i.resolve(),e=new B(s=>i.applyTo(s)),e}}class Qn{constructor(e){d(this,"metadata");this.metadata=e}processVal(e){if(xe(this.metadata.valueType,!1)){if(e==null){if(e===null&&!this.metadata.allowNull){const n=le(this.metadata);if((n==null?void 0:n.type)==="reference")return n.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:ee(e).getId()}return e}contains(e){return new B(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new B(t=>t.notContainsCaseInsensitive(this.metadata,e))}startsWith(e){return new B(t=>t.startsWithCaseInsensitive(this.metadata,e))}endsWith(e){return new B(t=>t.endsWithCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new B(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new B(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new B(t=>{for(const n of e)t.isDifferentFrom(this.metadata,this.processVal(n))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new B(t=>t.isNotNull(this.metadata)):new B(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new B(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new B(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new B(t=>t.isNull(this.metadata)):new B(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new B(t=>t.isEqualTo(this.metadata,e[0])):new B(t=>t.isIn(this.metadata,e))}}class xc extends Qn{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:ee(e).getId():null}}class Dc{constructor(e,t,n){d(this,"metadata");d(this,"fields");d(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=n}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}endsWith(e){throw new Error("Invalid for Many To One Relation Field")}startsWith(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new B(t=>{e.forEach(n=>this.isDifferentFrom(n).__applyToConsumer(t))})}isDifferentFrom(e){return new B(t=>{const n=[];for(const i in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,i)){const s=this.relationOptions.fields[i];n.push(new B(a=>new Qn(this.fields.find(s)).isDifferentFrom(e[i]).__applyToConsumer(a)))}t.or(n)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new B(t=>{for(const n in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,n)){const i=this.relationOptions.fields[n];new Qn(this.fields.find(i)).isEqualTo(e[n]).__applyToConsumer(t)}})}isIn(e){return new B(t=>{t.or(e.map(n=>this.isEqualTo(n)))})}}class na extends B{constructor(...t){super(n=>{for(const i of this.filters)i&&i.__applyToConsumer(n)});d(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class Nc extends B{constructor(...t){super(n=>{let i=this.filters.filter(s=>s!==void 0);i.length>1?n.or(i):i.length==1&&i[0].__applyToConsumer(n)});d(this,"filters");this.filters=t}}class Mc extends B{constructor(t){super(n=>{n.not(t)});d(this,"filter");this.filter=t}}const Wt="$custom$",Qo="$db$",Wi="$an array";class Kn{constructor(){d(this,"result",{});d(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[Wi]:t}),this.add(Wt+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let n=this.result;if(!n[e]){n[e]=t;return}let i=n[e];i instanceof Array?i.push(t):i=[i,t],n[e]=i}or(e){this.add("OR",e.map(t=>{let n=new Kn;return t.__applyToConsumer(n),n.result}))}not(e){let t=new Kn;e.__applyToConsumer(t),this.add("NOT",t.result)}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(n=>e.valueConverter.toJson(n)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}startsWithCaseInsensitive(e,t){this.add(e.key+".startsWith",t)}endsWithCaseInsensitive(e,t){this.add(e.key+".endsWith",t)}}function En(r,e){let t={};function n(o){t.$and||(t.$and=[]),t.$and.push(o)}function i(o,l){t[o]===void 0?t[o]=l:n({[o]:l})}[...r.fields].forEach(o=>{function l(f,c,h=!1,p=!1){let y=e.get(o.key+f);if(y!==void 0){let m=g=>{let k=g;if(h){let M;typeof g=="string"?M=JSON.parse(g):M=g,k=M.map(b=>p?b:o.valueConverter.fromJson(b))}else k=p?k:o.valueConverter.fromJson(k);let T=c(k);T!==void 0&&i(o.key,T)};if(!h&&y instanceof Array)y.forEach(g=>{m(g)});else{h&&typeof y=="string"&&(y=JSON.parse(y));const g=a(y);for(const k of g)m(k)}}}l("",f=>f),l(".gt",f=>({$gt:f})),l(".gte",f=>({$gte:f})),l(".lt",f=>({$lt:f})),l(".lte",f=>({$lte:f})),l(".ne",f=>({$ne:f})),l(".in",f=>f,!0);var u=e.get(o.key+".null");if(u)switch(u=u.toString().trim().toLowerCase(),u){case"y":case"true":case"yes":i(o.key,null);break;default:i(o.key,{$ne:null});break}l(".contains",f=>({$contains:f}),!1,!0),l(".notContains",f=>({$notContains:f}),!1,!0),l(".startsWith",f=>({$startsWith:f}),!1,!0),l(".endsWith",f=>({$endsWith:f}),!1,!0)});let s=e.get("OR");if(s){const l=a(s).map(u=>({$or:u.map(f=>En(r,{get:c=>f[c]}))}));l.length==1?t.$or?t.$or.push(l[0].$or):t.$or=l[0].$or:n({$and:l})}if(s=e.get("NOT"),s){let o=a(s);const l=[];for(const u of o)if(Array.isArray(u))for(const f of u)l.push({$not:En(r,{get:c=>f[c]})});else l.push({$not:En(r,{get:f=>u[f]})});l.length==1&&!t.$not?t=l[0]:n({$and:l})}for(const o in r.entityType){const l=r.entityType[o];if(l&&l.rawFilterInfo&&l.rawFilterInfo.rawFilterTranslator){let u=e.get(Wt+o);if(u!==void 0){const f=c=>{c[Wi]!=null&&(c=c[Wi]),i(Wt+o,c)};Array.isArray(u)?u.forEach(c=>f(c)):f(u)}}}return t;function a(o){if(!Array.isArray(o))return[o];const l=[],u=[];for(const f of o)Array.isArray(f)?u.push(f):l.push(f);return u.push(l),u}}class Yn{constructor(e){d(this,"translateCustom");d(this,"commands",[]);d(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async n=>{let i=new Yn(this.translateCustom);return n.__applyToConsumer(i),await i.resolve(),new B(s=>i.applyTo(s))})).then(n=>{t=n})),this.commands.push(n=>n.or(t))}not(e){let t;this.promises.push((async()=>{let n=new Yn(this.translateCustom);e.__applyToConsumer(n),await n.resolve(),t=new B(i=>n.applyTo(i))})()),this.commands.push(n=>n.not(t))}isEqualTo(e,t){this.commands.push(n=>n.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(n=>n.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(n=>n.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(n=>n.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(n=>n.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(n=>n.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(n=>n.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(n=>n.notContainsCaseInsensitive(e,t))}startsWithCaseInsensitive(e,t){this.commands.push(n=>n.startsWithCaseInsensitive(e,t))}endsWithCaseInsensitive(e,t){this.commands.push(n=>n.endsWithCaseInsensitive(e,t))}isIn(e,t){this.commands.push(n=>n.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let n=await this.translateCustom(e,t);n&&(Array.isArray(n)?n.forEach(i=>i.__applyToConsumer(this)):n.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}class Xn{constructor(){d(this,"rawValues",{});d(this,"preciseValues",new Proxy(this.rawValues,{get:(e,t)=>{if(t in e){let n=e[t];if(n.bad)return;if(n.values.length>0){const i=le(n.field);if(i){if(i.type==="reference")return n.values.map(s=>i.toRepo.metadata.idMetadata.getIdFilter(s));throw new Error("Only relations toOne without field are supported.")}return n.values}}}}))}ok(e,...t){let n=this.rawValues[e.key];n?n.values.push(...t.filter(i=>!n.values.includes(i))):this.rawValues[e.key]={field:e,bad:!1,values:[...t]}}notOk(e){let t=this.rawValues[e.key];t?t.bad=!0:this.rawValues[e.key]={field:e,bad:!0,values:[]}}not(e){}or(e){const t=e.map(n=>{let i=new Xn;return n.__applyToConsumer(i),i});for(const n of t)for(const i in n.rawValues)if(Object.prototype.hasOwnProperty.call(n.rawValues,i)){const s=n.rawValues[i];s&&(s.bad?this.notOk(s.field):this.ok(s.field,...s.values))}for(const n in this.rawValues)if(Object.prototype.hasOwnProperty.call(this.rawValues,n))for(const i of t)i.rawValues[n]||this.notOk(this.rawValues[n].field)}isEqualTo(e,t){this.ok(e,t)}isDifferentFrom(e,t){this.notOk(e)}isNull(e){this.ok(e,null)}isNotNull(e){this.notOk(e)}isGreaterOrEqualTo(e,t){this.notOk(e)}isGreaterThan(e,t){this.notOk(e)}isLessOrEqualTo(e,t){this.notOk(e)}isLessThan(e,t){this.notOk(e)}containsCaseInsensitive(e,t){this.notOk(e)}notContainsCaseInsensitive(e,t){this.notOk(e)}startsWithCaseInsensitive(e,t){this.notOk(e)}endsWithCaseInsensitive(e,t){this.notOk(e)}isIn(e,t){this.ok(e,...t)}custom(e,t){}databaseCustom(e){}}var Lc={};const Ci=Symbol.for("remult-static1");let Cn={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:r=>r(),startBusyWithProgress:()=>({progress:r=>{},close:()=>{}})},fieldOptionsEnricher:void 0,captionTransformer:void 0,defaultDataProvider:()=>{}};typeof process<"u"&&Lc.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[Ci]>"u"?(globalThis[Ci]=Cn,Cn.remultFactory=()=>Ko()):Cn=globalThis[Ci];const N=Cn;function Ko(){return N.defaultRemult||(N.defaultRemult=N.defaultRemultFactory()),N.defaultRemult}function qc(){N.remultFactory=()=>Ko()}function Ht(r){const e=r;if(typeof e[jr]=="function")return e[jr]();throw Error("Error getting repository internal from "+r)}const jr=Symbol.for("getInternal");class Bc{constructor(){d(this,"iAmRemultProxy",!0);d(this,"repoCache",new Map);d(this,"repo",(...e)=>{let t=N,n=this.repoCache.get(e[0]);n||this.repoCache.set(e[0],n=new Map);let i=n.get(e[1]);return i||(i={get fields(){return N.remultFactory().repo(...e).metadata.fields},[jr](){return t.remultFactory().repo(...e)[jr]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...a)=>t.remultFactory().repo(...e).validate(s,...a),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),deleteMany:s=>t.remultFactory().repo(...e).deleteMany(s),updateMany:(...s)=>t.remultFactory().repo(...e).updateMany(...s),find:(...s)=>t.remultFactory().repo(...e).find(...s),groupBy:(...s)=>t.remultFactory().repo(...e).groupBy(...s),aggregate:(...s)=>t.remultFactory().repo(...e).aggregate(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,a)=>t.remultFactory().repo(...e).findId(s,a),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,a)=>t.remultFactory().repo(...e).fromJson(s,a),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return N.remultFactory().repo(...e).metadata},query:s=>t.remultFactory().repo(...e).query(s),save:s=>t.remultFactory().repo(...e).save(s),upsert:s=>t.remultFactory().repo(...e).upsert(s),update:(s,a)=>t.remultFactory().repo(...e).update(s,a)},n.set(e[1],i),i)})}get liveQuerySubscriber(){return N.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){N.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return N.remultFactory().liveQueryStorage}set liveQueryStorage(e){N.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return N.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){N.remultFactory().liveQueryPublisher=e}initUser(){return N.remultFactory().initUser()}call(e,t,...n){return N.remultFactory().call(e,t,...n)}get context(){return N.remultFactory().context}get dataProvider(){return N.remultFactory().dataProvider}set dataProvider(e){N.remultFactory().dataProvider=e}get repCache(){return N.remultFactory().repCache}authenticated(){return N.remultFactory().authenticated()}isAllowed(e){return N.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return N.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return N.remultFactory().clearAllCache()}useFetch(e){return N.remultFactory().useFetch(e)}get user(){return N.remultFactory().user}set user(e){N.remultFactory().user=e}get apiClient(){return N.remultFactory().apiClient}set apiClient(e){N.remultFactory().apiClient=e}get subscriptionServer(){return N.remultFactory().subscriptionServer}set subscriptionServer(e){N.remultFactory().subscriptionServer=e}}const Te=new Bc,jc="$count",Uc=Symbol.for("GroupByForApiKey"),Jc=["sum","avg","min","max","distinctCount"],Yo={error500RetryCount:4};function Hi(r){return r.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail")}class Vc{constructor(e,t,n){d(this,"repository");d(this,"isReferenceRelation");d(this,"allowNull");d(this,"storedItem");d(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=n}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:Ht(this.repository)._getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=Ht(this.repository)._getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=ee(e,!1);t&&!this.isReferenceRelation?(Ht(this.repository)._addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class ia{constructor(e){d(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var n in e){let i=e[n];this.add(n+t,i)}}}function dr(r){if(!r)return new sa;let e;return e||Xo(r)&&(e=new $c(r)),e||typeof r=="function"&&(e=new sa(r)),e}function Xo(r){let e=r;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class $c{constructor(e){d(this,"http");this.http=e}async post(e,t){return await Zn(()=>wn(this.http.post(e,t)))}delete(e){return wn(this.http.delete(e))}put(e,t){return wn(this.http.put(e,t))}async get(e){return await Zn(()=>wn(this.http.get(e)))}}async function Zn(r){var t,n,i,s;let e=0;for(;;)try{return await r()}catch(a){if(((t=a.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(n=a.message)!=null&&n.startsWith("Error occured while trying to proxy")||(i=a.message)!=null&&i.includes("http proxy error")||(s=a.message)!=null&&s.startsWith("Gateway Timeout")||a.status==500)&&e++<Yo.error500RetryCount){await new Promise((o,l)=>{setTimeout(()=>{o({})},500)});continue}throw a}}function wn(r){let e;return r.toPromise!==void 0?e=r.toPromise():e=r,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data!==void 0?t.data:t).catch(async t=>{throw await Wc(t)})}async function Wc(r){var s,a,o;let e=await r;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(a=e==null?void 0:e.response)==null?void 0:a.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let n=e.status;n===void 0&&(n=(o=e.response)==null?void 0:o.status),n!=null&&(t.httpStatusCode=n);var i=Object.assign(t??{},{});return i}class Gi{constructor(e,t){d(this,"apiProvider");d(this,"entityRequested");d(this,"isProxy",!0);this.apiProvider=e,this.entityRequested=t}getEntityDataProvider(e){var t;return(t=this.entityRequested)==null||t.call(this,e),new Hc(()=>{var n;return Zo((n=this.apiProvider())==null?void 0:n.url,e.key)},()=>dr(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function Zo(r,e){return r==null&&(r="/api"),r+"/"+e}function _s(r,e){if(r.include){let t={};for(const n in r.include)if(Object.prototype.hasOwnProperty.call(r.include,n)){let i=r.include[n];if(typeof i=="object"){const s=le(e.fields.find(n));s&&(i=_s(i,s.toRepo.metadata))}t[n]=i}r={...r,include:t}}return r.where&&(r={...r,where:B.entityFilterToJson(e,r.where)}),r.load&&(r={...r,load:r.load(e.fields).map(t=>t.key)}),r}class Hc{constructor(e,t,n){d(this,"url");d(this,"http");d(this,"entity");this.url=e,this.http=t,this.entity=n}query(e,t){return this.buildFindRequest(e).run("query",{aggregate:this.buildAggregateOptions(t)}).then(({items:i,aggregates:s})=>({items:i.map(a=>this.translateFromJson(a)),aggregates:s}))}async groupBy(e){const{run:t}=this.buildFindRequest({where:e==null?void 0:e.where,limit:e==null?void 0:e.limit,page:e==null?void 0:e.page}),n=this.buildAggregateOptions(e),i=await t("groupBy",Object.keys(n).length>0?n:void 0);return e!=null&&e.group&&i.forEach(s=>{for(const a of e.group)s[a.key]=a.valueConverter.fromJson(s[a.key])}),i}buildAggregateOptions(e){var t,n,i,s,a,o,l;return{groupBy:(t=e==null?void 0:e.group)==null?void 0:t.map(u=>u.key),sum:(n=e==null?void 0:e.sum)==null?void 0:n.map(u=>u.key),avg:(i=e==null?void 0:e.avg)==null?void 0:i.map(u=>u.key),min:(s=e==null?void 0:e.min)==null?void 0:s.map(u=>u.key),max:(a=e==null?void 0:e.max)==null?void 0:a.map(u=>u.key),distinctCount:(o=e==null?void 0:e.distinctCount)==null?void 0:o.map(u=>u.key),orderBy:(l=e==null?void 0:e.orderBy)==null?void 0:l.map(u=>{var f;return{...u,field:(f=u.field)==null?void 0:f.key}})}}translateFromJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.fromJson(e[n.key]);return t}translateToJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.toJson(e[n.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(n=>+n.count)}async deleteMany(e){const{run:t}=this.buildFindRequest({where:e},"delete");return t("deleteMany").then(n=>+n.deleted)}async updateMany(e,t){const{run:n}=this.buildFindRequest({where:e},"put");return n("updateMany",this.toJsonOfIncludedKeys(t)).then(i=>+i.updated)}async upsertMany(e){const{run:t}=this.buildFindRequest(void 0);return t("upsertMany",e.map(n=>({where:this.toJsonOfIncludedKeys(n.where),set:n.set!==void 0?this.toJsonOfIncludedKeys(n.set):void 0}))).then(n=>n.map(i=>this.translateFromJson(i)))}find(e){let{run:t}=this.buildFindRequest(e);return t().then(n=>n.map(i=>this.translateFromJson(i)))}buildFindRequest(e,t){t||(t="get");let n=new ia(this.url()),i;if(e){if(e.where&&(i=e.where.toJson(),zc(i,n)&&(i=void 0)),e.orderBy&&e.orderBy.Segments){let a="",o="",l=!1;e.orderBy.Segments.forEach(u=>{a.length>0&&(a+=",",o+=","),a+=u.field.key,o+=u.isDescending?"desc":"asc",u.isDescending&&(l=!0)}),a&&n.add("_sort",a),l&&n.add("_order",o)}e.limit&&n.add("_limit",e.limit),e.page&&n.add("_page",e.page)}const s=(a,o)=>{let l=new ia(n.url);if(!a&&i&&(a="get"),a&&l.add("__action",a),i){if(t==="put")return this.http().post(l.url,{set:o,where:i});o={...o,where:i}}return o&&t!="put"?this.http().post(l.url,o):this.http()[t](l.url,o)};return{createKey:()=>JSON.stringify({url:n,filterObject:i}),run:s,subscribe:async a=>({result:await s(Qc+a),unsubscribe:async()=>N.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:a}))})}}update(e,t){return this.http().put(this.url()+(e!=""?"/"+encodeURIComponent(e):"?__action=emptyId"),this.toJsonOfIncludedKeys(t)).then(n=>this.translateFromJson(n))}toJsonOfIncludedKeys(e){let t={},n=Object.keys(e);for(const i of this.entity.fields)n.includes(i.key)&&(t[i.key]=i.valueConverter.toJson(e[i.key]));return t}async delete(e){if(e=="")await this.deleteMany(B.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)));else return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}insertMany(e){return this.http().post(this.url(),e.map(t=>this.translateToJson(t))).then(t=>t.map(n=>this.translateFromJson(n)))}}class sa{constructor(e){d(this,"fetch");this.fetch=e}async get(e){return await Zn(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await Zn(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const n={};if(t!=null&&t.body&&(n["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const i of window.document.cookie.split(";"))i.trim().startsWith("XSRF-TOKEN=")&&(n["X-XSRF-TOKEN"]=i.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:n}).then(i=>Gc(i)).catch(async i=>{throw await i})}}function Gc(r){if(r.status!=204){if(r.status>=200&&r.status<300)return r.json();throw r.json().then(e=>({...e,message:e.message||r.statusText,url:r.url,status:r.status})).catch(()=>{throw{message:r.statusText,url:r.url,status:r.status}})}}function zc(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];if(Array.isArray(n)&&(n.length>0&&typeof n[0]=="object"||n.length>10)||t==="NOT")return!1}for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];Array.isArray(n)?t.endsWith(".in")?e.add(t,JSON.stringify(n)):n.forEach(i=>e.add(t,i)):t.startsWith(Wt)?e.add(t,JSON.stringify(n)):e.add(t,n)}return!0}const Qc="liveQuery-";var vn,Kc=new Uint8Array(16);function Yc(){if(!vn&&(vn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!vn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vn(Kc)}const Xc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Zc(r){return typeof r=="string"&&Xc.test(r)}var _e=[];for(var Si=0;Si<256;++Si)_e.push((Si+256).toString(16).substr(1));function ed(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(_e[r[e+0]]+_e[r[e+1]]+_e[r[e+2]]+_e[r[e+3]]+"-"+_e[r[e+4]]+_e[r[e+5]]+"-"+_e[r[e+6]]+_e[r[e+7]]+"-"+_e[r[e+8]]+_e[r[e+9]]+"-"+_e[r[e+10]]+_e[r[e+11]]+_e[r[e+12]]+_e[r[e+13]]+_e[r[e+14]]+_e[r[e+15]]).toLowerCase();if(!Zc(t))throw TypeError("Stringified UUID is invalid");return t}function zi(r,e,t){r=r||{};var n=r.random||(r.rng||Yc)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ed(n)}class Re{constructor(...e){d(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new Re;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,n){n||(n=i=>i.key);for(let i=0;i<this.Segments.length;i++){let s=this.Segments[i],a=e[n(s.field)],o=t[n(s.field)],l=s.isDescending,u=td(a,o,l);if(u!=0)return u}return 0}static translateOrderByToSort(e,t){let n=new Re;if(t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];let a=e.fields.find(i);const o=l=>{switch(s){case"desc":n.Segments.push({field:l,isDescending:!0});break;case"asc":n.Segments.push({field:l})}};if(a){const l=le(a);if((l==null?void 0:l.type)==="toOne"){const u=l.options;if(typeof u.field=="string")o(e.fields.find(u.field));else if(u.fields){for(const f in u.fields)if(Object.prototype.hasOwnProperty.call(u.fields,f)){const c=u.fields[f];o(e.fields.find(c.toString()))}}}else o(a)}}}return n}static createUniqueSort(e,t){(!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=Re.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new Re);for(const n of e.idMetadata.fields)t.Segments.find(i=>i.field==n)||t.Segments.push({field:n});return t}static createUniqueEntityOrderBy(e,t){(!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={};for(const n of e.idMetadata.fields)t[n.key]||(t[n.key]="asc");return t}}function td(r,e,t){r=aa(r),e=aa(e);let n=0;return r>e?n=1:r<e&&(n=-1),t&&(n*=-1),n}function aa(r){return r==null||r==null?r:r.id!==void 0?r.id:r}const Ti="stream";class rd{constructor(e,t,n){d(this,"repo");d(this,"query");d(this,"queryChannel");d(this,"subscribeCode");d(this,"unsubscribe",()=>{});d(this,"defaultQueryState",[]);d(this,"listeners",[]);d(this,"id",zi());this.repo=e,this.query=t,this.queryChannel=`users:${n}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await Ht(this.repo)._fromJsonArray(e,this.query.options);this.forListeners(n=>{n(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(n=>{if(this.defaultQueryState=n(this.defaultQueryState),t.find(i=>i.type==="add"||i.type==="replace")&&this.query.options.orderBy){const i=Re.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,a)=>i.compare(s,a))}});for(const n of this.listeners)e(i=>{n.next(this.createReducerType(i,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:i})=>i=="add"||i=="replace"),n=await Ht(this.repo)._fromJsonArray(t.map(i=>i.data.item),this.query.options);for(let i=0;i<t.length;i++){const s=t[i];s.data.item=n[i]}}this.forListeners(t=>{t(n=>{n||(n=[]);for(const i of e)switch(i.type){case"all":this.setAllItems(i.data);break;case"replace":{n=n.map(s=>this.repo.metadata.idMetadata.getId(s)===i.data.oldId?i.data.item:s);break}case"add":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(i.data.item)),n.push(i.data.item);break;case"remove":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==i.data.id);break}return n})},e)}}const nd="_liveQueryKeepAlive";class id{constructor(e,t){d(this,"apiProvider");d(this,"getUserId");d(this,"queries",new Map);d(this,"channels",new Map);d(this,"client");d(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let n=()=>{};const i=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new sd);try{s.unsubscribe=await i.subscribe(e,a=>this.wrapMessageHandling(()=>s.handle(a)),a=>{t.error(a)})}catch(a){throw t.error(a),a}}s.listeners.push(t),n=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{n(),n=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,n){let i=!0,s=()=>{i=!1};return this.runPromise(Ht(e)._buildEntityDataProviderFindOptions(t).then(a=>{if(!i)return;const{createKey:o,subscribe:l}=new Gi(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(a),u=o();let f=this.queries.get(u);f?f.sendDefaultState(n.next):(this.queries.set(u,f=new rd(e,{entityKey:e.metadata.key,options:t},this.getUserId())),f.subscribeCode=()=>{f.unsubscribe&&(f.unsubscribe(),f.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(f.queryChannel,{next:c=>this.runPromise(f.handle(c)),complete:()=>{},error:c=>{f.listeners.forEach(h=>h.error(c))}}).then(c=>{if(f.listeners.length==0){c();return}this.runPromise(l(f.queryChannel).then(h=>{if(f.listeners.length===0){h.unsubscribe(),c();return}this.runPromise(f.setAllItems(h.result)),f.unsubscribe=()=>{f.unsubscribe=()=>{},c(),this.runPromise(h.unsubscribe())}}).catch(h=>{f.listeners.forEach(p=>p.error(h)),c(),this.queries.delete(u)}))})).catch(c=>{f.listeners.forEach(h=>h.error(c))})},f.subscribeCode()),f.listeners.push(n),s=()=>{f.listeners.splice(f.listeners.indexOf(n),1),n.complete(),f.listeners.length==0&&(this.queries.delete(u),f.unsubscribe()),this.closeIfNoListeners()}}).catch(a=>{n.error(a)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const n=await this.runPromise(await N.actionInfo.runActionWithoutBlockingUI(()=>dr(t.httpClient).post(t.url+"/"+nd,e)));for(const i of n)for(const s of this.queries.values())s.queryChannel===i&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class sd{constructor(){d(this,"unsubscribe",()=>{});d(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class bs{openConnection(e){let t;const n=new Map,i=dr(Te.apiClient.httpClient);let s=!1,a;const o={close(){a.close()},async subscribe(f,c){let h=n.get(f);return h||(n.set(f,h=[]),await u(f)),h.push(c),()=>{h.splice(h.indexOf(c,1)),h.length==0&&(N.actionInfo.runActionWithoutBlockingUI(()=>i.post(Te.apiClient.url+"/"+Ti+"/unsubscribe",{channel:f,clientId:t})),n.delete(f))}}},l=()=>new Promise(f=>{h();let c=0;function h(){a&&a.close(),a=bs.createEventSource(Te.apiClient.url+"/"+Ti),a.onmessage=p=>{let y=JSON.parse(p.data);const m=n.get(y.channel);m&&m.forEach(g=>g(y.data))},a.onerror=p=>{console.error("Live Query Event Source Error",p),a.close(),c++<Yo.error500RetryCount&&setTimeout(()=>{h()},500)},a.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const y of n.keys())await u(y);e()}else s=!0,f(o)})}});return l();async function u(f){await N.actionInfo.runActionWithoutBlockingUI(()=>i.post(Te.apiClient.url+"/"+Ti+"/subscribe",{channel:f,clientId:t}))===ad&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const ad="client connection not found",Qi=Symbol.for("serverActionField");class od{constructor(e){d(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){N.remultFactory=()=>{const e=N.asyncContext.getStore();if(e)return e.remult;throw new Error("remult object was requested outside of a valid request cycle.valid context, try running `withRemult` or run  within initApi or a remult request cycle")}}static disable(){qc()}async run(e,t){return this.remultObjectStorage?this.remultObjectStorage.run({remult:e},()=>t(e)):t(e)}isInInitRequest(){var e,t;return(t=(e=this.remultObjectStorage)==null?void 0:e.getStore())==null?void 0:t.inInitRequest}setInInitRequest(e){var n,i;const t=(n=this.remultObjectStorage)==null?void 0:n.getStore();t&&(e||(i=this.remultObjectStorage)!=null&&i.isStub)&&(t.inInitRequest=e)}getStore(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}N.asyncContext||(N.asyncContext=new od(void 0));function Ur(){return N.actionInfo.runningOnServer||!Te.dataProvider.isProxy}class tt{constructor(e){d(this,"repo",(e,t)=>{t===void 0&&(t=this.dataProvider);let n=this.repCache.get(t);n||this.repCache.set(t,n=new Map);let i=n.get(e);return i||(n.set(e,i=new Is(e,this,t,gd(e,this))),Rc(i,this,t)),i});d(this,"user");d(this,"dataProvider",new Gi(()=>this.apiClient));d(this,"repCache",new Map);d(this,"liveQueryStorage");d(this,"subscriptionServer");d(this,"liveQueryPublisher",{itemChanged:async()=>{}});d(this,"liveQuerySubscriber",new id(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));d(this,"context",{});d(this,"apiClient",{url:"/api",subscriptionClient:new bs});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if(Xo(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}async initUser(){const t=await dr(this.apiClient.httpClient).get(Zo(this.apiClient.url,"me"));return this.user=(t==null?void 0:t.id)!=null?t:void 0,this.user}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,n;if(e!=null){if(e instanceof Array){for(const i of e)if(this.isAllowed(i)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(n=(t=this.user)==null?void 0:t.roles)!=null&&n.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const n of t)if(this.isAllowedForInstance(e,n))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}useFetch(e){this.dataProvider=new Gi(()=>({httpClient:e}))}call(e,t,...n){const i=e[Qi];if(!i.doWork)throw Error("The method received is not a valid backend method");return i.doWork(n,t,this.apiClient.url,dr(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}d(tt,"onFind",(e,t)=>{}),d(tt,"entityRefInit");N.defaultRemultFactory=()=>new tt;class el{constructor(){d(this,"classes",new Map)}}function ld(r,e){let t=r;for(;;){let n=N.classHelpers.get(t);n||N.classHelpers.set(t,n=new el),n.classes.set(r,e);let i=Object.getPrototypeOf(t.prototype);if(i==null)break;t=i.constructor}}const ud={defaultPageSize:200};async function fd(r,e){const t=new cd(r.liveQueryPublisher);let n=!0;const i=r.dataProvider;try{await r.dataProvider.transaction(async s=>{r.dataProvider=s,r.liveQueryPublisher=t,await e(s),n=!0}),n&&await t.flush()}finally{r.dataProvider=i}}class cd{constructor(e){d(this,"orig");d(this,"transactionItems",new Map);this.orig=e}async itemChanged(e,t){let n=this.transactionItems.get(e);n||this.transactionItems.set(e,n=[]);for(const i of t)if(i.oldId!==void 0){const s=n.find(a=>a.id===i.oldId);s!==void 0?(i.deleted&&(s.deleted=!0),i.id!=s.id&&(s.id=i.id)):n.push(i)}else n.push(i)}async flush(){for(const e of this.transactionItems.keys())await this.orig.itemChanged(e,this.transactionItems.get(e))}}function Er(r,e){return e&&Object.assign(r,e),r}class tl extends Error{constructor(t){super(t.message);d(this,"modelState");d(this,"stack");d(this,"exception");d(this,"httpStatusCode");Object.assign(this,t)}}class st{}d(st,"number","number"),d(st,"date","date"),d(st,"checkbox","checkbox"),d(st,"password","password"),d(st,"email","email"),d(st,"tel","tel"),d(st,"time","time");const W=class W{};d(W,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>W.Date.fromJson(e),toInput:e=>W.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),d(W,"DateOnly",{fromInput:e=>W.DateOnly.fromJson(e),toInput:e=>W.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:st.date,toDb:e=>e?W.DateOnly.fromJson(W.DateOnly.toJson(e)):null,fromDb:e=>W.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),d(W,"DateOnlyString",{...W.DateOnly,toDb:e=>{let t=W.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),d(W,"Boolean",{toDb:e=>e,inputType:st.checkbox,fromDb:e=>W.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>W.Boolean.fromJson(e),toInput:e=>W.Boolean.toJson(e)}),d(W,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>W.Number.fromDb(e),toJson:e=>W.Number.toDb(e),fromInput:(e,t)=>{let n=+e;if(e!=null)return n},toInput:(e,t)=>(e==null?void 0:e.toString())??"",inputType:st.number}),d(W,"String",{fromDb:Zt,toDb:Zt,fromJson:Zt,toJson:Zt,fromInput:Zt,toInput:Zt}),d(W,"Integer",{...W.Number,toJson:e=>{let t=W.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>W.Integer.toJson(e),fieldTypeInDb:"integer"}),d(W,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>W.JsonString.fromDb(e),toDb:e=>W.JsonString.toDb(e),fromInput:e=>W.Default.fromJson(e),toInput:e=>W.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),d(W,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(W.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(W.JsonString.toJson(e)):void 0,fromInput:e=>W.JsonString.fromJson(e),toInput:e=>W.JsonString.toJson(e)}),d(W,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>W.JsonString.fromJson(e),toInput:e=>W.JsonString.toJson(e),fieldTypeInDb:"json"});let Ee=W;function Zt(r){return r==null?r:typeof r!="string"?r.toString():r}function Ai(r,e,t){let n=B.fromEntityFilter(r,e);const i=()=>{};n&&n.__applyToConsumer({custom:i,databaseCustom:i,containsCaseInsensitive:i,notContainsCaseInsensitive:i,startsWithCaseInsensitive:i,endsWithCaseInsensitive:i,isDifferentFrom:i,isEqualTo:(s,a)=>{t[s.key]=a},isGreaterOrEqualTo:i,isGreaterThan:i,isIn:i,isLessOrEqualTo:i,isLessThan:i,isNotNull:i,isNull:i,not:i,or:i})}class Cr{constructor(){d(this,"entityLoaders",new Map);d(this,"promises",[])}load(e,t){let n=this.entityLoaders.get(e.entityType);n||this.entityLoaders.set(e.entityType,n=new dd(e));const i=n.find(t);return this.promises.push(i),i}async resolveAll(){for(const t of this.entityLoaders.values())for(const n of t.queries.values())n.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class dd{constructor(e){d(this,"rel");d(this,"queries",new Map);this.rel=e}find(e){const{where:t,...n}=_s(e,this.rel.metadata),i=JSON.stringify(n);let s=this.queries.get(i);return s||this.queries.set(i,s=new hd(this.rel)),s.find(e,t)}}class hd{constructor(e){d(this,"rel");d(this,"pendingInStatements",new Map);d(this,"whereVariations",new Map);this.rel=e}find(e,t){const n=JSON.stringify(t);let i=this.whereVariations.get(n);if(!i){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let a=this.pendingInStatements.get(s[0]);a||this.pendingInStatements.set(s[0],a=new pd(this.rel,s[0],e)),this.whereVariations.set(n,i={result:a.find(t)})}else this.whereVariations.set(n,i={result:this.rel.find(e)})}return i.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class pd{constructor(e,t,n){d(this,"rel");d(this,"key");d(this,"options");d(this,"values",new Map);this.rel=e,this.key=t,this.options=n}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(i=>i.value)},t.limit=1e3,t.page=1;let n=[];try{for(;;){const i=await this.rel.find(t);if(n.push(...i),i.length<t.limit)break;t.page++}for(const i of this.values.values())i.resolve(n.filter(s=>{const o=ee(s).fields.find(this.key),l=le(o.metadata),u=(l==null?void 0:l.type)==="reference"?o.getId():s[this.key];return i.value==u}))}catch(i){for(const s of this.values.values())s.reject(i)}}find(e){const t=e[this.key];let n=this.values.get(t);if(!n){let i,s,a=new Promise((o,l)=>{i=o,s=l});this.values.set(t,n={value:t,resolve:i,reject:s,result:a})}return n.result}}N.actionInfo;const we=class we{};d(we,"required",Sr(async(e,t)=>!t.valueIsNull()&&t.value!==""&&(t.value!==void 0||le(t.metadata)!==void 0),"Should not be empty")),d(we,"unique",Sr(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),d(we,"uniqueOnBackend",Sr(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,we.unique.defaultMessage)),d(we,"regex",At((e,t)=>t.test(e))),d(we,"email",Sn(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),d(we,"url",Sn(e=>!!new URL(e),"Invalid Url")),d(we,"in",At((e,t)=>t.includes(e),e=>`Value must be one of: ${e.map(t=>typeof t=="object"?(t==null?void 0:t.id)!==void 0?t==null?void 0:t.id:t==null?void 0:t.toString():t).join(", ")}`)),d(we,"notNull",Sn(e=>e!=null,"Should not be null")),d(we,"enum",At((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${Tn(e).join(", ")}`)),d(we,"relationExists",Sr(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),d(we,"min",At((e,t)=>e>=t,e=>`Value must be bigger than or equal to ${e}`)),d(we,"max",At((e,t)=>e<=t,e=>`Value must be smaller than or equal to ${e}`)),d(we,"maxLength",At((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),d(we,"minLength",At((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),d(we,"range",At((e,[t,n])=>e>=t&&e<=n,([e,t])=>`Value must be between ${e} and ${t}`)),d(we,"defaultMessage","Invalid value");let He=we;function Sr(r,e){const t=async(i,s,a)=>{const o=await r(i,s);typeof o=="string"&&o.length>0?s.error=o:o||(s.error=typeof a=="function"&&a(i,s,void 0)||a||typeof e=="function"&&e(i,s,void 0)||e||He.defaultMessage)},n=(i,s,a)=>typeof i=="string"||i==="function"||i===void 0&&s===void 0?async(o,l,u)=>await t(o,l,i||u):t(i,s,a);return Object.defineProperty(n,"defaultMessage",{get:()=>e,set:i=>{e=i},enumerable:!0}),Object.assign(n,{withMessage:i=>async(s,a)=>n(s,a,i)})}function Sn(r,e){return Sr((t,n)=>n.value===void 0||n.value===null?!0:r(n.value),e)}function At(r,e){const t=yd((n,i,s)=>i.value===void 0||i.value===null?!0:r(i.value,s),(n,i,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((n,i)=>t(n,i),{get defaultMessage(){return e},set defaultMessage(n){e=n}})}function yd(r,e,t=!1){return Object.assign((i,s)=>async(a,o)=>{const l=await r(a,o,i);typeof l=="string"?o.error=l:l||(o.error=s?typeof s=="function"?t?s(i):s(a,o,i):s:e?typeof e=="function"?e(a,o,i):e:He.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(i){e=i}})}function Tn(r){return Object.values(r).filter(e=>typeof r[e]!="number")}function An(r,e,t=!1){if(!e)return r;const n=Array.isArray(e)?e:[e],i=Array.isArray(r)?r:r?[r]:[];return t?[...n,...i]:[...i,...n]}function lr(r,e){return typeof r[e]<"u"}class md{constructor(e,t){d(this,"options");d(this,"repo");d(this,"_count");d(this,"_aggregates");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=ud.defaultPageSize)}async getPage(e){return(e??0)<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const n of this)await e(n),t++;return t}async paginator(e){this.options.orderBy=Re.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t={where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include},n=()=>this.repo.find(t);if(this._aggregates===void 0&&lr(this.options,"aggregate")){let o=this.options.aggregate;if(this.repo._dataProvider.isProxy){const l=new Cr;n=()=>this.repo._rawFind(t,!1,l,async u=>{const f=await this.repo._edp.query(u,await this.repo.__buildGroupByOptions(o));return this._aggregates=f.aggregates,f.items}).then(async u=>(await l.resolveAll(),u))}else{let l=n();n=async()=>(this._aggregates=await this.repo.aggregate({...o,where:this.options.where}),this._count=this._aggregates.$count,l)}}let i=await n(),s=()=>{throw new Error("no more pages")},a=i.length==this.options.pageSize;if(a){let o=await this.repo._createAfterFilter(this.options.orderBy,i[i.length-1]);s=()=>this.paginator(o)}return{count:()=>this.count(),hasNextPage:a,items:i,nextPage:s,aggregates:this._aggregates}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=Re.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,n,i,s=0;return i=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),n===void 0||t==n.items.length){if(n&&!n.hasNextPage)return{value:void 0,done:!0};let a=n;if(n?n=await n.nextPage():n=await this.paginator(),t=0,n.items.length==0)return{value:void 0,done:!0};if(((a==null?void 0:a.items.length)??!1)&&this.repo.getEntityRef(a.items[0]).getId()==this.repo.getEntityRef(n.items[0]).getId())throw new Error("pagination failure, returned same first row")}return t<n.items.length?{value:n.items[t++],done:!1}:{done:!0,value:void 0}},{next:async()=>i()}}}class Is{constructor(e,t,n,i,s){d(this,"_entity");d(this,"_remult");d(this,"_dataProvider");d(this,"_info");d(this,"_defaultFindOptions");d(this,"__edp");d(this,"_idCache",new Map);d(this,"listeners");d(this,"_cache",new Map);this._entity=e,this._remult=t,this._dataProvider=n,this._info=i,this._defaultFindOptions=s}_notFoundError(e){return{message:`id ${e} not found in entity ${this.metadata.key}`,httpStatusCode:404}}[jr](){return this}async _createAfterFilter(e,t){let n=new Map;for(const a of Re.translateOrderByToSort(this.metadata,e).Segments){let o=t[a.field.key];n.set(a.field.key,o)}let i={$or:[]},s=[];for(const a of Re.translateOrderByToSort(this.metadata,e).Segments){let o={};for(const l of s)o[l.key]=n.get(l.key);s.push(a.field),a.isDescending?o[a.field.key]={$lt:n.get(a.field.key)}:o[a.field.key]={$gt:n.get(a.field.key)},i.$or.push(o)}return i}relations(e){return new Proxy({},{get:(t,n)=>{const i=this.fields.find(n),s=le(i);if(!s)throw Error(n+" is not a relation");const{toRepo:a,returnNull:o,returnUndefined:l}=this._getFocusedRelationRepo(i,e);return s.type==="toMany"?a:{findOne:u=>o?Promise.resolve(null):l?Promise.resolve(void 0):a.findFirst({},u)}}})}_getFocusedRelationRepo(e,t){const n=le(e);let i=n.toRepo,{findOptions:s,returnNull:a,returnUndefined:o}=this._findOptionsBasedOnRelation(n,e,void 0,t,i);return{toRepo:new Is(i._entity,i._remult,i._dataProvider,i._info,s),returnNull:a,returnUndefined:o}}get _edp(){return this.__edp?this.__edp:this.__edp=this._dataProvider.getEntityDataProvider(this.metadata)}async aggregate(e){return(await this.groupBy(e))[0]}async groupBy(e){var t=await this.__buildGroupByOptions(e);const n=await this._edp.groupBy(t);if(!(e!=null&&e[Uc])&&e.group){const i={include:{}};for(const a of e.group)i.include[a]=!0;const s=new Cr;await this._populateRelationsForFields(t.group,i,n,s),await s.resolveAll()}return n}async __buildGroupByOptions(e){var a,o,l,u,f,c;let t=await this._buildEntityDataProviderFindOptions({...e});const n=h=>{const p=this.metadata.fields.find(h);if(p===void 0)throw Error(`key "${h}" not found in entity`);return p},i=h=>{var p;if((p=e==null?void 0:e.group)!=null&&p.includes(h))throw Error(`field "${h}" cannot be used both in an aggregate and in group by`);return n(h)};var s={where:t.where,limit:t.limit,page:t.page,group:(a=e==null?void 0:e.group)==null?void 0:a.map(n),sum:(o=e==null?void 0:e.sum)==null?void 0:o.map(i),avg:(l=e==null?void 0:e.avg)==null?void 0:l.map(i),min:(u=e==null?void 0:e.min)==null?void 0:u.map(i),max:(f=e==null?void 0:e.max)==null?void 0:f.map(i),distinctCount:(c=e==null?void 0:e.distinctCount)==null?void 0:c.map(i)};if(e!=null&&e.orderBy){s.orderBy=[];for(const h in e.orderBy)if(Object.prototype.hasOwnProperty.call(e==null?void 0:e.orderBy,h)){const p=e.orderBy[h];if(p){if(typeof p=="string")s.orderBy.push({field:h==="$count"?void 0:n(h),isDescending:p==="desc",operation:h==="$count"?"count":void 0});else for(const y in p)if(Object.prototype.hasOwnProperty.call(p,y)){const m=p[y];s.orderBy.push({field:this.metadata.fields.find(h),isDescending:m==="desc",operation:y})}}}}return s}_getCachedById(e,t){e=e+"",this._getCachedByIdAsync(e,t);let n=this._idCache.get(e);if(!(n instanceof Promise))return n}async _getCachedByIdAsync(e,t){e=e+"";let n=this._idCache.get(e);if(n instanceof Promise)return await n;if(this._idCache.has(e))return n;if(t)return;this._idCache.set(e,void 0);let i=this.findId(e).then(s=>(s===void 0?n=null:n=s,this._idCache.set(e,n),n));return this._idCache.set(e,i),await i}_addToCache(e){e&&this._idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new md(e,this)}getEntityRef(e){let t=e[Ut];return t||(this._fixTypes(e),t=new _n(this._info,e,this,this._edp,this._remult,!0),Object.defineProperty(e,Ut,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=ee(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this._dataProvider.isProxy)return this._edp.delete(e);{let i=await this.findId(e);if(!i)throw this._notFoundError(e);return await ee(i).delete()}}let n=this._getRefForExistingRow(e,void 0);return this._dataProvider.isProxy||await n.reload(),n.delete()}__cleanupPartialObject(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n],s=this.fields[i];if(s){const a=le(s);a&&a.type==="toOne"&&a.options.field&&t.indexOf(a.options.field)>n&&a.toRepo.getEntityRef(e[i]).getId()!==e[a.options.field]&&delete e[i]}}for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n],le(this.fields[n]));for(const n of this.fields);}async insert(e){if(Array.isArray(e))if(this._dataProvider.isProxy){let t=[],n=[];for(const i of e){this.__cleanupPartialObject(i);let s=ee(e,!1);if(s){if(!s.isNew())throw"Item is not new"}else s=await this.getEntityRef(this.create(i));t.push(s),n.push(await s.buildDtoForInsert())}return tr(await this._edp.insertMany(n),(i,s)=>t[s].processInsertResponseDto(i))}else{let t=[];for(const n of e)t.push(await this.insert(n));return t}else{let t=ee(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return this.__cleanupPartialObject(e),await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let n=ee(e,!1);if(n||(n=this.getEntityRef({...e})),!t||t.length===0)return await n.validate();{n.__clearErrorsAndReportChanged();let i=!1;for(const s of t)await n.fields.find(s).validate()||(i=!0);return i?n.buildErrorInfoObject():void 0}}}__createDto(e){this.__cleanupPartialObject(e);const n=this.getEntityRef({...e}).copyDataToObject(!1),i=Object.keys(e);for(const s of this.fields)(s.dbReadOnly||!i.includes(s.key))&&delete n[s.key];return n}async updateMany({where:e,set:t}){if(this.__cleanupPartialObject(t),B.throwErrorIfFilterIsEmpty(e,"updateMany"),this._dataProvider.isProxy)return this._edp.updateMany(await this._translateWhereToFilter(e),this.__createDto({...t}));{let n=0;for await(const i of this.query({where:e,aggregate:void 0}))Er(i,t),await ee(i).save(),n++;return n}}async update(e,t){{let i=ee(t,!1);if(i)return await i.save()}{let i=ee(e,!1);if(i)return Er(e,t),i.save()}this.__cleanupPartialObject(t);let n;if(typeof e=="object"?(n=this._getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(n.instance,t)):n=this._getRefForExistingRow(t,e),this._dataProvider.isProxy)return await n.save(Object.keys(t));{const i=await n.reload();if(!i)throw this._notFoundError(n.id);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let a=n.fields[s];if(t[s]===void 0&&le(a.metadata))continue;a&&(i[s]=t[s])}return await this._fixTypes(i),await n.save()}}async upsert(e){if(this._dataProvider.isProxy){let s=await this._edp.upsertMany((Array.isArray(e)?e:[e]).map(l=>{var u;return(u=this._defaultFindOptions)!=null&&u.where&&(Ai(this.metadata,this._defaultFindOptions.where,l.where),this._fixTypes(l)),{where:this.__createDto(l.where),set:l.set?this.__createDto(l.set):void 0}}));const a=new Cr,o=await this._loadManyToOneForManyRows(s,{},a);return await a.resolveAll(),Array.isArray(e)?o:o[0]}if(Array.isArray(e))return tr(e,s=>this.upsert(s));let t=e;var n=await this.findFirst(t.where,{createIfNotFound:!0}),i=ee(n,!1);return i.isNew()?(t.set&&Er(n,t.set),await i.save()):t.set?(Er(n,t.set),await i.save()):n}_getRefForExistingRow(e,t){let n=ee(e,!1);if(!n){const i=new this._entity(this._remult);for(const a of this._fieldsOf(e)){const o=a.key;i[o]=e[o]}this._fixTypes(i);let s=new _n(this._info,i,this,this._edp,this._remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),n=s,Object.defineProperty(i,Ut,{get:()=>s})}return n}async save(e){if(Array.isArray(e))return tr(e,t=>this.save(t));{let t=ee(e,!1);if(t)return await t.save();if(e instanceof ol)return await this.getEntityRef(e).save();{let n=this.metadata.idMetadata.getId(e);return n===void 0?this.insert(e):this.update(n,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let n=t;return typeof t=="function"&&(n={next:t,complete:()=>{},error:()=>{}}),n.error??(n.error=()=>{}),n.complete??(n.complete=()=>{}),this._remult.liveQuerySubscriber.subscribe(this,e,n)}}}async _rawFind(e,t=!1,n,i){e||(e={}),this._defaultFindOptions&&(e={...this._defaultFindOptions,...e});let s=await this._buildEntityDataProviderFindOptions(e);t&&(delete s.orderBy,delete s.limit),tt.onFind(this._info,e);const a=await i(s);return await this._loadManyToOneForManyRows(a,e,n)}async find(e,t=!1){const n=new Cr,i=await this._rawFind(e,t,n,s=>this._edp.find(s));return await n.resolveAll(),i}async _buildEntityDataProviderFindOptions(e){e={...e};let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(this._dataProvider.isProxy||(e.orderBy=this._info.entityInfo.defaultOrderBy)),t.where=await this._translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=Re.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async _fromJsonArray(e,t){const n=new Cr,i=await this._loadManyToOneForManyRows(e.map(s=>{let a={};for(const o of this.metadata.fields.toArray())a[o.key]=o.valueConverter.fromJson(s[o.key]);return a}),t,n);return await n.resolveAll(),i}async _loadManyToOneForManyRows(e,t,n){let i;t!=null&&t.load&&(i=t.load(this.metadata.fields));for(const u of this.metadata.fields)if(xe(u.valueType,!1)&&!le(u)){let h=!u.options.lazy;if(i!==void 0&&(h=i.includes(u)),h){let p=this._remult.repo(u.valueType),y=[];for(const m of e){let g=m[u.key];g!=null&&!y.includes(g)&&!p._idCache.has(g+"")&&y.push(g)}y.length>0&&await s(p,y)}}async function s(u,f){let c=await u.find({where:u.metadata.idMetadata.getIdFilter(...f)},!0);for(const h of c)u._addToCache(h)}const a=new Set(this.fields.toArray().map(u=>{const f=this.__getRelationAndInclude(u,t);if(f.rel&&!f.incl)return u.key}).filter(u=>u!==void 0));let o=await tr(e,async u=>await this._mapRawDataToResult(u,i,a));const l=this.metadata.fields.toArray();return this._populateRelationsForFields(l,t,o,n),o}_populateRelationsForFields(e,t,n,i){for(const s of e){let{rel:a,incl:o}=this.__getRelationAndInclude(s,t);if(a)if(o){const l=a.toRepo;for(const u of n){let{findOptions:f,returnNull:c}=this._findOptionsBasedOnRelation(a,s,o,u,l);const h=s.key;if(c)u[h]=null;else{const p=a.toEntity,y=l;i.load({entityType:p,find:m=>y._rawFind(m,!1,i,g=>y._edp.find(g)),metadata:y.metadata},f).then(m=>{m.length==0&&a.type=="toOne"||(u[h]=a.type!=="toMany"?m.length==0?null:m[0]:m)})}}}else for(const l of n)Reflect.deleteProperty(l,s.key)}}__getRelationAndInclude(e,t){var a;let n=le(e),i=e.options.defaultIncluded;const s=(a=t==null?void 0:t.include)==null?void 0:a[e.key];return s!==void 0&&(i=s),{rel:n,incl:i}}_findOptionsBasedOnRelation(e,t,n,i,s){let a=!1,o=!1,l=[],u={},f=[];typeof e.options.findOptions=="function"?f.push(e.options.findOptions(i)):typeof e.options.findOptions=="object"&&f.push(e.options.findOptions),typeof n=="object"&&f.push(n);for(const p of f){p.where&&l.push(p.where);for(const y of["limit","include","orderBy"])p[y]&&(u[y]=p[y])}const c=e.getFields(),h=p=>{const y=ee(i,!1);let m=e.type==="reference"&&y?y.fields.find(t.key).getId():i[p];return(e.type==="toOne"||e.type==="reference")&&(m===null?a=!0:m===void 0?o=!0:e.type==="reference"&&typeof m=="object"&&(m=s.metadata.idMetadata.getId(m))),m};c.compoundIdField&&(e.type==="toMany"?l.push({[c.compoundIdField]:this.metadata.idMetadata.getId(i)}):l.push(s.metadata.idMetadata.getIdFilter(h(c.compoundIdField))));for(const p in c.fields)Object.prototype.hasOwnProperty.call(c.fields,p)&&l.push({[p]:h(c.fields[p])});return u.where={$and:l},(e.type==="toOne"||e.type==="reference")&&u.orderBy&&(u.limit=1),{findOptions:u,returnNull:a,returnUndefined:o}}async _mapRawDataToResult(e,t,n){let i=new this._entity(this._remult),s=new _n(this._info,i,this,this._edp,this._remult,!1,n);return Object.defineProperty(i,Ut,{get:()=>s}),await s.loadDataFrom(e,t),s.saveOriginalData(),i}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(i=>this.fromJson(i,t));let n=new this._entity(this._remult);for(const i of this._fieldsOf(e)){const s=i.key;if(xe(i.valueType,!1)){let o=e[i.key];typeof o=="string"||typeof o=="number"?n[s]=o:n[s]=this._remult.repo(i.valueType).fromJson(o)}else e[s]!==void 0&&(n[s]=i.valueConverter.fromJson(e[i.key]))}if(this._fixTypes(n),t)return this.create(n);{let i=new _n(this._info,n,this,this._edp,this._remult,!1);return Object.defineProperty(n,Ut,{get:()=>i}),i.id=i.getId(),i.saveOriginalData(),i.originalId=i.id,n}}async count(e){return this._edp.count(await this._translateWhereToFilter(e))}async deleteMany({where:e}){if(B.throwErrorIfFilterIsEmpty(e,"deleteMany"),this._dataProvider.isProxy)return this._edp.deleteMany(await this._translateWhereToFilter(e));{let t=0;for await(const n of this.query({where:e,aggregate:void 0}))await ee(n).delete(),t++;return t}}async findOne(e,t=!1){let n,i,s=e??{};if(s.useCache){let a=_s(s,this.metadata),o=JSON.stringify(a);if(i=this._cache.get(o),i!==void 0)if(i.value&&this.getEntityRef(i.value).wasDeleted())i=void 0,this._cache.delete(o);else return i.promise;else i={value:void 0,promise:void 0},this._cache.set(o,i)}return n=this.find({...s,limit:1},t).then(async a=>{let o;return a.length>0&&(o=a[0]),!o&&s.createIfNotFound&&(o=this.create(),s.where&&await Ai(this.metadata,s.where,o)),o}),i&&(i.promise=n=n.then(a=>(i.value=a,a))),n}async findFirst(e,t,n=!1){if(t||(t={}),e)if(t.where){let i=t.where;t.where={$and:[i,e]}}else t.where=e;return this.findOne(t,n)}_fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(n=>t.includes(n.key))}create(e){var n;let t=new this._entity(this._remult);if(e){for(const i of this._fieldsOf(e)){const s=i.key;t[s]=e[s]}this._fixTypes(t)}return(n=this._defaultFindOptions)!=null&&n.where&&(Ai(this.metadata,this._defaultFindOptions.where,t),this._fixTypes(t)),this.getEntityRef(t),t}async _fixTypes(e){for(const t of this._fieldsOf(e)){const n=e[t.key];if(n!=null)if(t.valueType===Date&&!(n instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n));else for(const[i,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===i&&typeof n!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n)))}return e}findId(e,t){if(e==null)return Promise.resolve(null);if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async _translateWhereToFilter(e){var i,s;let t=e??{};(i=this._defaultFindOptions)!=null&&i.where&&(t={$and:[t,(s=this._defaultFindOptions)==null?void 0:s.where]}),this._dataProvider.isProxy||(this.metadata.options.backendPreprocessFilter&&(t=await this.metadata.options.backendPreprocessFilter(t,{metadata:this.metadata,getFilterPreciseValues:a=>B.getPreciseValues(this.metadata,a||t)})),this.metadata.options.backendPrefilter&&(t={$and:[t,await B.resolve(this.metadata.options.backendPrefilter)]}));let n=await B.fromEntityFilter(this.metadata,t);return n&&!this._dataProvider.isProxy&&(n=await B.translateCustomWhere(n,this.metadata,this._remult)),n}}function gd(r,e){let t=N.columnsOfType.get(r);t||N.columnsOfType.set(r,t=[]);let n=xe(r)(e),i=Fc(r),s=Object.getPrototypeOf(r);for(;s!=null;){let a=N.columnsOfType.get(s);a&&t.unshift(...a.filter(l=>!t.find(u=>u.key==l.key)));let o=xe(s,!1);if(o){let l=o(e);n={...l,...n};let u=["saving","saved","deleting","deleted","validation"];for(const f of u)if(l[f]&&l[f]!==n[f]){let c=n[f];n[f]=async(h,p)=>{await c(h,p),await l[f](h,p)}}}s=Object.getPrototypeOf(s)}return new bd(nl(t,e),n,e,r,i)}class rl{constructor(e,t,n,i,s){d(this,"fieldsMetadata");d(this,"instance");d(this,"remult");d(this,"isNewRow");d(this,"_error");d(this,"_subscribers");d(this,"_isLoading",!1);d(this,"lookups",new Map);d(this,"errors");d(this,"originalValues",{});this.fieldsMetadata=e,this.instance=t,this.remult=n,this.isNewRow=i;{let a=n;a!=null&&a.iAmRemultProxy&&(n=N.remultFactory())}for(const a of e)if(xe(a.valueType,!1)&&n){let l=new Vc(n.repo(a.valueType),!!le(a),a.allowNull);this.lookups.set(a.key,l);let u=t[a.key],f;Object.defineProperty(t,a.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),f||(f=this.fields.find(a.key),f._subscribers||(f._subscribers=new bn)),f._subscribers.reportObserved()),l.item),set:c=>{var h;l.set(c),(h=this._subscribers)==null||h.reportChanged(),f||(f=this.fields.find(a.key),f._subscribers||(f._subscribers=new bn)),f._subscribers.reportChanged()},enumerable:!(s!=null&&s.has(a.key))}),l.set(u)}else{const l=le(a);if((l==null?void 0:l.type)==="toOne"){let u=t.hasOwnProperty(a.key),f=t[a.key];i&&!f&&(u=!1),Object.defineProperty(t,a.key,{get:()=>f,set:c=>{if(f=c,c===void 0)return;const h=a.options;if(h.field&&(this.instance[h.field]=l.toRepo.metadata.idMetadata.getId(c)),h.fields){for(const p in h.fields)if(Object.prototype.hasOwnProperty.call(h.fields,p)){const y=h.fields[p];this.instance[y]=c==null?null:c[p]}}},enumerable:!(s!=null&&s.has(a.key))}),u&&(t[a.key]=f)}}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new bn;const e=this._subscribers;for(const t of this.fieldsMetadata){let n=xe(t.valueType,!1),i=this.fields.find(t.key);if(i._subscribers=new bn,!(n&&this.remult||le(t))){let s=this.instance[t.key];Object.defineProperty(this.instance,t.key,{get:()=>(e.reportObserved(),i._subscribers.reportObserved(),s),set:a=>{s=a,e.reportChanged(),i._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await tr([...this.lookups.values()],e=>e.waitLoad())}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){var t;let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const n of this.fieldsMetadata)if((t=this.errors)!=null&&t[n.key]){e.message=this.fields[n.key].metadata.caption+": "+this.errors[n.key],this.error=e.message;break}}return new tl(e)}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(i=>this.catchSaveErrors(i));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let n=t.modelState;throw n||(n=t.ModelState),n&&(this.errors=n),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const n of this.fieldsMetadata){let i=this.lookups.get(n.key),s;const a=le(n);i?s=i.id:s=this.instance[n.key],a&&e&&!n.allowNull&&s==null&&(a.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!a||a.type==="reference")&&(s!==void 0&&(s=n.valueConverter.toJson(s),s!=null&&(s=n.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[n.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let n={};for(const i of this.fieldsMetadata)if(t||!this.remult||i.includedInApi(this.instance)){let s,a=this.lookups.get(i.key),o=!1;a?e?(s=a.toJson(),o=!0,n[i.key]=s):s=a.id:le(i)&&!e?o=!0:(s=this.instance[i.key],this.remult||s&&xe(s.constructor,!1)&&(s=ee(s).getId())),o||(n[i.key]=i.valueConverter.toJson(s))}return n}async _updateEntityBasedOnApi(e,t=!1){let n=Object.keys(e);for(const i of this.fieldsMetadata)if(n.includes(i.key)&&i.includedInApi(this.instance)&&(!this.remult||t||i.apiUpdateAllowed(this.instance))){let s=this.lookups.get(i.key);s?s.id=e[i.key]:this.instance[i.key]=i.valueConverter.fromJson(e[i.key])}await tr([...this.fields].filter(i=>!le(i.metadata)),i=>i.load())}}class _n extends rl{constructor(t,n,i,s,a,o,l){super(t.fieldsMetadata,n,a,o,l);d(this,"info");d(this,"repo");d(this,"edp");d(this,"_isNew");d(this,"repository");d(this,"metadata");d(this,"_wasDeleted",!1);d(this,"_columns");d(this,"_saving",!1);d(this,"id");d(this,"originalId");if(this.info=t,this.repo=i,this.edp=s,this._isNew=o,this.repository=i,this.metadata=t,o)for(const u of t.fieldsMetadata){const f=u.key;u.options.defaultValue&&n[f]===void 0&&(typeof u.options.defaultValue=="function"?n[f]=u.options.defaultValue(n):n[f]||(n[f]=u.options.defaultValue))}this.info.entityInfo.entityRefInit&&this.info.entityInfo.entityRefInit(this,n),tt.entityRefInit&&tt.entityRefInit(this,n)}clone(){const t=this.toApiJson(!0,!0);return this.repo.fromJson(t,this.isNew())}get relations(){return this.repo.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=n=>{let i=this.lookups.get(n.key);return i?i.id:this.instance[n.key]};return this.metadata.idMetadata.field instanceof Vt?this.metadata.idMetadata.field.getId(t):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:await this.getIdFilter()}).then(async t=>{if(t.length===0)throw this.repo._notFoundError(this.id);await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],n={find:i=>n[typeof i=="string"?i:i.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const i of this.info.fieldsMetadata)t.push(n[i.key]=new ei(i.options,i,this.instance,this,this));this._columns=n}return this._columns}async save(t){var n,i;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let s=!1,a=this.buildLifeCycleEvent(()=>s=!0);if(!this.repo._dataProvider.isProxy){for(const c of this.fields)c.metadata.options.saving&&await c.metadata.options.saving(this.instance,c,a);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,a)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),l=[];for(const c of this.metadata.fields)if(c.dbReadOnly||t!==void 0&&!t.includes(c.key)){o[c.key]=void 0,l.push(c.key);let h=this.fields.find(c);h.value=h.originalValue}let u,f=this.isNew();try{if((n=this._subscribers)==null||n.reportChanged(),this.isNew())s?u=(u=await this.edp.find({where:await this.getIdFilter()}))[0]:u=await this.edp.insert(o);else{let c={},h=!1;for(const p in o)if(Object.prototype.hasOwnProperty.call(o,p)){const y=o[p];this.fields.find(p).valueChanged()&&!l.includes(p)&&y!==void 0&&(c[p]=y,h=!0)}if(!h)return this.instance;if(s)u=(await this.edp.find({where:await this.getIdFilter()}))[0];else{if(this.id===void 0)throw new Error("Invalid operation, id is undefined");u=await this.edp.update(this.id,c)}}if(u&&await this.loadDataFrom(u),a.id=this.getId(),!this.repo._dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,a),this.repo.listeners))for(const c of this.repo.listeners)await((i=c.saved)==null?void 0:i.call(c,this.instance,f));return this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(c){throw await this.catchSaveErrors(c)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}async processInsertResponseDto(t){return await this.loadDataFrom(t),this.saveOriginalData(),this._isNew=!1,this.instance}async buildDtoForInsert(){await this.__validateEntity(),this.__assertValidity();let t=this.copyDataToObject(this.isNew());for(const n of this.metadata.fields)if(n.dbReadOnly){t[n.key]=void 0;let i=this.fields.find(n);i.value=i.originalValue}return t}buildLifeCycleEvent(t=()=>{}){const n=this;return{isNew:n.isNew(),fields:n.fields,id:n.getId(),originalId:n.getOriginalId(),metadata:n.repo.metadata,repository:n.repo,preventDefault:()=>t(),relations:n.repo.relations(n.instance)}}async getIdFilter(){return await this.repo._translateWhereToFilter(this.repo.metadata.idMetadata.getIdFilter(this.id))}async delete(){var i;this.__clearErrorsAndReportChanged();let t=!0,n=this.buildLifeCycleEvent(()=>t=!1);this.repo._dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,n),this.__assertValidity();try{if(t){if(this.id===void 0)throw new Error("Invalid operation, id is undefined");await this.edp.delete(this.id)}if(this.repo._dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,n),this.repo.listeners)for(const s of this.repo.listeners)await((i=s.deleted)==null?void 0:i.call(s,this.instance));this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(s){throw await this.catchSaveErrors(s)}}async loadDataFrom(t,n){for(const i of this.info.fields){let s=this.lookups.get(i.key);s?(s.id=t[i.key],n===void 0?!i.options.lazy&&!le(i)&&await s.waitLoad():n.includes(i)&&await s.waitLoad()):le(i)||(t[i.key]===void 0?delete this.instance[i.key]:this.instance[i.key]=t[i.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(!this.repo._dataProvider.isProxy){for(const t of this.info.fieldsMetadata)if(t.options.serverExpression){const n=await t.options.serverExpression(this.instance);n!==void 0&&(this.instance[t.key]=n)}}}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const n of this.fields){const i=le(n.metadata);if((!i||i.type=="reference")&&n.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){var t;for(const n of this.fieldsMetadata)n.options.validate&&await new ei(n.options,n,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let n=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,n)}if(this.repo.listeners)for(const n of this.repo.listeners)await((t=n.validating)==null?void 0:t.call(n,this.instance))}}const oa=Symbol.for("controllerColumns");function nl(r,e){return r.map(t=>ks(t.settings(e),e))}function la(r,e){const t=e||Te;let n=r[oa];if(n||(n=r[Ut]),!n){let i=N.columnsOfType.get(r.constructor);i||N.columnsOfType.set(r.constructor,i=[]);let s=Object.getPrototypeOf(r.constructor);for(;s!=null;){let a=N.columnsOfType.get(s);a&&i.unshift(...a.filter(o=>!i.find(l=>l.key==o.key))),s=Object.getPrototypeOf(s)}r[oa]=n=new wd(nl(i,t).map(a=>new sl(a,void 0,t)),r,t)}return n}class wd extends rl{constructor(t,n,i){super(t,n,i,!1);d(this,"fields");let s=[],a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>s[Symbol.iterator](),toArray:()=>s};for(const o of t)s.push(a[o.key]=new ei(o.options,o,n,void 0,this));this.fields=a}async __performColumnAndEntityValidations(){for(const t of this.fields)t instanceof ei&&await t.__performValidation()}}class ei{constructor(e,t,n,i,s){d(this,"settings");d(this,"metadata");d(this,"container");d(this,"helper");d(this,"rowBase");d(this,"_subscribers");d(this,"target");d(this,"entityRef");this.settings=e,this.metadata=t,this.container=n,this.helper=i,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}get key(){return this.metadata.key}get repo(){var e;return(e=this.helper)==null?void 0:e.repository}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=le(this.metadata);if(t&&this.helper){if(t.type==="toMany")return this.container[this.metadata.key]=await this.repo.relations(this.container)[this.key].find();{let n=await this.repo.relations(this.container)[this.metadata.key].findOne();if(n)this.container[this.metadata.key]=n;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=n=>{n!==!0&&n!==void 0&&!this.error&&(typeof n=="string"&&n.length>0?this.error=n:this.error="invalid value")};if(this.settings.validate){let n=this,i={entityRef:this.entityRef,get error(){return n.error},set error(s){n.error=s},isNew:((e=this.entityRef)==null?void 0:e.isNew())??!1,load:()=>n.load(),metadata:n.metadata,originalValue:n.originalValue,value:n.value,valueChanged:()=>n.valueChanged(),originalValueIsNull:()=>n.originalValueIsNull(),valueIsNull:()=>n.valueIsNull(),isBackend:()=>{var s,a,o;return!((o=(a=(s=n.rowBase)==null?void 0:s.remult)==null?void 0:a.dataProvider)!=null&&o.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,i));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,i))}}catch(t){typeof t=="string"?this.error=t:this.error=t==null?void 0:t.message}}async validate(){return await this.__performValidation(),!this.error}}let vd={transformCaption:(r,e,t,n)=>t};const Fi=N.fieldOptionsEnricher||{enrichFieldOptions:r=>r},_d=N.captionTransformer||(N.captionTransformer=vd);function il(r,e,t,n){let i;return typeof r=="function"?t&&(i=r(t)):r&&(i=r),i=_d.transformCaption(t,e,i??"",n),i||(e?Hi(e):"")}class sl{constructor(e,t,n){d(this,"settings");d(this,"entityDefs");d(this,"remult");d(this,"options");d(this,"target");d(this,"readonly",!1);d(this,"valueConverter");d(this,"allowNull");d(this,"caption");d(this,"dbName");d(this,"inputType");d(this,"key");d(this,"isServerExpression",!1);d(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=n,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter??{},{get:(i,s)=>{let a=i[s];return typeof a=="function"?(...o)=>{try{return i[s](...o)}catch(l){const u=`${String(s)} failed for value ${o==null?void 0:o[0]}. Error: ${typeof l=="string"?l:l.message}`;throw new tl({message:this.caption+": "+u,modelState:{[this.key]:u}})}}:a}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=il(e.caption,e.key,n,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return Es(this,this.entityDefs)}get dbReadOnly(){return!!this.settings.dbReadOnly}}class bd{constructor(e,t,n,i,s){d(this,"entityInfo");d(this,"remult");d(this,"entityType");d(this,"key");d(this,"options");d(this,"fieldsMetadata",[]);d(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=ee(e,!1);return t?t.getId():this.idMetadata.field instanceof Vt?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,get fields(){return this.field instanceof Vt?this.field.fields:[this.field]},createIdInFilter:e=>e.length>0?{$or:e.map(t=>this.idMetadata.getIdFilter(ee(t).getId()))}:{[this.fields.toArray()[0].key]:[]},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof Vt){let t=this.idMetadata.field;return e.length==1?t.isEqualTo(e[0]):{$or:e.map(n=>t.isEqualTo(n))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});d(this,"fields");d(this,"dbName");d(this,"caption");if(this.entityInfo=t,this.remult=n,this.entityType=i,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let o;typeof this.options.allowApiCrud=="function"?o=(l,u)=>this.options.allowApiCrud(u):o=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.entityInfo.allowApiDelete=o),this.options.allowApiInsert===void 0&&(this.entityInfo.allowApiInsert=o),this.options.allowApiUpdate===void 0&&(this.entityInfo.allowApiUpdate=o),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=i.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const o of e)this.fieldsMetadata.push(a[o.key]=new sl(o,this,n));if(this.fields=a,this.caption=il(t.caption,this.key,n,this),t.id){let o=typeof t.id=="string"?this.fields.find(t.id):Array.isArray(t.id)?t.id.map(l=>this.fields.find(l)):typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(o)?o.length>1?this.idMetadata.field=new Vt(...o):o.length==1&&(this.idMetadata.field=o[0]):this.idMetadata.field=o}if(!this.idMetadata.field){const o=this.fields.id;o?this.idMetadata.field=o:this.idMetadata.field=[...this.fields][0]}}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=ee(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return fl(this)}}function Id(...r){return(e,t)=>(r||(r=[]),r.splice(0,0,{valueType:e}),e[Os]=r,e)}function Od(r){var e,t;return((t=(e=r.options)==null?void 0:e.valueConverter)==null?void 0:t.fieldTypeInDb)==="autoincrement"}function kd(...r){return(e,t)=>{Id(n=>{n.valueConverter=ti.get(e),n.displayValue=(i,s)=>s==null?void 0:s.caption,n.validate=(i,s)=>{const a=ti.get(e).getValues();return s.value&&!a.find(o=>o===s.value)&&(s.value=a.find(o=>o.id===s.value.id)||s.value),He.in(a)(i,s)}},...r)(e)}}class ti{constructor(e){d(this,"valueListType");d(this,"byIdMap",new Map);d(this,"values",[]);d(this,"isNumeric",!1);d(this,"fieldTypeInDb");d(this,"inputType");this.valueListType=e;for(let n in this.valueListType){let i=this.valueListType[n];i instanceof this.valueListType&&(i.id===void 0&&(i.id=n),typeof i.id=="number"&&(this.isNumeric=!0),i.caption===void 0&&(i.caption=Hi(i.id!==void 0?i.id.toString():n)),this.byIdMap.set(i.id,i),this.values.push(i))}this.isNumeric&&(this.fieldTypeInDb="integer");var t=this.valueListType[Os];if(t){for(const n of t)n!=null&&n.getValues&&(this.values.splice(0,this.values.length,...n.getValues()),this.byIdMap.clear(),this.values.forEach(i=>{i.caption===void 0&&i.id!==void 0&&(i.caption=Hi(i.id)),this.byIdMap.set(i.id,i)}));if(this.values.find(n=>n.id===void 0))throw new Error(`ValueType ${this.valueListType} has values without an id`)}else throw new Error("ValueType not yet initialized, did you forget to call @ValueListFieldType on "+e)}static get(e){let t=ua.get(e);return t||(t=new ti(e),ua.set(e,t)),t}getValues(){return this.values}byId(e){return this.isNumeric&&(e=+e),this.byIdMap.get(e)}fromJson(e){return this.byId(e)}toJson(e){if(e)return e.id}fromDb(e){return this.fromJson(e)}toDb(e){return this.toJson(e)}toInput(e,t){return this.toJson(e)}fromInput(e,t){return this.fromJson(e)}displayValue(e){return e?e.caption:""}}const ua=new Map,Os=Symbol.for("storableMember"),Pi=Symbol.for("fieldOptionalValues");function al(r,e){var n;let t={};for(const i of r)if(i)if(typeof i=="function")i(t,e);else{const{validate:s,...a}=i;t.validate=An(t.validate,s),Object.assign(t,a)}return(n=Fi.enrichFieldOptions)==null||n.call(Fi,t),t}function ks(r,e){if(r.valueType){let i=r.valueType[Os];i&&(r=al([...i,r],e))}if(r.valueType==String){let i=r;r.valueConverter||(i.valueConverter=Ee.String)}if(r.valueType==Number){let i=r;r.valueConverter||(i.valueConverter=Ee.Number)}if(r.valueType==Date){let i=r;r.valueConverter||(i.valueConverter=Ee.Date)}if(r.valueType==Boolean){let i=r;i.valueConverter||(i.valueConverter=Ee.Boolean)}if(!r.valueConverter){if(xe(r.valueType,!1)){let s;r.valueConverter={toDb:a=>a,fromDb:a=>a},r.valueConverter=new Proxy(r.valueConverter,{get(a,o){if(a[o]===void 0&&s===void 0){if(o==="inputType")return"";s=e.repo(r.valueType).metadata.idMetadata.field.valueType===Number;for(const l of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])a[l]=s?Ee.Integer[l]:Ee.String[l]}return a[o]},set(a,o,l,u){return a[o]=l,!0}})}else r.valueConverter=Ee.Default;return r}r.valueConverter.toJson||(r.valueConverter.toJson=i=>i),r.valueConverter.fromJson||(r.valueConverter.fromJson=i=>i);const t=r.valueConverter.fromJson,n=r.valueConverter.toJson;return r.valueConverter.toDb||(r.valueConverter.toDb=i=>n(i)),r.valueConverter.fromDb||(r.valueConverter.fromDb=i=>t(i)),r.valueConverter.toInput||(r.valueConverter.toInput=i=>n(i)),r.valueConverter.fromInput||(r.valueConverter.fromInput=i=>t(i)),r}class ol{get _(){return ee(this)}save(){return ee(this).save()}assign(e){return Er(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class bn{constructor(){d(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(n=>n!=t)}}function Ed(r){return r.metadata?r.metadata:xe(r,!1)?Te.repo(r).metadata:r}function Cd(r){return xe(r,!1)?Te.repo(r):r}async function tr(r,e){const t=[];for(let n=0;n<r.length;n++){const i=r[n];t.push(await e(i,n))}return t}const rr=class rr{constructor(e){d(this,"sql");d(this,"wrapIdentifier",e=>e);d(this,"provideMigrationBuilder");d(this,"createdEntities",[]);d(this,"end");this.sql=e,e.wrapIdentifier&&(this.wrapIdentifier=t=>e.wrapIdentifier(t)),lr(e,"provideMigrationBuilder")&&(this.provideMigrationBuilder=t=>e.provideMigrationBuilder(t)),lr(e,"end")&&(this.end=()=>e.end())}static getDb(e){const t=e||Te.dataProvider;if(lr(t,"createCommand"))return t;throw"the data provider is not an SqlCommandFactory"}createCommand(){return new Td(this.sql.createCommand(),rr.LogToConsole)}async execute(e){return await this.createCommand().execute(e)}_getSourceSql(){return this.sql}async ensureSchema(e){this.sql.ensureSchema&&await this.sql.ensureSchema(e)}getEntityDataProvider(e){if(!this.sql.supportsJsonColumnType)for(const t of e.fields.toArray())t.valueConverter.fieldTypeInDb==="json"&&(t.valueConverter={...t.valueConverter,toDb:Ee.JsonString.toDb,fromDb:Ee.JsonString.fromDb});return new ll(e,this,async t=>{this.createdEntities.indexOf(t.$entityName)<0&&(this.createdEntities.push(t.$entityName),await this.sql.entityIsUsedForTheFirstTime(e))},this.sql)}transaction(e){return this.sql.transaction(async t=>{let n=!1;try{await e(new rr({createCommand:()=>{let i=t.createCommand();return{addParameterAndReturnSqlToken:s=>i.param(s),param:s=>i.param(s),execute:async s=>{if(n)throw"can't run a command after the transaction was completed";return i.execute(s)}}},getLimitSqlSyntax:this.sql.getLimitSqlSyntax,entityIsUsedForTheFirstTime:i=>t.entityIsUsedForTheFirstTime(i),transaction:i=>t.transaction(i),supportsJsonColumnType:this.sql.supportsJsonColumnType,wrapIdentifier:this.wrapIdentifier,end:this.end,doesNotSupportReturningSyntax:this.sql.doesNotSupportReturningSyntax,doesNotSupportReturningSyntaxOnlyForUpdate:this.sql.doesNotSupportReturningSyntaxOnlyForUpdate,orderByNullsFirst:this.sql.orderByNullsFirst}))}finally{n=!0}})}static rawFilter(e){return{[Qo]:{buildSql:e}}}static async filterToRaw(e,t,n,i,s){n||(n=new Ad);const a=Cd(e);var o=new Ot(n,i||await ul(a.metadata,s));return o._addWhere=!1,await(await Ht(a)._translateWhereToFilter(t)).__applyToConsumer(o),await o.resolveWhere()}};d(rr,"LogToConsole",!1),d(rr,"durationThreshold",0);let hr=rr;const Sd=new Map([["INSERT",""],["SELECT",""],["UPDATE",""],["DELETE",""],["CREATE",""],["ALTER",""],["DROP",""],["TRUNCATE",""],["GRANT",""],["REVOKE",""]]);class Td{constructor(e,t){d(this,"origin");d(this,"logToConsole");d(this,"args",{});this.origin=e,this.logToConsole=t}addParameterAndReturnSqlToken(e){return this.param(e)}param(e,t){let n=this.origin.param(e);return this.args[n]=e,n}async execute(e){try{let n=new Date,i=await this.origin.execute(e);if(this.logToConsole!==!1){var t=new Date().valueOf()-n.valueOf();if(t>=hr.durationThreshold){const s=t/1e3;if(this.logToConsole==="oneLiner"){const a=e.replace(/(\r\n|\n|\r|\t)/gm," ").replace(/  +/g," ").trim(),o=a.split(" ")[0].toUpperCase();console.info(`${Sd.get(o)||""} (${s.toFixed(3)}) ${a} ${JSON.stringify(this.args)}`)}else typeof this.logToConsole=="function"?this.logToConsole(s,e,this.args):console.info(e+`
`,{arguments:this.args,duration:s})}}return i}catch(n){throw console.error((n.message||"Sql Error")+`:
`,e,{arguments:this.args,error:n}),n}}}class ll{constructor(e,t,n,i){d(this,"entity");d(this,"sql");d(this,"iAmUsed");d(this,"strategy");this.entity=e,this.sql=t,this.iAmUsed=n,this.strategy=i}async init(){let e=await ul(this.entity,t=>this.sql.wrapIdentifier(t));return await this.iAmUsed(e),e}async count(e){let t=await this.init(),n="select count(*) count from "+t.$entityName,i=this.sql.createCommand();if(e){let s=new Ot(i,t);e.__applyToConsumer(s),n+=await s.resolveWhere()}return i.execute(n).then(s=>Number(s.rows[0].count))}async groupBy(e){return await Fd(e,await this.init(),this.sql.createCommand(),this.sql._getSourceSql().orderByNullsFirst,this.sql._getSourceSql().getLimitSqlSyntax)}async find(e){let t=await this.init(),{colKeys:n,select:i}=this.buildSelect(t);i="select "+i,i+=`
 from `+t.$entityName;let s=this.sql.createCommand();if(e){if(e.where){let a=new Ot(s,t);e.where.__applyToConsumer(a),i+=await a.resolveWhere()}if(e.limit&&(e.orderBy=Re.createUniqueSort(this.entity,e.orderBy)),e.orderBy||(e.orderBy=Re.createUniqueSort(this.entity,new Re)),e.orderBy){let a=!0,o=[];for(const l of e.orderBy.Segments)o.push(l);for(const l of o)a?(i+=" Order By ",a=!1):i+=", ",i+=t.$dbNameOf(l.field),l.isDescending&&(i+=" desc"),this.sql._getSourceSql().orderByNullsFirst&&(l.isDescending?i+=" nulls last":i+=" nulls first")}if(e.limit){let a=1;e.page&&(a=e.page),a<1&&(a=1),i+=" "+this.strategy.getLimitSqlSyntax(e.limit,(a-1)*e.limit)}}return s.execute(i).then(a=>a.rows.map(o=>this.buildResultRow(n,o,a)))}buildResultRow(e,t,n){let i={};for(let s=0;s<e.length;s++){const a=e[s];try{i[a.key]=a.valueConverter.fromDb(t[n.getColumnKeyInResultForIndexInSelect(s)])}catch(o){throw new Error("Failed to load from db:"+a.key+`\r
`+o)}}return i}buildSelect(e){let t="",n=[];for(const i of this.entity.fields)i.isServerExpression||(n.length>0&&(t+=", "),t+=e.$dbNameOf(i),i.options.sqlExpression&&(t+=" as "+i.key),n.push(i));return{colKeys:n,select:t}}async update(e,t){let n=await this.init(),i=this.sql.createCommand(),s="update "+n.$entityName+" set ",a=!1;for(const h of this.entity.fields)if(!ca(h,n)){if(t[h.key]!==void 0){let p=h.valueConverter.toDb(t[h.key]);p!==void 0&&(a?s+=", ":a=!0,s+=n.$dbNameOf(h)+" = "+i.param(p))}}const o=this.entity.idMetadata.getIdFilter(e);let l=new Ot(i,n);B.fromEntityFilter(this.entity,o).__applyToConsumer(l),s+=await l.resolveWhere();let{colKeys:u,select:f}=this.buildSelect(n),c=!0;return this.sql._getSourceSql().doesNotSupportReturningSyntax&&(c=!1),c&&this.sql._getSourceSql().doesNotSupportReturningSyntaxOnlyForUpdate&&(c=!1),c&&(s+=" returning "+f),i.execute(s).then(h=>{var p,y;if((y=(p=this.sql._getSourceSql()).afterMutation)==null||y.call(p),!c)return fa(this.entity,this,t,e,"update");if(h.rows.length!=1)throw new Error("Failed to update row with id "+e+", rows updated: "+h.rows.length);return this.buildResultRow(u,h.rows[0],h)})}async delete(e){let t=await this.init(),n=this.sql.createCommand(),i=new Ot(n,t);B.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(i);let s="delete from "+t.$entityName;return s+=await i.resolveWhere(),n.execute(s).then(()=>{var a,o;(o=(a=this.sql._getSourceSql()).afterMutation)==null||o.call(a)})}async insert(e){let t=await this.init(),n=this.sql.createCommand(),i="",s="",a=!1;for(const f of this.entity.fields)if(!ca(f,t)){let c=f.valueConverter.toDb(e[f.key]);c!=null&&(a?(i+=", ",s+=", "):a=!0,i+=t.$dbNameOf(f),s+=n.param(c))}let o=`insert into ${t.$entityName} (${i}) values (${s})`,{colKeys:l,select:u}=this.buildSelect(t);return this.sql._getSourceSql().doesNotSupportReturningSyntax||(o+=" returning "+u),await n.execute(o).then(f=>{var c,h;if((h=(c=this.sql._getSourceSql()).afterMutation)==null||h.call(c),this.sql._getSourceSql().doesNotSupportReturningSyntax)if(Od(this.entity.idMetadata.field)){const p=f.rows[0];if(typeof p!="number")throw new Error("Auto increment, for a database that is does not support returning syntax, should return an array with the single last added id. Instead it returned: "+JSON.stringify(p));return this.find({where:new B(y=>y.isEqualTo(this.entity.idMetadata.field,p))}).then(y=>y[0])}else return fa(this.entity,this,e,void 0,"insert");return this.buildResultRow(l,f.rows[0],f)})}}d(ll,"LogToConsole",!1);class Ad{execute(e){throw new Error("Method not implemented.")}addParameterAndReturnSqlToken(e){return this.param(e)}param(e){return e===null?"null":(e instanceof Date&&(e=e.toISOString()),typeof e=="string"?(e==null&&(e=""),"'"+e.replace(/'/g,"''")+"'"):e.toString())}}function fa(r,e,t,n,i){const s=n!==void 0?r.idMetadata.getIdFilter(n):{};return e.find({where:new B(a=>{for(const o of r.idMetadata.fields)a.isEqualTo(o,t[o.key]??s[o.key])})}).then(a=>{if(a.length!=1)throw new Error(`Failed to ${i} row - result contained ${a.length} rows`);return a[0]})}async function Fd(r,e,t,n,i){let s="select count(*) as count",a="";const o=[];if(o.push((c,h)=>{h[jc]=Number(c)}),r!=null&&r.group)for(const c of r==null?void 0:r.group)c.isServerExpression||(s+=", "+e.$dbNameOf(c),c.options.sqlExpression&&(s+=" as "+c.key),a==""?a=" group by ":a+=", ",a+=e.$dbNameOf(c)),o.push((h,p)=>{p[c.key]=c.valueConverter.fromDb(h)});for(const c of Jc){const h=r==null?void 0:r[c];if(h)for(const p of h){if(!p.isServerExpression){const m=await e.$dbNameOf(p);s+=`, ${f(c,m)} as ${p.key}_${c}`}const y=p.valueType===Number||c=="distinctCount";o.push((m,g)=>{y&&(m=Number(m)),g[p.key]={...g[p.key],[c]:m}})}}if(s+=`
 from `+e.$entityName,r!=null&&r.where){let c=new Ot(t,e);r==null||r.where.__applyToConsumer(c),s+=await c.resolveWhere()}a&&(s+=a);let l="";if(r!=null&&r.orderBy){for(const c of r==null?void 0:r.orderBy){l==""?l=" order by ":l+=", ";let h=c.field&&await e.$dbNameOf(c.field);switch(c.operation){case"count":h=c.operation+"(*)";break;case void 0:break;default:h=f(c.operation,h)}l+=h,c.isDescending&&(l+=" desc"),n&&(c.isDescending?l+=" nulls last":l+=" nulls first")}l&&(s+=l)}if(r!=null&&r.limit){let c=1;r.page&&(c=r.page),c<1&&(c=1),s+=" "+i(r.limit,(c-1)*r.limit)}const u=await t.execute(s);return u.rows.map(c=>{let h={};return o.forEach((p,y)=>p(c[u.getColumnKeyInResultForIndexInSelect(y)],h)),h});function f(c,h){return c==="distinctCount"?`count (distinct ${h})`:`${c}( ${h} )`}}class Ot{constructor(e,t){d(this,"r");d(this,"nameProvider");d(this,"where","");d(this,"_addWhere",!0);d(this,"promises",[]);this.r=e,this.nameProvider=t}async resolveWhere(){for(;this.promises.length>0;){let e=this.promises;this.promises=[];for(const t of e)await t}return this.where}custom(e,t){throw new Error("Custom filter should be translated before it gets here")}or(e){let t="";this.promises.push((async()=>{for(const n of e){let i=new Ot(this.r,this.nameProvider);i._addWhere=!1,n.__applyToConsumer(i);let s=await i.resolveWhere();if(!s)return;s.length>0&&(t.length>0&&(t+=" or "),e.length>1?t+="("+s+")":t+=s)}this.addToWhere("("+t+")")})())}not(e){this.promises.push((async()=>{let t=new Ot(this.r,this.nameProvider);t._addWhere=!1,e.__applyToConsumer(t);let n=await t.resolveWhere();n&&this.addToWhere("not ("+n+")")})())}isNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is null"))())}isNotNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is not null"))())}isIn(e,t){this.promises.push((async()=>{t&&t.length>0?this.addToWhere(this.nameProvider.$dbNameOf(e)+" in ("+t.map(n=>this.r.param(e.valueConverter.toDb(n))).join(",")+")"):this.addToWhere("1 = 0 /*isIn with no values*/")})())}isEqualTo(e,t){this.add(e,t,"=")}isDifferentFrom(e,t){this.add(e,t,"<>")}isGreaterOrEqualTo(e,t){this.add(e,t,">=")}isGreaterThan(e,t){this.add(e,t,">")}isLessOrEqualTo(e,t){this.add(e,t,"<=")}isLessThan(e,t){this.add(e,t,"<")}containsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}notContainsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("not lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}startsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('"+t.replace(/'/g,"''")+"%')")})())}endsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"')")})())}add(e,t,n){this.promises.push((async()=>{let i=this.nameProvider.$dbNameOf(e)+" "+n+" "+this.r.param(e.valueConverter.toDb(t));this.addToWhere(i)})())}addToWhere(e){this.where.length==0?this._addWhere&&(this.where+=" where "):this.where+=" and ",this.where+=e}databaseCustom(e){this.promises.push((async()=>{if(e!=null&&e.buildSql){let t=new Pd(this.r,this.nameProvider.wrapIdentifier),n=await e.buildSql(t);typeof n!="string"&&(n=t.sql),n&&this.addToWhere("("+n+")")}})())}}class Pd{constructor(e,t){d(this,"r");d(this,"wrapIdentifier");d(this,"sql","");d(this,"param",(e,t)=>(typeof t=="object"&&t.valueConverter.toDb&&(e=t.valueConverter.toDb(e)),this.r.param(e)));d(this,"filterToRaw",async(e,t)=>hr.filterToRaw(e,t,this,void 0,this.wrapIdentifier));this.r=e,this.wrapIdentifier=t,this.param.bind(this),this.filterToRaw.bind(this)}addParameterAndReturnSqlToken(e){return this.param(e)}}function ca(r,e){return r.dbReadOnly||r.isServerExpression||r.options.sqlExpression&&r.dbName!=e.$dbNameOf(r)}async function ul(r,e){return Rd(r,e,!0)}async function Rd(r,e,t=!1){let n=typeof e=="function"?{wrapIdentifier:e}:e||{};var i=Ed(r);n.wrapIdentifier||(n.wrapIdentifier=Te.dataProvider.wrapIdentifier),n.wrapIdentifier||(n.wrapIdentifier=a=>a);const s={$entityName:await fl(i,n.wrapIdentifier),toString:()=>s.$entityName,$dbNameOf:a=>{var o;return typeof a=="string"?o=a:o=a.key,s[o]},wrapIdentifier:n.wrapIdentifier};for(const a of i.fields){let o=await Es(a,i,n.wrapIdentifier,t);a.options.sqlExpression||(typeof n.tableName=="string"?o=n.wrapIdentifier(n.tableName)+"."+o:n.tableName===!0&&(o=s.$entityName+"."+o)),s[a.key]=o}return s}async function fl(r,e=t=>t){if(r.options.sqlExpression){if(typeof r.options.sqlExpression=="string")return r.options.sqlExpression;if(typeof r.options.sqlExpression=="function"){const t=r.options.sqlExpression;try{return r.options.sqlExpression="recursive sqlExpression call for entity '"+r.key+"'. ",await t(r)}finally{r.options.sqlExpression=t}}}return e(r.dbName)}const Ri=Symbol.for("sqlExpressionInProgressKey");async function Es(r,e,t=i=>i,n=!1){try{if(r.options.sqlExpression){let a;if(typeof r.options.sqlExpression=="function"){if(r[Ri]&&!n)return"recursive sqlExpression call for field '"+r.key+"'. \0";try{r[Ri]=!0,a=await r.options.sqlExpression(e),a.includes("\0")||(r.options.sqlExpression=()=>a)}finally{delete r[Ri]}}else a=r.options.sqlExpression;return a||r.dbName}const i=le(r);let s=(i==null?void 0:i.type)==="toOne"&&r.options.field;if(s){let a=e.fields.find(s);if(a)return Es(a,e,t,n)}return t(r.dbName)}finally{}}function cl(r,...e){return(t,n)=>{let i=t;for(;i!=null;){for(const a in i)if(Object.prototype.hasOwnProperty.call(i,a)){const o=t[a];o!=null&&o.rawFilterInfo&&(o.rawFilterInfo.key||(o.rawFilterInfo.key=a))}i=Object.getPrototypeOf(i)}let s=a=>{let o={};for(const u of e)u&&(typeof u=="function"?u(o,a):Object.assign(o,u));let l=Object.getPrototypeOf(t);if(l){let u=xe(l,!1);if(u){let f=u(a);f&&(o={...f,...o})}}return o};return N.allEntities.push(t),ld(t,{key:r}),t[Ho]=s,t[Go]=r,t}}var ri=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},er={},gt={},ie={},Ke={},da;function dl(){if(da)return Ke;da=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.isBytes=t,Ke.number=r,Ke.bool=e,Ke.bytes=n,Ke.hash=i,Ke.exists=s,Ke.output=a;function r(l){if(!Number.isSafeInteger(l)||l<0)throw new Error(`positive integer expected, not ${l}`)}function e(l){if(typeof l!="boolean")throw new Error(`boolean expected, not ${l}`)}function t(l){return l instanceof Uint8Array||l!=null&&typeof l=="object"&&l.constructor.name==="Uint8Array"}function n(l,...u){if(!t(l))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(l.length))throw new Error(`Uint8Array expected of length ${u}, not of length=${l.length}`)}function i(l){if(typeof l!="function"||typeof l.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");r(l.outputLen),r(l.blockLen)}function s(l,u=!0){if(l.destroyed)throw new Error("Hash instance has been destroyed");if(u&&l.finished)throw new Error("Hash#digest() has already been called")}function a(l,u){n(l);const f=u.outputLen;if(l.length<f)throw new Error(`digestInto() expects output buffer of length at least ${f}`)}const o={number:r,bool:e,bytes:n,hash:i,exists:s,output:a};return Ke.default=o,Ke}var J={},ha;function xd(){if(ha)return J;ha=1,Object.defineProperty(J,"__esModule",{value:!0}),J.add5L=J.add5H=J.add4H=J.add4L=J.add3H=J.add3L=J.rotlBL=J.rotlBH=J.rotlSL=J.rotlSH=J.rotr32L=J.rotr32H=J.rotrBL=J.rotrBH=J.rotrSL=J.rotrSH=J.shrSL=J.shrSH=J.toBig=void 0,J.fromBig=t,J.split=n,J.add=k;const r=BigInt(2**32-1),e=BigInt(32);function t(S,E=!1){return E?{h:Number(S&r),l:Number(S>>e&r)}:{h:Number(S>>e&r)|0,l:Number(S&r)|0}}function n(S,E=!1){let A=new Uint32Array(S.length),v=new Uint32Array(S.length);for(let F=0;F<S.length;F++){const{h:U,l:D}=t(S[F],E);[A[F],v[F]]=[U,D]}return[A,v]}const i=(S,E)=>BigInt(S>>>0)<<e|BigInt(E>>>0);J.toBig=i;const s=(S,E,A)=>S>>>A;J.shrSH=s;const a=(S,E,A)=>S<<32-A|E>>>A;J.shrSL=a;const o=(S,E,A)=>S>>>A|E<<32-A;J.rotrSH=o;const l=(S,E,A)=>S<<32-A|E>>>A;J.rotrSL=l;const u=(S,E,A)=>S<<64-A|E>>>A-32;J.rotrBH=u;const f=(S,E,A)=>S>>>A-32|E<<64-A;J.rotrBL=f;const c=(S,E)=>E;J.rotr32H=c;const h=(S,E)=>S;J.rotr32L=h;const p=(S,E,A)=>S<<A|E>>>32-A;J.rotlSH=p;const y=(S,E,A)=>E<<A|S>>>32-A;J.rotlSL=y;const m=(S,E,A)=>E<<A-32|S>>>64-A;J.rotlBH=m;const g=(S,E,A)=>S<<A-32|E>>>64-A;J.rotlBL=g;function k(S,E,A,v){const F=(E>>>0)+(v>>>0);return{h:S+A+(F/2**32|0)|0,l:F|0}}const T=(S,E,A)=>(S>>>0)+(E>>>0)+(A>>>0);J.add3L=T;const M=(S,E,A,v)=>E+A+v+(S/2**32|0)|0;J.add3H=M;const b=(S,E,A,v)=>(S>>>0)+(E>>>0)+(A>>>0)+(v>>>0);J.add4L=b;const _=(S,E,A,v,F)=>E+A+v+F+(S/2**32|0)|0;J.add4H=_;const O=(S,E,A,v,F)=>(S>>>0)+(E>>>0)+(A>>>0)+(v>>>0)+(F>>>0);J.add5L=O;const R=(S,E,A,v,F,U)=>E+A+v+F+U+(S/2**32|0)|0;J.add5H=R;const x={fromBig:t,split:n,toBig:i,shrSH:s,shrSL:a,rotrSH:o,rotrSL:l,rotrBH:u,rotrBL:f,rotr32H:c,rotr32L:h,rotlSH:p,rotlSL:y,rotlBH:m,rotlBL:g,add:k,add3L:T,add3H:M,add4L:b,add4H:_,add5H:R,add5L:O};return J.default=x,J}var xi={},br={},pa;function Dd(){return pa||(pa=1,Object.defineProperty(br,"__esModule",{value:!0}),br.crypto=void 0,br.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),br}var ya;function Nd(){return ya||(ya=1,function(r){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.Hash=r.nextTick=r.byteSwapIfBE=r.byteSwap=r.isLE=r.rotl=r.rotr=r.createView=r.u32=r.u8=void 0,r.isBytes=n,r.byteSwap32=f,r.bytesToHex=h,r.hexToBytes=m,r.asyncLoop=k,r.utf8ToBytes=T,r.toBytes=M,r.concatBytes=b,r.checkOpts=R,r.wrapConstructor=x,r.wrapConstructorWithOpts=S,r.wrapXOFConstructorWithOpts=E,r.randomBytes=A;const e=Dd(),t=dl();function n(v){return v instanceof Uint8Array||v!=null&&typeof v=="object"&&v.constructor.name==="Uint8Array"}const i=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);r.u8=i;const s=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));r.u32=s;const a=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);r.createView=a;const o=(v,F)=>v<<32-F|v>>>F;r.rotr=o;const l=(v,F)=>v<<F|v>>>32-F>>>0;r.rotl=l,r.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const u=v=>v<<24&4278190080|v<<8&16711680|v>>>8&65280|v>>>24&255;r.byteSwap=u,r.byteSwapIfBE=r.isLE?v=>v:v=>(0,r.byteSwap)(v);function f(v){for(let F=0;F<v.length;F++)v[F]=(0,r.byteSwap)(v[F])}const c=Array.from({length:256},(v,F)=>F.toString(16).padStart(2,"0"));function h(v){(0,t.bytes)(v);let F="";for(let U=0;U<v.length;U++)F+=c[v[U]];return F}const p={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function y(v){if(v>=p._0&&v<=p._9)return v-p._0;if(v>=p._A&&v<=p._F)return v-(p._A-10);if(v>=p._a&&v<=p._f)return v-(p._a-10)}function m(v){if(typeof v!="string")throw new Error("hex string expected, got "+typeof v);const F=v.length,U=F/2;if(F%2)throw new Error("padded hex string expected, got unpadded hex of length "+F);const D=new Uint8Array(U);for(let L=0,z=0;L<U;L++,z+=2){const de=y(v.charCodeAt(z)),je=y(v.charCodeAt(z+1));if(de===void 0||je===void 0){const ve=v[z]+v[z+1];throw new Error('hex string expected, got non-hex character "'+ve+'" at index '+z)}D[L]=de*16+je}return D}const g=async()=>{};r.nextTick=g;async function k(v,F,U){let D=Date.now();for(let L=0;L<v;L++){U(L);const z=Date.now()-D;z>=0&&z<F||(await(0,r.nextTick)(),D+=z)}}function T(v){if(typeof v!="string")throw new Error(`utf8ToBytes expected string, got ${typeof v}`);return new Uint8Array(new TextEncoder().encode(v))}function M(v){return typeof v=="string"&&(v=T(v)),(0,t.bytes)(v),v}function b(...v){let F=0;for(let D=0;D<v.length;D++){const L=v[D];(0,t.bytes)(L),F+=L.length}const U=new Uint8Array(F);for(let D=0,L=0;D<v.length;D++){const z=v[D];U.set(z,L),L+=z.length}return U}class _{clone(){return this._cloneInto()}}r.Hash=_;const O={}.toString;function R(v,F){if(F!==void 0&&O.call(F)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(v,F)}function x(v){const F=D=>v().update(M(D)).digest(),U=v();return F.outputLen=U.outputLen,F.blockLen=U.blockLen,F.create=()=>v(),F}function S(v){const F=(D,L)=>v(L).update(M(D)).digest(),U=v({});return F.outputLen=U.outputLen,F.blockLen=U.blockLen,F.create=D=>v(D),F}function E(v){const F=(D,L)=>v(L).update(M(D)).digest(),U=v({});return F.outputLen=U.outputLen,F.blockLen=U.blockLen,F.create=D=>v(D),F}function A(v=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(v));if(e.crypto&&typeof e.crypto.randomBytes=="function")return e.crypto.randomBytes(v);throw new Error("crypto.getRandomValues must be defined")}}(xi)),xi}var ma;function Md(){if(ma)return ie;ma=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.shake256=ie.shake128=ie.keccak_512=ie.keccak_384=ie.keccak_256=ie.keccak_224=ie.sha3_512=ie.sha3_384=ie.sha3_256=ie.sha3_224=ie.Keccak=void 0,ie.keccakP=g;const r=dl(),e=xd(),t=Nd(),n=[],i=[],s=[],a=BigInt(0),o=BigInt(1),l=BigInt(2),u=BigInt(7),f=BigInt(256),c=BigInt(113);for(let b=0,_=o,O=1,R=0;b<24;b++){[O,R]=[R,(2*O+3*R)%5],n.push(2*(5*R+O)),i.push((b+1)*(b+2)/2%64);let x=a;for(let S=0;S<7;S++)_=(_<<o^(_>>u)*c)%f,_&l&&(x^=o<<(o<<BigInt(S))-o);s.push(x)}const[h,p]=(0,e.split)(s,!0),y=(b,_,O)=>O>32?(0,e.rotlBH)(b,_,O):(0,e.rotlSH)(b,_,O),m=(b,_,O)=>O>32?(0,e.rotlBL)(b,_,O):(0,e.rotlSL)(b,_,O);function g(b,_=24){const O=new Uint32Array(10);for(let R=24-_;R<24;R++){for(let E=0;E<10;E++)O[E]=b[E]^b[E+10]^b[E+20]^b[E+30]^b[E+40];for(let E=0;E<10;E+=2){const A=(E+8)%10,v=(E+2)%10,F=O[v],U=O[v+1],D=y(F,U,1)^O[A],L=m(F,U,1)^O[A+1];for(let z=0;z<50;z+=10)b[E+z]^=D,b[E+z+1]^=L}let x=b[2],S=b[3];for(let E=0;E<24;E++){const A=i[E],v=y(x,S,A),F=m(x,S,A),U=n[E];x=b[U],S=b[U+1],b[U]=v,b[U+1]=F}for(let E=0;E<50;E+=10){for(let A=0;A<10;A++)O[A]=b[E+A];for(let A=0;A<10;A++)b[E+A]^=~O[(A+2)%10]&O[(A+4)%10]}b[0]^=h[R],b[1]^=p[R]}O.fill(0)}class k extends t.Hash{constructor(_,O,R,x=!1,S=24){if(super(),this.blockLen=_,this.suffix=O,this.outputLen=R,this.enableXOF=x,this.rounds=S,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,r.number)(R),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,t.u32)(this.state)}keccak(){t.isLE||(0,t.byteSwap32)(this.state32),g(this.state32,this.rounds),t.isLE||(0,t.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(_){(0,r.exists)(this);const{blockLen:O,state:R}=this;_=(0,t.toBytes)(_);const x=_.length;for(let S=0;S<x;){const E=Math.min(O-this.pos,x-S);for(let A=0;A<E;A++)R[this.pos++]^=_[S++];this.pos===O&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:_,suffix:O,pos:R,blockLen:x}=this;_[R]^=O,O&128&&R===x-1&&this.keccak(),_[x-1]^=128,this.keccak()}writeInto(_){(0,r.exists)(this,!1),(0,r.bytes)(_),this.finish();const O=this.state,{blockLen:R}=this;for(let x=0,S=_.length;x<S;){this.posOut>=R&&this.keccak();const E=Math.min(R-this.posOut,S-x);_.set(O.subarray(this.posOut,this.posOut+E),x),this.posOut+=E,x+=E}return _}xofInto(_){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(_)}xof(_){return(0,r.number)(_),this.xofInto(new Uint8Array(_))}digestInto(_){if((0,r.output)(_,this),this.finished)throw new Error("digest() was already called");return this.writeInto(_),this.destroy(),_}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(_){const{blockLen:O,suffix:R,outputLen:x,rounds:S,enableXOF:E}=this;return _||(_=new k(O,R,x,E,S)),_.state32.set(this.state32),_.pos=this.pos,_.posOut=this.posOut,_.finished=this.finished,_.rounds=S,_.suffix=R,_.outputLen=x,_.enableXOF=E,_.destroyed=this.destroyed,_}}ie.Keccak=k;const T=(b,_,O)=>(0,t.wrapConstructor)(()=>new k(_,b,O));ie.sha3_224=T(6,144,224/8),ie.sha3_256=T(6,136,256/8),ie.sha3_384=T(6,104,384/8),ie.sha3_512=T(6,72,512/8),ie.keccak_224=T(1,144,224/8),ie.keccak_256=T(1,136,256/8),ie.keccak_384=T(1,104,384/8),ie.keccak_512=T(1,72,512/8);const M=(b,_,O)=>(0,t.wrapXOFConstructorWithOpts)((R={})=>new k(_,b,R.dkLen===void 0?O:R.dkLen,!0));return ie.shake128=M(31,168,128/8),ie.shake256=M(31,136,256/8),ie}var ga;function Ld(){if(ga)return gt;ga=1;const{sha3_512:r}=Md(),e=24,t=32,n=(y=4,m=Math.random)=>{let g="";for(;g.length<y;)g=g+Math.floor(m()*36).toString(36);return g};function i(y){let m=8n,g=0n;for(const k of y.values()){const T=BigInt(k);g=(g<<m)+T}return g}const s=(y="")=>i(r(y)).toString(36).slice(1),a=Array.from({length:26},(y,m)=>String.fromCharCode(m+97)),o=y=>a[Math.floor(y()*a.length)],l=({globalObj:y=typeof ri<"u"?ri:typeof window<"u"?window:{},random:m=Math.random}={})=>{const g=Object.keys(y).toString(),k=g.length?g+n(t,m):n(t,m);return s(k).substring(0,t)},u=y=>()=>y++,f=476782367,c=({random:y=Math.random,counter:m=u(Math.floor(y()*f)),length:g=e,fingerprint:k=l({random:y})}={})=>function(){const M=o(y),b=Date.now().toString(36),_=m().toString(36),O=n(g,y),R=`${b+O+_+k}`;return`${M+s(R).substring(1,g)}`},h=c(),p=(y,{minLength:m=2,maxLength:g=t}={})=>{const k=y.length,T=/^[0-9a-z]+$/;try{if(typeof y=="string"&&k>=m&&k<=g&&T.test(y))return!0}finally{}return!1};return gt.getConstants=()=>({defaultLength:e,bigLength:t}),gt.init=c,gt.createId=h,gt.bufToBigInt=i,gt.createCounter=u,gt.createFingerprint=l,gt.isCuid=p,gt}var wa;function qd(){if(wa)return er;wa=1;const{createId:r,init:e,getConstants:t,isCuid:n}=Ld();return er.createId=r,er.init=e,er.getConstants=t,er.isCuid=n,er}var va=qd();const _a=Sn(r=>!isNaN(r)&&isFinite(r));class X{static object(...e){return be(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),be(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return be(()=>Date,{valueConverter:Ee.DateOnly},...e)}static date(...e){return be(()=>Date,...e)}static integer(...e){return be(()=>Number,{valueConverter:Ee.Integer,validate:_a},...e)}static autoIncrement(...e){return be(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...Ee.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return be(()=>Number,{validate:_a},...e)}static createdAt(...e){return be(()=>Date,{allowApiUpdate:!1,saving:(t,n,{isNew:i})=>{i&&(n.value=new Date)}},...e)}static updatedAt(...e){return be(()=>Date,{allowApiUpdate:!1,saving:(t,n)=>{n.value=new Date}},...e)}static uuid(...e){return be(()=>String,{allowApiUpdate:!1,defaultValue:()=>zi(),saving:(t,n)=>{n.value||(n.value=zi())}},...e)}static cuid(...e){return be(()=>String,{allowApiUpdate:!1,defaultValue:()=>va.createId(),saving:(t,n)=>{n.value||(n.value=va.createId())}},...e)}static literal(e,...t){return X.string({validate:(n,i)=>He.in(e())(n,i),[Pi]:e},...t)}static enum(e,...t){let n;return be(()=>e(),{validate:(i,s)=>He.enum(e())(i,s),[Pi]:()=>Tn(e())},...t,i=>{if(i[Pi]=()=>Tn(e()),n===void 0){let s=e();n=Tn(s).find(o=>typeof o=="string")?Ee.String:Ee.Integer}i.valueConverter?i.valueConverter.fieldTypeInDb||(i.valueConverter.fieldTypeInDb=n.fieldTypeInDb):i.valueConverter=n})}static string(...e){return be(()=>String,...e)}static boolean(...e){return be(()=>Boolean,...e)}}class yi{static toOne(e,t){let n=typeof t=="string"?{field:t}:t||{};return!n.field&&!n.fields&&!n.findOptions?be(e,{...n,...Ei(e,"reference")}):be(()=>{},{...n,serverExpression:()=>{},...Ei(e,"toOne")})}static toMany(e,t){return be(()=>{},{...typeof t=="string"?{field:t}:t,serverExpression:()=>{},...Ei(e,"toMany")})}}function be(r,...e){return(t,n,i)=>{const s=typeof n=="string"?n:n.name.toString();let a=u=>{let f=al(e,u);if(f.required&&(f.validate=An(f.validate,He.required,!0)),lr(f,"maxLength")){let h=f;h.maxLength&&(h.validate=An(h.validate,He.maxLength(h.maxLength)))}if(lr(f,"minLength")){let h=f;h.minLength&&(h.validate=An(h.validate,He.minLength(h.minLength)))}!f.valueType&&r&&(f.valueType=r()),f.key||(f.key=s),f.dbName||(f.dbName=f.key);let c=f.valueType;return c||(c=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],f.valueType=c),f.target||(f.target=t),f};hl(t);let o=N.columnsOfType.get(t.constructor);o||(o=[],N.columnsOfType.set(t.constructor,o));let l=o.find(u=>u.key==s);if(!l)o.push({key:s,settings:a});else{let u=l.settings;l.settings=f=>{let c=u(f),h=a(f);return Object.assign(c,h)}}}}function hl(r){if(!r)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function Bd(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function jd(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}class ni extends ol{constructor(){super(...arguments);d(this,"id")}}Bd([X.uuid(),jd("design:type",String)],ni.prototype,"id",void 0);var ba={},Ia;function Ud(){if(Ia)return ba;Ia=1;var r={};/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var e;return function(t){(function(n){var i=typeof ri=="object"?ri:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),s=a(t);typeof i.Reflect>"u"?i.Reflect=t:s=a(i.Reflect,s),n(s);function a(o,l){return function(u,f){typeof o[u]!="function"&&Object.defineProperty(o,u,{configurable:!0,writable:!0,value:f}),l&&l(u,f)}}})(function(n){var i=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",a=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",l=typeof Object.create=="function",u={__proto__:[]}instanceof Array,f=!l&&!u,c={create:l?function(){return vi(Object.create(null))}:u?function(){return vi({__proto__:null})}:function(){return vi({})},has:f?function(w,I){return i.call(w,I)}:function(w,I){return I in w},get:f?function(w,I){return i.call(w,I)?w[I]:void 0}:function(w,I){return w[I]}},h=Object.getPrototypeOf(Function),p=typeof process=="object"&&r&&r.REFLECT_METADATA_USE_MAP_POLYFILL==="true",y=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Fl(),m=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pl(),g=!p&&typeof WeakMap=="function"?WeakMap:Rl(),k=new g;function T(w,I,C,P){if(me(C)){if(!As(w))throw new TypeError;if(!Fs(I))throw new TypeError;return v(w,I)}else{if(!As(w))throw new TypeError;if(!Oe(I))throw new TypeError;if(!Oe(P)&&!me(P)&&!Qe(P))throw new TypeError;return Qe(P)&&(P=void 0),C=mt(C),F(w,I,C,P)}}n("decorate",T);function M(w,I){function C(P,q){if(!Oe(P))throw new TypeError;if(!me(q)&&!El(q))throw new TypeError;je(w,I,P,q)}return C}n("metadata",M);function b(w,I,C,P){if(!Oe(C))throw new TypeError;return me(P)||(P=mt(P)),je(w,I,C,P)}n("defineMetadata",b);function _(w,I,C){if(!Oe(I))throw new TypeError;return me(C)||(C=mt(C)),D(w,I,C)}n("hasMetadata",_);function O(w,I,C){if(!Oe(I))throw new TypeError;return me(C)||(C=mt(C)),L(w,I,C)}n("hasOwnMetadata",O);function R(w,I,C){if(!Oe(I))throw new TypeError;return me(C)||(C=mt(C)),z(w,I,C)}n("getMetadata",R);function x(w,I,C){if(!Oe(I))throw new TypeError;return me(C)||(C=mt(C)),de(w,I,C)}n("getOwnMetadata",x);function S(w,I){if(!Oe(w))throw new TypeError;return me(I)||(I=mt(I)),ve(w,I)}n("getMetadataKeys",S);function E(w,I){if(!Oe(w))throw new TypeError;return me(I)||(I=mt(I)),ze(w,I)}n("getOwnMetadataKeys",E);function A(w,I,C){if(!Oe(I))throw new TypeError;me(C)||(C=mt(C));var P=U(I,C,!1);if(me(P)||!P.delete(w))return!1;if(P.size>0)return!0;var q=k.get(I);return q.delete(C),q.size>0||k.delete(I),!0}n("deleteMetadata",A);function v(w,I){for(var C=w.length-1;C>=0;--C){var P=w[C],q=P(I);if(!me(q)&&!Qe(q)){if(!Fs(q))throw new TypeError;I=q}}return I}function F(w,I,C,P){for(var q=w.length-1;q>=0;--q){var Fe=w[q],$=Fe(I,C,P);if(!me($)&&!Qe($)){if(!Oe($))throw new TypeError;P=$}}return P}function U(w,I,C){var P=k.get(w);if(me(P)){if(!C)return;P=new y,k.set(w,P)}var q=P.get(I);if(me(q)){if(!C)return;q=new y,P.set(I,q)}return q}function D(w,I,C){var P=L(w,I,C);if(P)return!0;var q=wi(I);return Qe(q)?!1:D(w,q,C)}function L(w,I,C){var P=U(I,C,!1);return me(P)?!1:Ol(P.has(w))}function z(w,I,C){var P=L(w,I,C);if(P)return de(w,I,C);var q=wi(I);if(!Qe(q))return z(w,q,C)}function de(w,I,C){var P=U(I,C,!1);if(!me(P))return P.get(w)}function je(w,I,C,P){var q=U(C,P,!0);q.set(w,I)}function ve(w,I){var C=ze(w,I),P=wi(w);if(P===null)return C;var q=ve(P,I);if(q.length<=0)return C;if(C.length<=0)return q;for(var Fe=new m,$=[],G=0,j=C;G<j.length;G++){var Q=j[G],K=Fe.has(Q);K||(Fe.add(Q),$.push(Q))}for(var Tt=0,Rs=q;Tt<Rs.length;Tt++){var Q=Rs[Tt],K=Fe.has(Q);K||(Fe.add(Q),$.push(Q))}return $}function ze(w,I){var C=[],P=U(w,I,!1);if(me(P))return C;for(var q=P.keys(),Fe=Cl(q),$=0;;){var G=Tl(Fe);if(!G)return C.length=$,C;var j=Sl(G);try{C[$]=j}catch(Q){try{Al(Fe)}finally{throw Q}}$++}}function St(w){if(w===null)return 1;switch(typeof w){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return w===null?1:6;default:return 6}}function me(w){return w===void 0}function Qe(w){return w===null}function _l(w){return typeof w=="symbol"}function Oe(w){return typeof w=="object"?w!==null:typeof w=="function"}function bl(w,I){switch(St(w)){case 0:return w;case 1:return w;case 2:return w;case 3:return w;case 4:return w;case 5:return w}var C="string",P=Ps(w,a);if(P!==void 0){var q=P.call(w,C);if(Oe(q))throw new TypeError;return q}return Il(w)}function Il(w,I){var C,P;{var q=w.toString;if(mn(q)){var P=q.call(w);if(!Oe(P))return P}var C=w.valueOf;if(mn(C)){var P=C.call(w);if(!Oe(P))return P}}throw new TypeError}function Ol(w){return!!w}function kl(w){return""+w}function mt(w){var I=bl(w);return _l(I)?I:kl(I)}function As(w){return Array.isArray?Array.isArray(w):w instanceof Object?w instanceof Array:Object.prototype.toString.call(w)==="[object Array]"}function mn(w){return typeof w=="function"}function Fs(w){return typeof w=="function"}function El(w){switch(St(w)){case 3:return!0;case 4:return!0;default:return!1}}function Ps(w,I){var C=w[I];if(C!=null){if(!mn(C))throw new TypeError;return C}}function Cl(w){var I=Ps(w,o);if(!mn(I))throw new TypeError;var C=I.call(w);if(!Oe(C))throw new TypeError;return C}function Sl(w){return w.value}function Tl(w){var I=w.next();return I.done?!1:I}function Al(w){var I=w.return;I&&I.call(w)}function wi(w){var I=Object.getPrototypeOf(w);if(typeof w!="function"||w===h||I!==h)return I;var C=w.prototype,P=C&&Object.getPrototypeOf(C);if(P==null||P===Object.prototype)return I;var q=P.constructor;return typeof q!="function"||q===w?I:q}function Fl(){var w={},I=[],C=function(){function $(G,j,Q){this._index=0,this._keys=G,this._values=j,this._selector=Q}return $.prototype["@@iterator"]=function(){return this},$.prototype[o]=function(){return this},$.prototype.next=function(){var G=this._index;if(G>=0&&G<this._keys.length){var j=this._selector(this._keys[G],this._values[G]);return G+1>=this._keys.length?(this._index=-1,this._keys=I,this._values=I):this._index++,{value:j,done:!1}}return{value:void 0,done:!0}},$.prototype.throw=function(G){throw this._index>=0&&(this._index=-1,this._keys=I,this._values=I),G},$.prototype.return=function(G){return this._index>=0&&(this._index=-1,this._keys=I,this._values=I),{value:G,done:!0}},$}();return function(){function $(){this._keys=[],this._values=[],this._cacheKey=w,this._cacheIndex=-2}return Object.defineProperty($.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$.prototype.has=function(G){return this._find(G,!1)>=0},$.prototype.get=function(G){var j=this._find(G,!1);return j>=0?this._values[j]:void 0},$.prototype.set=function(G,j){var Q=this._find(G,!0);return this._values[Q]=j,this},$.prototype.delete=function(G){var j=this._find(G,!1);if(j>=0){for(var Q=this._keys.length,K=j+1;K<Q;K++)this._keys[K-1]=this._keys[K],this._values[K-1]=this._values[K];return this._keys.length--,this._values.length--,G===this._cacheKey&&(this._cacheKey=w,this._cacheIndex=-2),!0}return!1},$.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=w,this._cacheIndex=-2},$.prototype.keys=function(){return new C(this._keys,this._values,P)},$.prototype.values=function(){return new C(this._keys,this._values,q)},$.prototype.entries=function(){return new C(this._keys,this._values,Fe)},$.prototype["@@iterator"]=function(){return this.entries()},$.prototype[o]=function(){return this.entries()},$.prototype._find=function(G,j){return this._cacheKey!==G&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=G)),this._cacheIndex<0&&j&&(this._cacheIndex=this._keys.length,this._keys.push(G),this._values.push(void 0)),this._cacheIndex},$}();function P($,G){return $}function q($,G){return G}function Fe($,G){return[$,G]}}function Pl(){return function(){function w(){this._map=new y}return Object.defineProperty(w.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),w.prototype.has=function(I){return this._map.has(I)},w.prototype.add=function(I){return this._map.set(I,I),this},w.prototype.delete=function(I){return this._map.delete(I)},w.prototype.clear=function(){this._map.clear()},w.prototype.keys=function(){return this._map.keys()},w.prototype.values=function(){return this._map.values()},w.prototype.entries=function(){return this._map.entries()},w.prototype["@@iterator"]=function(){return this.keys()},w.prototype[o]=function(){return this.keys()},w}()}function Rl(){var w=16,I=c.create(),C=P();return function(){function j(){this._key=P()}return j.prototype.has=function(Q){var K=q(Q,!1);return K!==void 0?c.has(K,this._key):!1},j.prototype.get=function(Q){var K=q(Q,!1);return K!==void 0?c.get(K,this._key):void 0},j.prototype.set=function(Q,K){var Tt=q(Q,!0);return Tt[this._key]=K,this},j.prototype.delete=function(Q){var K=q(Q,!1);return K!==void 0?delete K[this._key]:!1},j.prototype.clear=function(){this._key=P()},j}();function P(){var j;do j="@@WeakMap@@"+G();while(c.has(I,j));return I[j]=!0,j}function q(j,Q){if(!i.call(j,C)){if(!Q)return;Object.defineProperty(j,C,{value:c.create()})}return j[C]}function Fe(j,Q){for(var K=0;K<Q;++K)j[K]=Math.random()*255|0;return j}function $(j){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(j)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(j)):Fe(new Uint8Array(j),j):Fe(new Array(j),j)}function G(){var j=$(w);j[6]=j[6]&79|64,j[8]=j[8]&191|128;for(var Q="",K=0;K<w;++K){var Tt=j[K];(K===4||K===6||K===8)&&(Q+="-"),Tt<16&&(Q+="0"),Q+=Tt.toString(16).toLowerCase()}return Q}}function vi(w){return w.__=void 0,delete w.__,w}})}(e||(e={})),ba}Ud();const ii=class ii{constructor(e,t,n){d(this,"actionUrl");d(this,"queue");d(this,"allowed");d(this,"doWork");this.actionUrl=e,this.queue=t,this.allowed=n}async run(e,t,n){t===void 0&&(t=Te.apiClient.url),n||(n=dr(Te.apiClient.httpClient));let i=await n.post(t+"/"+this.actionUrl,e),s=i;if(s&&s.queuedJobId){let a=N.actionInfo.startBusyWithProgress();try{let o;if(await N.actionInfo.runActionWithoutBlockingUI(async()=>{for(;!o||!o.done;)o&&await new Promise(l=>setTimeout(()=>{l(void 0)},200)),o=await n.post(t+"/"+ii.apiUrlForJobStatus,{queuedJobId:i.queuedJobId}),o.progress&&a.progress(o.progress)}),o.error)throw o.error;return a.progress(1),o.result}finally{a.close()}}else return i}__register(e){e(this.actionUrl,this.queue,this.allowed,async(t,n,i)=>{try{var s=await this.execute(t,n,i);i.success(s)}catch(a){a.isForbiddenError?i.forbidden():i.error(a,void 0)}})}};d(ii,"apiUrlForJobStatus","jobStatusInQueue");let Jr=ii;class Ki extends Error{constructor(t="Forbidden"){super(t);d(this,"isForbiddenError",!0)}}class Jd extends Jr{constructor(t,n,i,s){super(t,i.queue??!1,i.allowed);d(this,"types");d(this,"options");d(this,"originalMethod");this.types=n,this.options=i,this.originalMethod=s}async execute(t,n,i){let s={data:{}},a=n.dataProvider;return await ml(n,this.options,async()=>{if(!n.isAllowedForInstance(void 0,this.options.allowed))throw new Ki;t.args=await yl(this.types(),t.args,n,a,i);try{s.data=await this.originalMethod(t.args)}catch(o){throw o}}),s}}function pt(r){return(e,t,n)=>{const i=typeof t=="string"?t:t.name.toString(),s=n?n.value:e;let a=s;hl(e);function o(){var f=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:paramtypes",e,i):[];return r.paramTypes&&(f=typeof r.paramTypes=="function"?r.paramTypes():r.paramTypes),f}if(e.prototype!==void 0){let f=new Jd((r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+i,()=>o(),r,c=>s.apply(void 0,c));return f.doWork=async(c,h,p,y)=>(c=Ea(o(),c),r.blockUser===!1?await N.actionInfo.runActionWithoutBlockingUI(async()=>(await f.run({args:c},p,y)).data):(await f.run({args:c},p,y)).data),a=async function(...c){return Ur()?await s.apply(this,c):await f.doWork(c,void 0)},Oa(e,a),a[Qi]=f,n?(n.value=a,n):a}let l=N.classHelpers.get(e.constructor);l||(l=new el,N.classHelpers.set(e.constructor,l));let u={__register(f){let c=new tt;for(const h of l.classes.keys()){let p=l.classes.get(h);p.key||(p.key=c.repo(h).metadata.key),f(p.key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+i,r?r.queue??!1:!1,r.allowed,async(y,m,g)=>{y.args=y.args.map(T=>pl(T)?void 0:T);let k=r.allowed;try{let T=m,M;await ml(T,r,async()=>{if(y.args=await yl(o(),y.args,T,T.dataProvider,g),N.allEntities.includes(h)){let b=T.repo(h),_;const O=y.rowInfo;if(O.isNewRow)_=b.create(),await b.getEntityRef(_)._updateEntityBasedOnApi(O.data);else{let x=await b.find({where:{...b.metadata.idMetadata.getIdFilter(O.id),$and:[b.metadata.options.apiPrefilter??{}]}});if(x.length!=1)throw new Error("not found or too many matches");_=x[0],await b.getEntityRef(_)._updateEntityBasedOnApi(O.data)}if(!T.isAllowedForInstance(_,k))throw new Ki;let R=ee(_);await R.__validateEntity();try{M={result:await s.apply(_,y.args),rowInfo:{data:await R.toApiJson(),isNewRow:R.isNew(),wasChanged:R.wasChanged(),id:R.getOriginalId()}}}catch(x){throw R.catchSaveErrors(x)}}else{let b=new h(T,T.dataProvider),_=la(b,T);if(await _._updateEntityBasedOnApi(y.fields),!T.isAllowedForInstance(b,k))throw new Ki;await _.__validateEntity();try{M={result:await s.apply(b,y.args),fields:await _.toApiJson()}}catch(O){throw _.catchSaveErrors(O)}}}),g.success(M)}catch(T){T.isForbiddenError?g.forbidden():g.error(T,void 0)}})}},doWork:async function(f,c,h,p){if(f=Ea(o(),f),N.allEntities.includes(e.constructor)){let y=ee(c);await y.__validateEntity();let m=l.classes.get(c.constructor);m.key||(m.key=y.repository.metadata.key+"_methods");try{let g=await new class extends Jr{constructor(){super(...arguments);d(this,"execute")}}(m.key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+i,(r==null?void 0:r.queue)??!1,r.allowed).run({args:f,rowInfo:{data:await y.toApiJson(),isNewRow:y.isNew(),wasChanged:y.wasChanged(),id:y.getOriginalId()}},h,p);return await y._updateEntityBasedOnApi(g.rowInfo.data,!0),g.result}catch(g){throw y.catchSaveErrors(g)}}else{let y=la(c,void 0);try{await y.__validateEntity();let m=await new class extends Jr{constructor(){super(...arguments);d(this,"execute")}}(l.classes.get(c.constructor).key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+i,(r==null?void 0:r.queue)??!1,r.allowed).run({args:f,fields:await y.toApiJson()},h,p);return await y._updateEntityBasedOnApi(m.fields),m.result}catch(m){throw y.catchSaveErrors(m)}}}};return a=async function(...f){let c=this;return Ur()?await s.apply(c,f):u.doWork(f,c)},Oa(e.constructor,a),a[Qi]=u,n?(n.value=a,n):a}}const Vd={_isUndefined:!0};function Oa(r,e){(r[Ca]||(r[Ca]=[])).push(e),N.actionInfo.allActions.push(e)}function pl(r){return r&&r._isUndefined}class ka{constructor(e){d(this,"res");this.res=e}progress(e){this.res.progress(e)}}function Ea(r,e){if(r)for(let t=0;t<r.length;t++){const n=r[t];for(const i of[tt,hr])(e[t]instanceof i||n==i)&&(e[t]=void 0);if(e[t]!=null){let i={valueType:n};if(i=ks(i,new tt),xe(n,!1)!=null){let a=ee(e[t]);e[t]=a.getId()}i.valueConverter&&(e[t]=i.valueConverter.toJson(e[t]))}}return e.map(t=>t!==void 0?t:Vd)}async function yl(r,e,t,n,i){for(let s=0;s<e.length;s++){const a=e[s];pl(a)&&(e[s]=void 0)}if(r)for(let s=0;s<r.length;s++)if(e.length<s&&e.push(void 0),r[s]==tt||r[s]==tt)e[s]=t;else if(r[s]==hr&&n)e[s]=n;else if(r[s]==ka)e[s]=new ka(i);else{let a={valueType:r[s]};a=ks(a,t),a.valueConverter&&(e[s]=a.valueConverter.fromJson(e[s])),xe(r[s],!1)!=null&&(e[s]===null||e[s]===void 0||(e[s]=await t.repo(r[s]).findId(e[s])))}return e}const Ca=Symbol.for("classBackendMethodsArray");async function ml(r,e,t){if(e.transactional===void 0||e.transactional===!0)return await fd(r,t);await t(r.dataProvider)}function gl(r,e){return Te.repo(r,e)}class $d{constructor(e,t){d(this,"id");d(this,"caption");d(this,"icon");d(this,"where");d(this,"class");this.id=e.toString(),this.caption=(t==null?void 0:t.caption)??this.id,this.icon=t==null?void 0:t.icon,this.where=t==null?void 0:t.where,this.class=t==null?void 0:t.class,t!=null&&t.icon&&t.icon.caption===void 0&&(t.icon.caption=t==null?void 0:t.caption)}}var Wd=Object.defineProperty,Hd=Object.getOwnPropertyDescriptor,Ct=(r,e,t,n)=>{for(var i=n>1?void 0:n?Hd(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Wd(e,t,i),i};let Ge=class{constructor(){d(this,"id","");d(this,"entity","");d(this,"entityId","");d(this,"changeDate",new Date);d(this,"userId","");d(this,"changes",[]);d(this,"newRow",!1);d(this,"deleted",!1)}};Ct([X.cuid()],Ge.prototype,"id",2);Ct([X.string()],Ge.prototype,"entity",2);Ct([X.string()],Ge.prototype,"entityId",2);Ct([X.date()],Ge.prototype,"changeDate",2);Ct([X.string()],Ge.prototype,"userId",2);Ct([X.json({dbName:"changesJson"})],Ge.prototype,"changes",2);Ct([X.boolean()],Ge.prototype,"newRow",2);Ct([X.boolean()],Ge.prototype,"deleted",2);Ge=Ct([cl("_ff_change_logs",{caption:"FF Change Logs",allowApiCrud:!1,defaultOrderBy:{changeDate:"desc"}})],Ge);async function Gd(r,e,t){var n;if(Ur()){const i=[],s=new wl(r,t),a=(t==null?void 0:t.forceNew)||e.isNew,o=(t==null?void 0:t.forceDate)||new Date;for(const l of s.fields.filter(u=>u.valueChanged()||a&&u.value))try{const u=s.excludedValues.includes(l);i.push({key:l.metadata.key,newValue:u?"***":l.value instanceof ni?l.value.id:l.metadata.options.valueConverter.toJson(l.value),oldValue:e.isNew?"---":u?"***":l.originalValue instanceof ni?l.originalValue.id:l.metadata.options.valueConverter.toJson(l.originalValue)})}catch(u){throw console.error(l),u}i.length>0&&await gl(Ge).insert({changeDate:o,changes:i,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(r),userId:((n=Te.user)==null?void 0:n.id)||"",newRow:a})}}async function zd(r,e,t){var a;const n=[],i=new wl(r,t),s=(t==null?void 0:t.forceDate)||new Date;for(const o of i.fields)try{const l=i.excludedValues.includes(o);n.push({key:o.metadata.key,newValue:l?"***":"---",oldValue:l?"***":o.originalValue instanceof ni?o.originalValue.id:o.metadata.options.valueConverter.toJson(o.originalValue)})}catch(l){throw console.error(o),l}await gl(Ge).insert({changeDate:s,changes:n,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(r),userId:((a=Te.user)==null?void 0:a.id)||"",deleted:!0})}class wl{constructor(e,t){d(this,"fields");d(this,"excludedFields");d(this,"excludedValues");const n=ee(e);t!=null&&t.excludeColumns?this.excludedFields=t.excludeColumns(n.fields):this.excludedFields=[],t!=null&&t.excludeValues?this.excludedValues=t.excludeValues(n.fields):this.excludedValues=[],this.excludedFields.push(...n.fields.toArray().filter(i=>i.metadata.options.serverExpression)),this.excludedFields.push(...n.fields.toArray().filter(i=>i.metadata.options.sqlExpression)),this.fields=n.fields.toArray().filter(i=>!this.excludedFields.includes(i))}}const Ir=r=>{if(r)return Array.isArray(r)?r.map(e=>e.id):r.id};function Cs(r,e){return cl(r,{...e,allowApiCrud:e.allowApiCrud??Ir(e.permissionApiCrud),allowApiDelete:e.allowApiDelete??Ir(e.permissionApiDelete),allowApiInsert:e.allowApiInsert??Ir(e.permissionApiInsert),allowApiRead:e.allowApiRead??Ir(e.permissionApiRead),allowApiUpdate:e.allowApiUpdate??Ir(e.permissionApiUpdate),saved:async(t,n)=>{var i;await((i=e==null?void 0:e.saved)==null?void 0:i.call(e,t,n)),e.changeLog===!1||Ur()&&await Gd(t,n,e.changeLog)},deleted:async(t,n)=>{var i;await((i=e==null?void 0:e.deleted)==null?void 0:i.call(e,t,n)),e.changeLog===!1||Ur()&&await zd(t,n,e.changeLog)}})}const Ss={FF_Role_Admin:"FF_Role.Admin"};var vl=Object.defineProperty,Qd=Object.getOwnPropertyDescriptor,Kd=(r,e,t)=>e in r?vl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ue=(r,e,t,n)=>{for(var i=n>1?void 0:n?Qd(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&vl(e,t,i),i},mi=(r,e,t)=>Kd(r,typeof e!="symbol"?e+"":e,t);const gi={FF_Role_Auth_Admin:"FF_Role_Auth.Admin",FF_Role_Auth_Invite:"FF_Role_Auth.Invite"};let rt=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"identifier");d(this,"roles",[]);d(this,"accounts");d(this,"sessions")}};ue([X.cuid()],rt.prototype,"id",2);ue([X.createdAt()],rt.prototype,"createdAt",2);ue([X.updatedAt()],rt.prototype,"updatedAt",2);ue([X.string({validate:[He.unique(),He.required(),r=>{var e;if(((e=r.identifier)==null?void 0:e.length)<2)throw"Must be at least 2 characters long"}]})],rt.prototype,"identifier",2);ue([X.json(()=>[],{inputType:"selectEnum",valueConverter:{toDb:r=>r?r.join(","):[],fromDb:r=>r?r.split(",").map(e=>e.replace("{","").replace("}","")).filter(e=>e!==""):[]}})],rt.prototype,"roles",2);ue([yi.toMany(()=>De,"userId")],rt.prototype,"accounts",2);ue([yi.toMany(()=>Qt,"userId")],rt.prototype,"sessions",2);rt=ue([Cs("ff_auth.users",{allowApiCrud:[gi.FF_Role_Auth_Admin,Ss.FF_Role_Admin],caption:"FF Auth - Users"})],rt);let De=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"userId");d(this,"user");d(this,"provider",nt.PASSWORD.id);d(this,"providerUserId","");d(this,"hashPassword");d(this,"token");d(this,"expiresAt");d(this,"lastVerifiedAt")}};ue([X.cuid()],De.prototype,"id",2);ue([X.createdAt()],De.prototype,"createdAt",2);ue([X.updatedAt()],De.prototype,"updatedAt",2);ue([X.string()],De.prototype,"userId",2);ue([yi.toOne(()=>rt,"userId")],De.prototype,"user",2);ue([X.string()],De.prototype,"provider",2);ue([X.string()],De.prototype,"providerUserId",2);ue([X.string({includeInApi:!1,allowNull:!0})],De.prototype,"hashPassword",2);ue([X.string({includeInApi:!1,allowNull:!0})],De.prototype,"token",2);ue([X.date({includeInApi:!1,allowNull:!0})],De.prototype,"expiresAt",2);ue([X.date({includeInApi:!1,allowNull:!0})],De.prototype,"lastVerifiedAt",2);De=ue([Cs("ff_auth.accounts",{allowApiCrud:[gi.FF_Role_Auth_Admin,Ss.FF_Role_Admin],caption:"FF Auth - Accounts",changeLog:{excludeColumns:r=>[r.hashPassword,r.token]}})],De);let Qt=class{constructor(){d(this,"id");d(this,"expiresAt");d(this,"userId");d(this,"user")}};ue([X.string()],Qt.prototype,"id",2);ue([X.date()],Qt.prototype,"expiresAt",2);ue([X.string()],Qt.prototype,"userId",2);ue([yi.toOne(()=>rt,"userId")],Qt.prototype,"user",2);Qt=ue([Cs("ff_auth.users_sessions",{allowApiCrud:[gi.FF_Role_Auth_Admin,Ss.FF_Role_Admin],caption:"FF Auth - Users sessions",changeLog:!1})],Qt);let nt=class extends $d{constructor(r,e){super(r,{...e})}};mi(nt,"DEMO",new nt("DEMO",{caption:"Demo"}));mi(nt,"PASSWORD",new nt("PASSWORD",{caption:"Password"}));mi(nt,"OTP",new nt("OTP",{caption:"TOTP"}));mi(nt,"OAUTH",new nt("OAUTH",{caption:"OAUTH"}));nt=ue([kd()],nt);var Yd=Object.defineProperty,Xd=Object.getOwnPropertyDescriptor,yt=(r,e,t,n)=>{for(var i=Xd(e,t),s=r.length-1,a;s>=0;s--)(a=r[s])&&(i=a(e,t,i)||i);return i&&Yd(e,t,i),i},fe,Zr,en,tn,rn,nn,sn,an,on,ln,un;const it=(fe=class{static _setAbstraction(e){Ne(this,Zr,e.signOut),Ne(this,en,e.signInDemo),Ne(this,tn,e.invite),Ne(this,rn,e.signUpPassword),Ne(this,nn,e.signInPassword),Ne(this,sn,e.forgotPassword),Ne(this,an,e.resetPassword),Ne(this,on,e.signInOTP),Ne(this,ln,e.verifyOtp),Ne(this,un,e.signInOAuthGetUrl)}static async signOut(){var e;return await V(e=fe,Zr).call(e)}static async signInDemo(e){var t;return await V(t=fe,en).call(t,e)}static async invite(e){var t;return await V(t=fe,tn).call(t,e)}static async signUpPassword(e,t){var n;return await V(n=fe,rn).call(n,e,t)}static async signInPassword(e,t){var n;return await V(n=fe,nn).call(n,e,t)}static async forgotPassword(e){var t;return await V(t=fe,sn).call(t,e)}static async resetPassword(e,t){var n;return await V(n=fe,an).call(n,e,t)}static async signInOTP(e){var t;return await V(t=fe,on).call(t,e)}static async verifyOtp(e,t){var n;return await V(n=fe,ln).call(n,e,t)}static async signInOAuthGetUrl(e){var t;return await V(t=fe,un).call(t,e)}},Zr=new WeakMap,en=new WeakMap,tn=new WeakMap,rn=new WeakMap,nn=new WeakMap,sn=new WeakMap,an=new WeakMap,on=new WeakMap,ln=new WeakMap,un=new WeakMap,he(fe,Zr),he(fe,en),he(fe,tn),he(fe,rn),he(fe,nn),he(fe,sn),he(fe,an),he(fe,on),he(fe,ln),he(fe,un),fe);yt([pt({allowed:!0})],it,"signOut");yt([pt({allowed:!0})],it,"signInDemo");yt([pt({allowed:gi.FF_Role_Auth_Invite})],it,"invite");yt([pt({allowed:!0})],it,"signUpPassword");yt([pt({allowed:!0})],it,"signInPassword");yt([pt({allowed:!0})],it,"forgotPassword");yt([pt({allowed:!0})],it,"resetPassword");yt([pt({allowed:!0})],it,"signInOTP");yt([pt({allowed:!0})],it,"verifyOtp");yt([pt({allowed:!0})],it,"signInOAuthGetUrl");let Zd=it;var eh=Ie('<div><div class="flex justify-between"><label class="fieldset-label"> </label> <span class="text-error"> </span></div> <input class="input w-full"></div>');function Sa(r,e){let t=Rt(e,"type",3,"text"),n=Rt(e,"value",15);var i=eh(),s=ae(i),a=ae(s),o=ae(a,!0);se(a);var l=Le(a,2),u=ae(l,!0);se(l),se(s);var f=Le(s,2);Gu(f),se(i),wt(()=>{Xe(a,"for",e.id),Dt(o,e.label),Dt(u,e.error),Xe(f,"id",e.id),Xe(f,"type",t()),Xe(f,"autocomplete",e.autocomplete),Xe(f,"placeholder",e.placeholder)}),Qu(f,n),Z(r,i)}var th=Ie('<p class="text-base-content/50 text-sm">Not a member ? <a class="link link-primary">Sign Up</a></p>'),rh=Ie('<p class="text-base-content/50 text-sm">Already a member ? <a class="link link-primary">Sign In</a></p>'),nh=Ie('<span class="text-error text-right"> </span>'),ih=Ie("<span>&nbsp;</span>"),sh=Ie('<a class="link link-primary">Forgot password?</a>'),ah=Ie('<a class="link link-primary">Sign In</a>'),oh=Ie("<span>&nbsp;</span>"),lh=Ie('<div class="card bg-base-200 text-primary-content"><div class="card-body"><h2 class="card-title"> </h2> <!> <form class="mt-2 flex flex-col gap-4"><div class="flex flex-col gap-2"><!> <!></div> <!> <div class="card-actions items-center justify-between"><!> <button class="btn btn-primary"> </button></div></form></div></div>');function Ts(r,e){ai(e,!0);let t=Rt(e,"email",7,""),n=Rt(e,"mode",3,"sign-in"),i=Ce(""),s=Ce(""),a=$e(()=>n()==="sign-in"?"Sign In":n()==="sign-up"?"Sign Up":"Forgot Password"),o=$e(()=>n()==="sign-in"?"Sign In":n()==="sign-up"?"Sign Up":"Send by mail");const l=(D,L)=>new URL(`${Be}${D}`,Vi.url).toString();async function u(D){D.preventDefault();try{await Zd.signInPassword(t(),H(i))}catch(L){L&&L.message&&ce(s,bt(L.message))}}var f=lh(),c=ae(f),h=ae(c),p=ae(h,!0);se(h);var y=Le(h,2);{var m=D=>{var L=th(),z=Le(ae(L));se(L),wt(de=>Xe(z,"href",de),[()=>l("/auth/sign-up",{email:t()})]),Z(D,L)},g=D=>{var L=at(),z=qe(L);{var de=je=>{var ve=rh(),ze=Le(ae(ve));se(ve),wt(St=>Xe(ze,"href",St),[()=>l("/auth",{email:t()})]),Z(je,ve)};ot(z,je=>{n()==="sign-up"&&je(de)},!0)}Z(D,L)};ot(y,D=>{n()==="sign-in"?D(m):D(g,!1)})}var k=Le(y,2),T=ae(k),M=ae(T);Sa(M,{id:"email",label:"Email",type:"text",error:"",placeholder:"Email",get value(){return t()},set value(D){t(D)}});var b=Le(M,2);{var _=D=>{Sa(D,{id:"password",label:"Password",type:"password",error:"",placeholder:"Password",get value(){return H(i)},set value(L){ce(i,bt(L))}})};ot(b,D=>{(n()==="sign-in"||n()==="sign-up")&&D(_)})}se(T);var O=Le(T,2);{var R=D=>{var L=nh(),z=ae(L,!0);se(L),wt(()=>Dt(z,H(s))),Z(D,L)},x=D=>{var L=ih();Z(D,L)};ot(O,D=>{H(s)?D(R):D(x,!1)})}var S=Le(O,2),E=ae(S);{var A=D=>{var L=sh();wt(z=>Xe(L,"href",z),[()=>l("/auth/forgot-password",{email:t()})]),Z(D,L)},v=D=>{var L=at(),z=qe(L);{var de=ve=>{var ze=ah();wt(St=>Xe(ze,"href",St),[()=>l("/auth",{email:t()})]),Z(ve,ze)},je=ve=>{var ze=oh();Z(ve,ze)};ot(z,ve=>{n()==="forgot-password"?ve(de):ve(je,!1)},!0)}Z(D,L)};ot(E,D=>{n()==="sign-in"?D(A):D(v,!1)})}var F=Le(E,2),U=ae(F,!0);se(F),se(S),se(k),se(c),se(f),wt(()=>{Dt(p,H(a)),Dt(U,H(o))}),qu("submit",k,u),Z(r,f),oi()}var uh=Ie('<div class="hero bg-base-100 min-h-screen"><div class="hero-content w-full max-w-4xl flex-col gap-8 lg:flex-row-reverse"><div class="w-full max-w-md flex-1"><!> <div class="divider my-8">OR</div> <div class="flex gap-4"><button class="btn btn-neutral grow gap-2"><svg class="h-5 w-5" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.0003 4.75C13.7703 4.75 15.3553 5.36002 16.6053 6.54998L20.0303 3.125C17.9502 1.19 15.2353 0 12.0003 0C7.31028 0 3.25527 2.69 1.28027 6.60998L5.27028 9.70498C6.21525 6.86002 8.87028 4.75 12.0003 4.75Z" fill="#EA4335"></path><path d="M23.49 12.275C23.49 11.49 23.415 10.73 23.3 10H12V14.51H18.47C18.18 15.99 17.34 17.25 16.08 18.1L19.945 21.1C22.2 19.01 23.49 15.92 23.49 12.275Z" fill="#4285F4"></path><path d="M5.26498 14.2949C5.02498 13.5699 4.88501 12.7999 4.88501 11.9999C4.88501 11.1999 5.01998 10.4299 5.26498 9.7049L1.275 6.60986C0.46 8.22986 0 10.0599 0 11.9999C0 13.9399 0.46 15.7699 1.28 17.3899L5.26498 14.2949Z" fill="#FBBC05"></path><path d="M12.0004 24.0001C15.2404 24.0001 17.9654 22.935 19.9454 21.095L16.0804 18.095C15.0054 18.82 13.6204 19.245 12.0004 19.245C8.8704 19.245 6.21537 17.135 5.2654 14.29L1.27539 17.385C3.25539 21.31 7.3104 24.0001 12.0004 24.0001Z" fill="#34A853"></path></svg></button> <button class="btn btn-neutral grow gap-2"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path></svg></button></div></div></div></div>');function fh(r){var e=uh(),t=ae(e),n=ae(t),i=ae(n);Ts(i,{mode:"sign-in"}),xn(4),se(n),se(t),se(e),Z(r,e)}const ch=Object.freeze(Object.defineProperty({__proto__:null,component:fh},Symbol.toStringTag,{value:"Module"}));var dh=Ie('<div class="hero bg-base-100 min-h-screen"><div class="hero-content w-full max-w-4xl flex-col gap-8 lg:flex-row-reverse"><div class="w-full max-w-md flex-1"><!></div></div></div>');function hh(r){var e=dh(),t=ae(e),n=ae(t),i=ae(n);Ts(i,{mode:"forgot-password"}),se(n),se(t),se(e),Z(r,e)}const ph=Object.freeze(Object.defineProperty({__proto__:null,component:hh},Symbol.toStringTag,{value:"Module"}));var yh=Ie('<div class="hero bg-base-100 min-h-screen"><div class="hero-content w-full max-w-4xl flex-col gap-8 lg:flex-row-reverse"><div class="w-full max-w-md flex-1"><!> <div class="divider my-8">OR</div> <div class="flex gap-4"><button class="btn btn-neutral grow gap-2"><svg class="h-5 w-5" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.0003 4.75C13.7703 4.75 15.3553 5.36002 16.6053 6.54998L20.0303 3.125C17.9502 1.19 15.2353 0 12.0003 0C7.31028 0 3.25527 2.69 1.28027 6.60998L5.27028 9.70498C6.21525 6.86002 8.87028 4.75 12.0003 4.75Z" fill="#EA4335"></path><path d="M23.49 12.275C23.49 11.49 23.415 10.73 23.3 10H12V14.51H18.47C18.18 15.99 17.34 17.25 16.08 18.1L19.945 21.1C22.2 19.01 23.49 15.92 23.49 12.275Z" fill="#4285F4"></path><path d="M5.26498 14.2949C5.02498 13.5699 4.88501 12.7999 4.88501 11.9999C4.88501 11.1999 5.01998 10.4299 5.26498 9.7049L1.275 6.60986C0.46 8.22986 0 10.0599 0 11.9999C0 13.9399 0.46 15.7699 1.28 17.3899L5.26498 14.2949Z" fill="#FBBC05"></path><path d="M12.0004 24.0001C15.2404 24.0001 17.9654 22.935 19.9454 21.095L16.0804 18.095C15.0054 18.82 13.6204 19.245 12.0004 19.245C8.8704 19.245 6.21537 17.135 5.2654 14.29L1.27539 17.385C3.25539 21.31 7.3104 24.0001 12.0004 24.0001Z" fill="#34A853"></path></svg></button> <button class="btn btn-neutral grow gap-2"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path></svg></button></div></div></div></div>');function mh(r){var e=yh(),t=ae(e),n=ae(t),i=ae(n);Ts(i,{mode:"sign-up"}),xn(4),se(n),se(t),se(e),Z(r,e)}const gh=Object.freeze(Object.defineProperty({__proto__:null,component:mh},Symbol.toStringTag,{value:"Module"}));export{Ih as start};
